c     twopdmlibrary
C**********************************************************************
C*   NOTICE OF PROGRAM MODIFICATION                                   *
C**********************************************************************
C*  BY:  RICHARD REMINGTON                         search:  c3-24-88  *
C*  DATE:  MARCH  24,  1988                                           *
C*  REASON: (none) DECREASE CORE TO RUN IN 7MB ON 9370                *
c*          and comment out unreachable code                          *
C**********************************************************************
C  LAST UPDATED BY WESLEY ALLEN ON NOVEMBER 5, 1986;                  *
C  TO ACTIVATE THE ROOT SELECTION OPTION.                             *
C**********************************************************************
C  LAST UPDATED BY TJL ON APRIL 17, 1986;  CHANGING ITAP03=12 TO      *
C  ITAP03=54 IN SUBROUTINE INITPG                                     *
C**********************************************************************
C
      SUBROUTINE GETDRT(LEVPT,      AVAL,BVAL,ROWSYM,ARC
     #,                 NLWKS,              WEIGHT,WAB,WTW,WTX
     #,                 WTY,KADD,LADD,IJADD,IJGRP,ININT,INEXT,JMNNXT
     #,                 JMXNXT,NINGRP,ORBSYM,IMNGRP,IMXGRP,JMNGRP,JMXGRP
     #,                 IJXX,KLXX,NKLXX,IJWW,KLWW,NKLWW,END)
C
C
C
      IMPLICIT INTEGER (A-Z)
C     EXTENDED DUMMY LEVPT,AVAL,BVAL,ROWSYM,ARC,NLWKS,WEIGHT,WAB,WTW,
C    1               WTX,WTY,KADD,LADD,IJADD,IJGRP,ININT,INEXT,JMNNXT,
C    2               JMXNXT,NINGRP,ORBSYM,IMNGRP,IMXGRP,JMNGRP,JMXGRP,
C    3               IJXX,KLXX,NKLXX,IJWW,KLWW,NKLWW
      REAL*8 CIVER,DRTVER,Q
C
      COMMON /LBLS/ CIVER,DRTVER,LBLINT(26),LBLDRT(26)
      COMMON /TAPES/ITAP52,ITAPE5,ITAPE6,ITAP58,ITAP54,ITAP03,ITAP04
     *,             ITAPE3,ITAP05,ITAP06,ITAP56
      COMMON /DIMS/ NBF,NSYM,NORBS,NROWS,NROWS4,NWKS,NWKS2,NLEVS
     *,             NROWOC,NROW4O,NMKSOC,NLEVOC,NORBOC,LEVFRM
     *,             NWKSMX,NLWKMX,NUWKMX,BMAX,NROOTS,ORBFRM
      COMMON /ALL/  Q(3),IQ,IX(6),LVFRM1,NLWKI,NLWKJ,IMAX,IMIN
      COMMON /INTS/   NMAX,NMAX2,NGROUP,NBLKOC,NUMIJ,SYMORB,INTSRT
      COMMON /SYMM/ JSM,JFSYM,IFSYM,MAXSYM(8),MINSYM(8),ISMOFF(8)
     #,             NUMSYM(8)
      COMMON /XX4X/   NIJVIR,NREFS
C
      DIMENSION LEVPT(NLEVS),AVAL(NROWS),BVAL(NROWS)
      DIMENSION ARC(NROWS4),NLWKS(NROWS),ROWSYM(NROWS)
      DIMENSION                WEIGHT(NROWS4),WAB(LVFRM1)
      DIMENSION WTW(LVFRM1,NSYM),WTX(LVFRM1,NSYM),WTY(LVFRM1)
      DIMENSION IJADD(NUMIJ),KADD(SYMORB),LADD(SYMORB)
      DIMENSION IJGRP(NUMIJ),ININT(NORBS),INEXT(NORBS)
      DIMENSION JMNNXT(NORBS),JMXNXT(NORBS),ORBSYM(NORBS)
      DIMENSION NINGRP(NGROUP),IMNGRP(NGROUP),IMXGRP(NGROUP)
      DIMENSION JMNGRP(NGROUP),JMXGRP(NGROUP)
      DIMENSION IJXX(NUMIJ ),KLXX(NIJVIR),NKLXX(NSYM,ORBFRM)
      DIMENSION IJWW(NUMIJ ),KLWW(NIJVIR),NKLWW(NSYM,ORBFRM)
C
      CALL WREADW(ITAP58,KADD,SYMORB,END,END)
      CALL WREADW(ITAP58,LADD,SYMORB,END,END)
      CALL WREADW(ITAP58,IJADD,NUMIJ,END,END)
      CALL WREADW(ITAP58,IJGRP,NUMIJ,END,END)
      CALL WREADW(ITAP58,ININT,NORBS,END,END)
      CALL WREADW(ITAP58,INEXT,NORBS,END,END)
      CALL WREADW(ITAP58,JMNNXT,NORBS,END,END)
      CALL WREADW(ITAP58,JMXNXT,NORBS,END,END)
      CALL WREADW(ITAP58,NINGRP,NGROUP,END,END)
      END=END+NBF
      CALL WREADW(ITAP58,ORBSYM,NORBS,END,END)
      END=END+NBF+NREFS*NBF+NORBS
      CALL WREADW(ITAP58,LEVPT,NLEVS,END,END)
      END=END+NLEVS
      CALL WREADW(ITAP58,AVAL,NROWS,END,END)
      CALL WREADW(ITAP58,BVAL,NROWS,END,END)
      CALL WREADW(ITAP58,ROWSYM,NROWS,END,END)
      CALL WREADW(ITAP58,ARC,NROWS4,END,END)
      CALL WREADW(ITAP58,NLWKS,NROWS,END,END)
      CALL WREADW(ITAP58,WEIGHT,NROWS4,END,END)
      CALL WREADW(ITAP58,WAB,LVFRM1,END,END)
      CALL WREADW(ITAP58,WTW,LVFRM1*NSYM,END,END)
      CALL WREADW(ITAP58,WTX,LVFRM1*NSYM,END,END)
      CALL WREADW(ITAP58,WTY,LVFRM1,END,END)
      CALL WREADW(ITAP58,IJXX,NUMIJ,END,END)
      CALL WREADW(ITAP58,KLXX,NIJVIR,END,END)
      CALL WREADW(ITAP58,NKLXX,NSYM*ORBFRM,END,END)
      CALL WREADW(ITAP58,IJWW,NUMIJ,END,END)
      CALL WREADW(ITAP58,KLWW,NIJVIR,END,END)
      CALL WREADW(ITAP58,NKLWW,NSYM*ORBFRM,END,END)
C
C     NKLXX(1,1)=0
C     NKLXX(2,1)=0
C     NKLXX(1,2)=1
C     NKLXX(2,2)=0
C     NKLXX(1,3)=1
C     NKLXX(2,3)=2
C
C
      MCPR=0
      IF (MCPR.GT.0) THEN
           WRITE (ITAPE6,*) ' KADD '
           WRITE (ITAPE6,710) KADD
           WRITE (ITAPE6,*) ' LADD '
           WRITE (ITAPE6,710) LADD
           WRITE (ITAPE6,*) ' IJADD'
           WRITE (ITAPE6,710) IJADD
           WRITE (ITAPE6,*) ' IJGRP'
           WRITE (ITAPE6,710) IJGRP
           WRITE (ITAPE6,*) ' ININT'
           WRITE (ITAPE6,710) ININT
           WRITE (ITAPE6,*) ' INEXT'
           WRITE (ITAPE6,710) INEXT
           WRITE (ITAPE6,*) ' JMNNXT'
           WRITE (ITAPE6,710) JMNNXT
           WRITE (ITAPE6,*) ' JMXNXT'
           WRITE (ITAPE6,710) JMXNXT
           WRITE (ITAPE6,*) ' NINGRP'
           WRITE (ITAPE6,710) NINGRP
           WRITE (ITAPE6,*) ' ORBSYM'
           WRITE (ITAPE6,710) ORBSYM
           WRITE (ITAPE6,*) ' LEVPT'
           WRITE (ITAPE6,710) LEVPT
           WRITE (ITAPE6,*) ' AVAL '
           WRITE (ITAPE6,710) AVAL
           WRITE (ITAPE6,*) ' BVAL '
           WRITE (ITAPE6,710) BVAL
           WRITE (ITAPE6,*) ' ROWSYM'
           WRITE (ITAPE6,710) ROWSYM
           WRITE (ITAPE6,*) ' ARC  '
           WRITE (ITAPE6,710) ARC
           WRITE (ITAPE6,*) ' NLWKS'
           WRITE (ITAPE6,710) NLWKS
           WRITE (ITAPE6,*) ' WIEGHT'
           WRITE (ITAPE6,710) WEIGHT
           WRITE (ITAPE6,*) ' WAB  '
           WRITE (ITAPE6,710) WAB
           WRITE (ITAPE6,*) ' WTW  '
           WRITE (ITAPE6,720) WTW
           WRITE (ITAPE6,*) ' WTX  '
           WRITE (ITAPE6,720) WTX
           WRITE (ITAPE6,*) ' WTY  '
           WRITE (ITAPE6,720) WTY
           WRITE (ITAPE6,*) ' IJXX '
           WRITE (ITAPE6,710) IJXX
           WRITE (ITAPE6,*) ' KLXX '
           WRITE (ITAPE6,710) KLXX
           WRITE (ITAPE6,*) ' NKLXX'
           WRITE (ITAPE6,710) NKLXX
           WRITE (ITAPE6,*) ' IJWW '
           WRITE (ITAPE6,710) IJWW
           WRITE (ITAPE6,*) ' KLWW '
           WRITE (ITAPE6,710) KLWW
           WRITE (ITAPE6,*) ' NKLWW'
           WRITE (ITAPE6,710) NKLWW
      END IF
C
C
  710 FORMAT (20I5)
  720 FORMAT (10I10)
    9 CONTINUE
      NFRMIN=LEVPT(LEVFRM)+1
      NLWKMX=0
      DO 10 I=NFRMIN,NROWOC
           IF(NLWKS(I).GT.NLWKMX) NLWKMX=NLWKS(I)
   10 CONTINUE
      IBLK=1
      IMXGRP(IBLK)=NORBS
      JMXGRP(IBLK)=NORBS
      DO 25 I=NORBS,1,-1
           DO 20 J=I,1,-1
                IJ=I*(I-1)/2+J
C     PRINT '(' I,J',2I3,' IBLK AND IJGRP(IJ)',2I3)',I,J,IBLK,IJGRP(IJ)
                IF(IJGRP(IJ).EQ.IBLK) GO TO 20
                IF (I.EQ.J.AND.I.NE.IMXGRP(IBLK)) GO TO 22
                IMNGRP(IBLK)=I
                JMNGRP(IBLK)=J+1
                GO TO 24
  22            CONTINUE
                IMNGRP(IBLK)=I+1
                JMNGRP(IBLK)=1
  24            CONTINUE
                IBLK=IBLK+1
                IMXGRP(IBLK)=I
                JMXGRP(IBLK)=J
  20       CONTINUE
  25  CONTINUE
      IMNGRP(NGROUP)=1
      JMNGRP(NGROUP)=1
C     PRINT '(' IMX ',(20I3))',IMXGRP
C     PRINT '(' IMN ',(20I3))',IMNGRP
C     PRINT '(' JMX ',(20I3))',JMXGRP
C     PRINT '(' JMN ',(20I3))',JMNGRP
      IF(IBLK.EQ.NGROUP) GO TO 35
      WRITE(ITAPE6,30)IBLK,NGROUP
  30  FORMAT(1H ,'ERROR IN NUMBER OF BLOCKS,IBLK=',I3,' NGROUP=',I3)
      CALL DUMP
  35  CONTINUE
      DO 40 I=1,NSYM
           MINSYM(I)=1000
   40 MAXSYM(I)=0
      MINSYM(1)=1
      ISM=ORBSYM(1)
      DO 45 I=2,LVFRM1
           IF(ORBSYM(I).EQ.ISM) GO TO 45
           MAXSYM(ISM)=I-1
           ISM=ORBSYM(I)
           MINSYM(ISM)=I
   45 CONTINUE
      MAXSYM(ISM)=LVFRM1
      WRITE(ITAPE3,50) (MINSYM(J),J=1,NSYM)
   50 FORMAT(' MINSYM = ',8I5)
      WRITE(ITAPE3,55) (MAXSYM(J),J=1,NSYM)
   55 FORMAT(' MAXSYM = ',8I5)
      RETURN
      END
