cets The following is called by a C program which handles dynamic
cets allocation of memory.
      subroutine fentry(cc,ia,maxcor)
cets  PROGRAM RAMANG
C   ANALYTICAL RAMAN INTENSITIES
C   FOR GENERAL OPEN-SHELL SCF WAVE FUNCTIONS
c   
c   edward seidl (cets030991)
c   march 9, 1991
c   add new input format and print control
C*****************************************************
C***LAST UPDATED ON MAY 29, 1985 BY YUKIO YAMAGUCHI***
C*****************************************************
C
      IMPLICIT REAL*8 (A-H,O-Z)
cets030991
#include <error.h>
      integer errcod, frdi
      integer ip, prcntr, prdup
cets  DIMENSION CC(400000),IA(1)
      dimension cc(maxcor),ia(1)
      DIMENSION AFG(6,150)
      COMMON/BASIS/NBASIS,NBFAO,NTRI,NTRI2,NBATRI,NBASQ
      COMMON/CALIF/LPARA(1024),APARA(1024)
      COMMON/DIPOL/DIPDA(135),DIPDN(135)
      COMMON/EAFGS/AF1(3,3,150),AF2(3,3,150),AF3(3,3,150),AFT(3,3,150)
      COMMON/FUNCS/NTYPES,NTYPEP,NTREAD,NATOMS,N3N,N3NP3,N3NX3
      COMMON/GVBAB/ALPA(10,10),BETA(10,10)
      COMMON/LIMIT/MAXBAS,MAXBUF,MAXBF2,MAXBF4
      COMMON/MFSEC/MASTER,NSECT
      COMMON/SECTF/ISF(153),IHF(153),IFF(153),IEF(153),IBF(153),IUF(153)
      COMMON/SIGNS/IOFF(466),IPRNT
      COMMON/START/FOCC(10),NSORB(10),NSTR(10),NEND(10),MOTYP(256)
      COMMON/TAPES/ITAP36,ITAP42,ITAP43,ITAP44
      COMMON/WORKS/JTAPE1
cets  EQUIVALENCE (CC,IA)
      DATA ZERO,QUAR,HALF,ONE / 0.0D+00 , 0.25D+00 , 0.5D+00 , 1.0D+00 /
      DATA A00 / 0.52917706D+00 /
    1 FORMAT(//,2X,' RAMAN INTENSITY PROGRAM FOR GENERAL OPEN-SHELL SCF
     1IN AO BASIS'/)
    2 FORMAT(5I5)
    3 FORMAT(2X,8I6)
    4 FORMAT(//,2X,' PARAMETERS'/
     * 2X,' NBASIS = ',I8/
     * 2X,' NBFAO  = ',I8/
     * 2X,' NTRI   = ',I8/
     * 2X,' NTYPES = ',I8/
     * 2X,' NTYPEP = ',I8/
     * 2X,' NATOMS = ',I8/
     * 2X,' N3N    = ',I8/
     * 2X,' N3NP3  = ',I8/
     * 2X,' N3NX3  = ',I8/
     * 2X,' IPRNT  = ',I8/)
    5 FORMAT(//,2X,' ALPA MATRIX'/)
    6 FORMAT(//,2X,' BETA MATRIX'/)
    7 FORMAT(//,2X,' NO.',8X,' FOCC',6X,' NSORB',7X,' NSTR',7X,' NEND'/)
    8 FORMAT(2X,I4,3X,F10.5,7X,I5,7X,I5,7X,I5)
    9 FORMAT(//,2X,' SCF EIGENVECTOR (AO BASIS) MATRIX'/)
   10 FORMAT(//,2X,' SCF EIGENVECTOR (SO BASIS) MATRIX'/)
   11 FORMAT(//,2X,' ICMAX = ',I10,5X,' MAXCOR = ',I10/)
   12 FORMAT(//,2X,' REQUIRED MEMORY EXCEEDS MAXCOR'/
     1          2X,' ICMAX = ',I10,5X,' MAXCOR = ',I10/)
   13 FORMAT(//,2X,' AFG MATRIX IN (BOHR+2)'/)
   14 FORMAT(//,2X,' AFG MATRIX IN (A+2)'/)
   15 FORMAT(3F20.10)
C
C   JTAPE1 = WORKING TAPE FOR FIRST DERIVATIVES
C
cets030991      CALL drum
      call psinit('APPEND')
      CALL TSTART(6)
C      CALL TSTART(3)
      CALL INITMF(1)
C
      ITAPE3=3
      ITAPE6=6
      INPUT=5
      ITAP18=18
      ITAP36=36
      ITAP42=42
      ITAP43=43
      ITAP44=44
      JTAPE1=91
      call ffile(itap18,' ',0)
cets  MAXCOR=400000
C
      CALL LOCATE(INPUT,'# RAMAN ##',IERR)
C
C   LOCATION OF MATRICES IN ITAP44
C   (1) SA (N3NP3*NTRIL)
C   (2) HA (N3NP3*NTRIL)
C   (3) FA (N3NP3*NTRIL)
C   (4) EA (N3NP3*NBASQL)
C   (5) BA (N3NP3*NTRIL)
C   (6) UA (N3NP3*NBASQL)
C
      IOFF(1)=0
      DO 101 I=1,465
  101 IOFF(I+1)=IOFF(I)+I
C
      WRITE(6,1)
cets  WRITE(3,1)
C
C   READIN PARAMETERS
cets030991
      if(ierr.eq.0) then
        READ(5,2) IPRNT
      else
        errcod = frdi('IPRINT',iprnt)
      endif

      errcod = prcntr('ON BRIEF')
      errcod = prcntr('OFF DEBUG VERBOSE')
      errcod = prdup()

      if(prcntr('IS_ON VERBOSE').eq.1.or.prcntr('IS_ON DEBUG').eq.1)
     +  errcod = prcntr('OFF BRIEF')
C
C   READIN SCF INFORMATION
      NBASIS=LPARA(3)
      NTRI=LPARA(4)
      NTRI2=NTRI*2
      NATOMS=LPARA(10)
      NBFAO=LPARA(11)
      N3N=LPARA(17)
      NTYPES=LPARA(18)
      NTYPEP=NTYPES+1
      N3NP3=N3N+3
      N3NX3=N3N*3
      NTRIL=((NTRI2-1)/NSECT+1)
      NBATRI=IOFF(NBFAO+1)
      NBASQ=NBASIS*NBASIS*2
      NBASQL=((NBASQ-1)/NSECT+1)
      N3TRL=N3NP3*NTRIL
      N3QRL=N3NP3*NBASQL
      DO 102 I=1,N3NP3
      ISF(I)=(I-1)*NTRIL+1
      IHF(I)=(I-1)*NTRIL+N3TRL+1
      IFF(I)=(I-1)*NTRIL+N3TRL+N3TRL+1
      IEF(I)=(I-1)*NBASQL+N3TRL+N3TRL+N3TRL+1
      IBF(I)=(I-1)*NTRIL+N3TRL+N3TRL+N3TRL+N3QRL+1
      IUF(I)=(I-1)*NBASQL+N3TRL+N3TRL+N3TRL+N3QRL+N3TRL+1
cets  WRITE(3,3) I,ISF(I),IHF(I),IFF(I),IEF(I),IBF(I),IUF(I)
  102 CONTINUE
C
      WRITE(6,4) NBASIS,NBFAO,NTRI,NTYPES,NTYPEP,NATOMS,N3N,N3NP3,N3NX3,
     1           IPRNT
C
      DO 104 I=1,10
      NSORB(I)=LPARA(I+40)
      FOCC(I)=APARA(I+40)
  104 CONTINUE
      DO 105 I=1,NTYPEP
      DO 105 J=1,NTYPEP
      ALPA(I,J)=ZERO
      BETA(I,J)=ZERO
  105 CONTINUE
      IJ=0
      DO 106 I=1,NTYPES
      DO 106 J=1,I
      IJ=IJ+1
      ALPA(I,J)= (ONE-APARA(10+IJ))*FOCC(I)*FOCC(J)*HALF
      BETA(I,J)=-(ONE-APARA(25+IJ))*FOCC(I)*FOCC(J)*QUAR
  106 CONTINUE
      WRITE(6,5)
      CALL MATOUT(ALPA,10,10,NTYPEP,NTYPEP,6)
      WRITE(6,6)
      CALL MATOUT(BETA,10,10,NTYPEP,NTYPEP,6)
      NSTR(1)=1
      NEND(1)=NSORB(1)
      DO 107 ITYP=2,NTYPEP
      NSTR(ITYP)=NEND(ITYP-1)+1
      NEND(ITYP)=NSTR(ITYP)+NSORB(ITYP)-1
  107 CONTINUE
      DO 109 ITYP=1,NTYPEP
      DO 108 I=NSTR(ITYP),NEND(ITYP)
  108 MOTYP(I)=ITYP
  109 CONTINUE
      WRITE(6,7)
      DO 110 I=1,NTYPEP
  110 WRITE(6,8) I,FOCC(I),NSORB(I),NSTR(I),NEND(I)
C
C   READ IN SO-MO EIGENVECTORS
C%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
      IC1=1
      IC2=IC1+NBASIS
      IC3=IC2+NBASIS
C%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
      CALL MREAD(CC(IC1),17)
      CALL MREAD(CC(IC2),18)
      CALL MREAD(CC(IC3),20)
      IF(IPRNT.LE.2) GO TO 301
      WRITE(6,9)
      CALL EIGOUT(CC(IC3),CC(IC1),CC(IC2),NBFAO,NBASIS,NBFAO,NBASIS,6)
C
  301 CONTINUE
cets  WRITE(3,21)
   21 FORMAT(//,2X,' NOW YOU ARE IN SSMAT'/)
      IC4=IC3+NBFAO*NBASIS
      IC5=IC4+NBASIS*NBASIS*N3N
      IC6=IC5+NBASIS*NBASIS*3
      IC7=IC6+NTRI*N3NX3
      ICMAX=IC7+NTRI*9
cets  WRITE(3,11) ICMAX,MAXCOR
      IF(ICMAX.GT.MAXCOR) GO TO 399
C................UA      UF      SSAF    SSFG....
      CALL SSMAT(CC(IC4),CC(IC5),CC(IC6),CC(IC7))
C
cets  WRITE(3,22)
   22 FORMAT(//,2X,' NOW YOU ARE IN POLDER'/)
      IC8=IC7+NTRI*9
      IC9=IC8+NTRI*NTYPEP
      IC10=IC9+NTRI*N3N
      IC11=IC10+NBASIS*NBASIS*N3N
      ICMAX=IC11+NBASIS*NBASIS*3
cets  WRITE(3,11) ICMAX,MAXCOR
      IF(ICMAX.GT.MAXCOR) GO TO 399
C.................UA      UF      SSAF    SSFG    ZETA    SA......
      CALL POLDER(CC(IC4),CC(IC5),CC(IC6),CC(IC7),CC(IC8),CC(IC9),
C.................EA       EF.......
     1            CC(IC10),CC(IC11))
C
cets  WRITE(3,23)
   23 FORMAT(//,2X,' NOW YOU ARE IN DERMAT'/)
      IC8=IC7+NTRI*9
      IC9=IC8+N3N
      IC10=IC9+N3N*N3N
      IC11=IC10+NBATRI
      IC12=IC11+NBFAO*NBASIS
      ICMAX=IC12+NBFAO*NBASIS
cets  WRITE(3,11) ICMAX,MAXCOR
      IF(ICMAX.GT.MAXCOR) GO TO 399
C.................EAO     E1A     E2A     SS       U       T.........
      CALL DERMAT(CC(IC3),CC(IC8),CC(IC9),CC(IC10),CC(IC11),CC(IC12))
C
cets  WRITE(3,24)
   24 FORMAT(//,2X,' NOW YOU ARE IN AFMAT'/)
      IC8=IC7+NTRI*9
      IC9=IC8+NTRI*N3N*NTYPEP
      IC10=IC9+NTRI*3*NTYPEP
      IC11=IC10+NBASIS*NBASIS*N3N*3
      IC12=IC11+NTRI
      ICMAX=IC12+NTRI
cets  WRITE(3,10) ICMAX,MAXCOR
      IF(ICMAX.GT.MAXCOR) GO TO 399
C................FA      HF      HAF      HH       TT.......
      CALL AFMAT(CC(IC8),CC(IC9),CC(IC10),CC(IC11),CC(IC12))
C
cets  WRITE(3,25)
   25 FORMAT(//,2X,' NOW YOU ARE IN POLAD1'/)
      IC8=IC7+NTRI*9
      IC9=IC8+NTRI*N3N*NTYPEP
      IC10=IC9+NTRI*3*NTYPEP
      ICMAX=IC10+NBASIS*NBASIS*N3N*3
cets  WRITE(3,11) ICMAX,MAXCOR
      IF(ICMAX.GT.MAXCOR) GO TO 399
C.................UA      UF      FA      HF      HAF......
      CALL POLAD1(CC(IC4),CC(IC5),CC(IC8),CC(IC9),CC(IC10))
C
C   READ IN SO-MO EIGENVECTORS
      CALL MREAD(CC(IC3),19)
      IF(IPRNT.LE.2) GO TO 302
      WRITE(6,10)
      CALL EIGOUT(CC(IC3),CC(IC1),CC(IC2),NBFAO,NBASIS,NBFAO,NBASIS,6)
C
  302 CONTINUE
cets  WRITE(3,26)
   26 FORMAT(//,2X, ' NOW YOU ARE IN POLAD2'/)
      IC8=IC7+NTRI*9
      IC9=IC8+NBASIS*NBASIS
      IC10=IC9+NBASIS*NBASIS
      IC11=IC10+NTRI*N3NP3*NTYPEP
      IC12=IC11+NTRI*N3NP3*NTYPEP
      IC13=IC12+NTRI*N3NP3*NTYPEP
      IA13=IC13+IC13-1
      ICMAX=IC13+MAXBF2
cets  WRITE(3,11) ICMAX,MAXCOR
      IF(ICMAX.GT.MAXCOR) GO TO 399
C.................ESO     UA      UF      SSAF    SSFG    U.......
      CALL POLAD2(CC(IC3),CC(IC4),CC(IC5),CC(IC6),CC(IC7),CC(IC8),
C.................T       DP       DQ       DM       BUFI     LBLI.....
     1            CC(IC9),CC(IC10),CC(IC11),CC(IC12),CC(IC13),IA(IA13))
C
C   STORE POLARIZABILITY DERIVATIVES ON THE TAPE18
      DO 115 IABC=1,N3N
      IXYZ=0
      DO 114 I=1,3
      DO 114 J=1,I
      IXYZ=IXYZ+1
      AFG(IXYZ,IABC)=AFT(I,J,IABC)
  114 CONTINUE
  115 CONTINUE
      WRITE(6,13)
      CALL MATOUT(AFG,6,150,6,N3N,6)
C
CCC   A22=A00*A00
CCC   DO 116 IABC=1,N3N
CCC   DO 116 IXYZ=1,6
CCC   AFG(IXYZ,IABC)=AFG(IXYZ,IABC)*A22
CC116 CONTINUE
CCC   WRITE(6,14)
CCC   CALL MATOUT(AFG,6,150,6,N3N,6)
C
      REWIND ITAP18
      WRITE(ITAP18,2) NATOMS,N3N
      WRITE(ITAP18,15) ((AFG(IXYZ,IABC),IABC=1,N3N),IXYZ=1,6)
      REWIND ITAP18
      GO TO 400
C
  399 WRITE(6,12) ICMAX,MAXCOR
  400 CONTINUE
C
      CALL RCLOSE(ITAP36,3)
      CALL RCLOSE(ITAP42,3)
      CALL RCLOSE(ITAP43,3)
      CALL RCLOSE(ITAP44,3)
      CALL RCLOSE(MASTER,3)
      CALL RCLOSE(JTAPE1,3)
      CALL TSTOP(6)
C      CALL TSTOP(3)
C
      STOP
      END
