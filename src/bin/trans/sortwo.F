      SUBROUTINE SORTWO(BKTPNT,START,ILAST2,BKTSZ,SRTAR,INTOFF,LEN2,NWRT
     1,MAXSZ,SPACE,RESRT,IRED2,INTF,NBKT,LBLS,INTS,LENR,BKTR,NBKT2,
     2SWOUT,SRTI)
C
C
C   INTS : LBLS
C  SRTAR : SRTI ARE AN IMPLICITLY EQUIVALENCED REAL : INTEGER PAIR
C
C
      IMPLICIT INTEGER (A-Z)
C
C
      integer lenr,bktr,ibigr,ibig,nbkt2,bktsz
      REAL*8 RESRT(LENR),INTS(BKTR),VAL,SRTAR(IBIGR)
      INTEGER SRTI(IBIG),INTOFF(NBKT2),LBLS(BKTSZ),ILAST2(NBKT2)
      INTEGER BKTPNT(NBKT2),START(NBKT2)
C
      COMMON /SRT/    VAL,IADR,IBKT,IADBK,MNBK,MXBK
      COMMON /DIMS/   SYMORB,NUMIJ,NIJ,NBF,NORBS,NMAX,NBFORB,NSYM0
      COMMON /TAPES/  IT34,IT58,IT47,IT52,IT91,IT93,IT95
      COMMON /OUT/    IOUT6,ICHECK,IDBG,ICNT
      COMMON /BDIM/   IMAX2,JMAX2,KMAX2,LENQ,LENAOR,IBIG,IBIGR,LENPWS
C
C
C     NBKT2=MAXSZ/LEN2
C     IF (NBKT2*LEN2 .NE. MAXSZ) NBKT2=NBKT2+1
C     PRINT *,'  IN SORTWO'
      IRED=IRED2
      BKTSZ2=MIN(BKTSZ,ITRNC(SPACE/NBKT2))
      IADBK=NBKT2
      MNBK=1
      MXBK=NBKT2
C     PRINT *,'  CALLING SRTONE'
C     WRITE(IOUT6,914) BKTSZ2,NBKT2,MAXSZ
 914  FORMAT(/'  BKTSZ2,NBKT2,MAXSZ=',3I10)
C     PRINT *,'  BKTSZ2=',BKTSZ2
C     PRINT *,'  NBKT2=',NBKT2
C     PRINT *,'  MAXSZ=',MAXSZ
CCC   PRINT *,'  BKTSZ2=',BKTSZ2,' NBKT2=',NBKT2,' MAXSZ=',MAXSZ
      CALL SRTONE(BKTPNT,START,ILAST2,BKTSZ2,NBKT2,SRTAR,SRTI,
     1INTOFF,IT95)
C     PRINT,'  CALLED SRTONE'
 10   CALL RREAD(IT91,LBLS,BKTSZ,IRED)
C     PRINT, BKTSZ,' WORDS READ FROM IT91 AT ADR ',IRED
      IRED=LBLS(1)
C     PRINT,' IADR=',IRED, ' NUMINTS=',LBLS(2)
      DO 1 JJ=1,LBLS(2)
           VAL=INTS(JJ+INTF)
           ILBL=LBLS(JJ+2)
           IBKT=ILBL/LENR
           IADR=ILBL-IBKT*LENR
           IF (IADR .EQ. 0) IADR=LENR
           IF (IBKT*LENR .NE. ILBL) IBKT=IBKT+1
C     IF (IADR.GT.LENR .OR. ABS(VAL).GT.1.E10) PRINT *,'  IADR=',IADR,
C    1 ' IBKT=',IBKT,' ILBL=',ILBL,' VAL=',VAL
C     IF (IADR.GT.LENR .OR. DABS(VAL).GT.1.0D+10) WRITE(IOUT6,911)
C    1   IADR,IBKT,ILBL,VAL
C911  FORMAT('  IADR=',I6,'  IBKT=',I6,'  ILBL=',I6,'  VAL=',G18.8)
      CALL SRTOUT(BKTPNT,START,ILAST2,BKTSZ2,NBKT2,
     1     SRTAR,SRTI,INTOFF,IT95)
    1 CONTINUE
      IF (IRED .NE. -1) GOTO 10
      CALL SRTLST(BKTPNT,START,ILAST2,BKTSZ2,NBKT2,SRTAR,SRTI,
     1INTOFF,IT95)
C
      WRITE(IOUT6,912)
 912  FORMAT(/'  FINISHED SORT; READYING FOR RE-SORT'/)
      INTF2=INTOFF(1)
      DO 4 JJ=1,NBKT2
           DO 2 KK=1,LENR
                RESRT(KK)=0.0D+00
    2      CONTINUE
           IRED=ILAST2(JJ)
           IF (IRED .EQ. -1) GOTO 30
 20        CALL RREAD(IT95,LBLS,BKTSZ2,IRED)
C     PRINT *,BKTSZ,' WORDS READ FROM IT95 AT ADR ',IRED
           IRED=LBLS(1)
           NUMINT=LBLS(2)
C     PRINT *,' INEXT=',IRED,'  NUMINT=',NUMINT
           DO 3 KK=1,NUMINT
C     IF (LBLS(KK+2).GT.LENR .OR. ABS(INTS(KK+INTF2)).GT.1.E10)
C    1 PRINT *,' LBLS(KK+2)=',LBLS(KK+2),'  INTS(KK+INTF2)=',
C    2 INTS(KK+INTF2)
C     IF (LBLS(KK+2).GT.LENR .OR. DABS(INTS(KK+INTF2)).GT. 1.0D+10)
C    1  WRITE(IOUT6,913) KK,LBLS(KK+2),INTS(KK+INTF2)
C913  FORMAT('  KK=',I6,'  LBLS=',I6,'  VAL=',G18.8)
                RESRT(LBLS(KK+2))=INTS(KK+INTF2)
    3      CONTINUE
           IF (IRED .NE. -1) GOTO 20
           CALL RGETSA(IT93,IX)
C     PRINT,LEN2,' WORDS WRITTEN TO IT93 AT ADR ',IX
C GBF SAYS TO MOVE 30 CONTINUE TO HERE ----
   30      CONTINUE
C
           CALL SWRIT(IT93,RESRT,LEN2)
           SWOUT=SWOUT+I2SEC(LEN2)
C30   CONTINUE
    4 CONTINUE
      RETURN
      END
