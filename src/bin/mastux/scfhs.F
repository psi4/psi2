      SUBROUTINE SCFHS(EIG,OCC,ESO,UAS,EAO,U,T,H,DC,DO,FC,FF,FK,FT,
     1                 WM,WA,EE,EZ,LBLI,BUFI,CC)
      IMPLICIT REAL*8 (A-H,O-Z)
      DIMENSION EIG(NBASIS),OCC(NBASIS)
      DIMENSION U(NBFAO,NBFAO),T(NBFAO,NBFAO)
      DIMENSION ESO(NBFSO,NBASIS),UAS(NBFAO,NBFSO),EAO(NBFAO,NBASIS)
      DIMENSION DC(NBATRI),DO(NBATRI),FC(NBATRI),FF(NBATRI),FK(NBATRI)
      DIMENSION FT(NBATRI),WM(NBATRI),WA(NBATRI),H(NBATRI)
      DIMENSION EE(NBFAO,NBFAO),EZ(NBFAO,NBFAO)
      DIMENSION LBLI(MAXBF4),BUFI(MAXBF2),CC(NBFAO*4)
      CHARACTER*8 SCFTYP,CITYP,DERTYP
      COMMON/BASIS/NBASIS,NTRI,NST,NSYM,NBFAO,NBFSO,NBATRI
      COMMON/LIMIT/MAXBAS,MAXBUF,MAXBF2,MAXBF4
      COMMON/SIGNS/IOFF(256),IPRNT
      COMMON/TAPES/ITAP34,ITAP36
      COMMON/TEMPS/I30(400)
      COMMON/TYPES/SCFTYP,CITYP,DERTYP
      COMMON/CI101/IOPEN,IOCC,JOCC,KOCC
      DATA A00,HALF,ONE,TWO,THREE,FOUR / 0.0D+00 , 0.5D+00 , 1.0D+00 ,
     1                                   2.0D+00 , 3.0D+00 , 4.0D+00 /
C
    1 FORMAT(//,
     1 2X,'*************************************************'/
     2 2X,'***THE HIGH SPIN OPEN-SHELL GENERATING ROUTINE***'/
     3 2X,'*************************************************'/)
    2 FORMAT(//,2X,' SORTED PITZER MO (SO BASIS)'/)
    3 FORMAT(//,2X,' DC MATRIX (SO BASIS)'/)
    4 FORMAT(//,2X,' DO MATRIX (SO BASIS)'/)
    5 FORMAT(2X,6I5,F15.8)
    6 FORMAT(//,2X,' TWO ELECTRON CONTRIBUTION FOR SO FOCK (F )'/)
    7 FORMAT(//,2X,' TWO ELECTRON CONTRIBUTION FOR SO FOCK (FF)'/)
    8 FORMAT(//,2X,' H MATRIX (SO BASIS)'/)
    9 FORMAT(//,2X,' THE TOTAL FOCK MATRIX IN MO BASIS'/)
   10 FORMAT(//,2X,' K MATRIX IN MO BASIS'/)
   11 FORMAT(//,2X,' TRANSFORMATION MATRIX'/)
   12 FORMAT(//,2X,' HIGH SPIN OPEN-SHELL MO''S (SO BASIS)'/)
   13 FORMAT(//,2X,' HIGH SPIN OPEN-SHELL MO''S (AO BASIS)'/)
   14 FORMAT(//,2X,' LAGRANGIAN MATRIX (MO BASIS)'/)
   15 FORMAT(//,2X,' LAGRANGIAN MATRIX (AO BASIS)'/)
   16 FORMAT(//,2X,' DC MATRIX IN AO BASIS'/)
   17 FORMAT(//,2X,' DO MATRIX IN AO BASIS'/)
C
      WRITE(6,1)
      IF(IPRNT.LE.2) GO TO 301
      WRITE(6,2)
      CALL EIGOUT(ESO,EIG,OCC,NBFSO,NBASIS,NBASIS,NBASIS,6)
C
C  CREATE DENSITY MATRICES
  301 IJ=0
      DO 103 I=1,NBASIS
      DO 103 J=1,I
      IJ=IJ+1
      VALC=A00
      VALO=A00
      DO 101 K=1,IOCC
  101 VALC=VALC+ESO(I,K)*ESO(J,K)
      DC(IJ)=VALC
      DO 102 K=IOCC+1,JOCC
  102 VALO=VALO+ESO(I,K)*ESO(J,K)
      DO(IJ)=VALO
  103 CONTINUE
      IF(IPRNT.LE.2) GO TO 302
      WRITE(6,3)
      CALL PRINT(DC,NTRI,NBASIS,6)
      WRITE(6,4)
      CALL PRINT(DO,NTRI,NBASIS,6)
C
C   CREATE FOCK MATRICES USING SO INTEGRALS
C
C   TWO ELECTRON PART
  302 CALL SREW(ITAP36)
      CALL ZERO(FC,NTRI)
      CALL ZERO(FF,NTRI)
C
  500 CALL SREAD(ITAP36,LBLI,MAXBF4)
      DO 110 I=1,MAXBUF
      IBA=LBLI(I+I-1)
      IBB=LBLI(I+I)
      IF(IBA.EQ.0) GO TO 501
      CALL UNPACK(II,JJ,KK,LL,IX,IBA,IBB)
      VALINT=BUFI(MAXBUF+I)
C     IF(IPRNT.LE.5) GO TO 305
C     WRITE(6,5) I,II,JJ,KK,LL,IX,VALINT
C
  305 GO TO (201,202,203,204,205,206,207,208,209,210,211,212,212,212),IX
C
C (II/II)   1=(11/11)
C
  201 IIII=IOFF(II+1)
      FC(IIII)=FC(IIII)+(DC(IIII)+DO(IIII))*VALINT
      FF(IIII)=FF(IIII)+ DO(IIII)*VALINT
      GO TO 110
C
C  (II/KK)  2=(22/11)
C
  202 IIII=IOFF(II+1)
      KKKK=IOFF(KK+1)
      IIKK=IOFF(II)+KK
      FC(IIII)=FC(IIII)+(DC(KKKK)*TWO+DO(KKKK))*VALINT
      FC(KKKK)=FC(KKKK)+(DC(IIII)*TWO+DO(IIII))*VALINT
      FC(IIKK)=FC(IIKK)- DC(IIKK)*VALINT
      FF(IIKK)=FF(IIKK)+ DO(IIKK)*VALINT
      GO TO 110
C
C  (II/IL)  3=(22/21)
C
  203 IIII=IOFF(II+1)
      IILL=IOFF(II)+LL
      FC(IIII)=FC(IIII)+(DC(IILL)+DO(IILL))*VALINT*TWO
      FC(IILL)=FC(IILL)+(DC(IIII)+DO(IIII))*VALINT
      FF(IIII)=FF(IIII)+ DO(IILL)*VALINT*TWO
      FF(IILL)=FF(IILL)+ DO(IIII)*VALINT
      GO TO 110
C
C  (IJ/JJ)  4=(21/11)
C
  204 IIJJ=IOFF(II)+JJ
      JJJJ=IOFF(JJ+1)
      FC(IIJJ)=FC(IIJJ)+(DC(JJJJ)+DO(JJJJ))*VALINT
      FC(JJJJ)=FC(JJJJ)+(DC(IIJJ)+DO(IIJJ))*VALINT*TWO
      FF(IIJJ)=FF(IIJJ)+ DO(JJJJ)*VALINT
      FF(JJJJ)=FF(JJJJ)+ DO(IIJJ)*VALINT*TWO
      GO TO 110
C
C  (IJ/IJ)  5=(21/21)
C
  205 IIJJ=IOFF(II)+JJ
      IIII=IOFF(II+1)
      JJJJ=IOFF(JJ+1)
      FC(IIJJ)=FC(IIJJ)+(DC(IIJJ)*THREE+DO(IIJJ)*TWO)*VALINT
      FC(IIII)=FC(IIII)- DC(JJJJ)*VALINT
      FC(JJJJ)=FC(JJJJ)- DC(IIII)*VALINT
      FF(IIII)=FF(IIII)+ DO(JJJJ)*VALINT
      FF(IIJJ)=FF(IIJJ)+ DO(IIJJ)*VALINT
      FF(JJJJ)=FF(JJJJ)+ DO(IIII)*VALINT
      GO TO 110
C
C  (II/KL)  6=(33/21)
C
  206 IIII=IOFF(II+1)
      KKLL=IOFF(KK)+LL
      IIKK=IOFF(II)+KK
      IILL=IOFF(II)+LL
      FC(IIII)=FC(IIII)+(DC(KKLL)*TWO+DO(KKLL))*VALINT*TWO
      FC(KKLL)=FC(KKLL)+(DC(IIII)*TWO+DO(IIII))*VALINT
      FC(IIKK)=FC(IIKK)- DC(IILL)*VALINT
      FC(IILL)=FC(IILL)- DC(IIKK)*VALINT
      FF(IIKK)=FF(IIKK)+ DO(IILL)*VALINT
      FF(IILL)=FF(IILL)+ DO(IIKK)*VALINT
      GO TO 110
C
C  (IJ/KK)  7=(32/11)
C
  207 IIJJ=IOFF(II)+JJ
      KKKK=IOFF(KK+1)
      IIKK=IOFF(II)+KK
      JJKK=IOFF(JJ)+KK
      FC(IIJJ)=FC(IIJJ)+(DC(KKKK)*TWO+DO(KKKK))*VALINT
      FC(KKKK)=FC(KKKK)+(DC(IIJJ)*TWO+DO(IIJJ))*VALINT*TWO
      FC(IIKK)=FC(IIKK)- DC(JJKK)*VALINT
      FC(JJKK)=FC(JJKK)- DC(IIKK)*VALINT
      FF(IIKK)=FF(IIKK)+ DO(JJKK)*VALINT
      FF(JJKK)=FF(JJKK)+ DO(IIKK)*VALINT
      GO TO 110
C
C  (IJ/KK)  8=(31/22)
C
  208 IIJJ=IOFF(II)+JJ
      KKKK=IOFF(KK+1)
      IIKK=IOFF(II)+KK
      JJKK=JJ+IOFF(KK)
      FC(IIJJ)=FC(IIJJ)+(DC(KKKK)*TWO+DO(KKKK))*VALINT
      FC(KKKK)=FC(KKKK)+(DC(IIJJ)*TWO+DO(IIJJ))*VALINT*TWO
      FC(IIKK)=FC(IIKK)- DC(JJKK)*VALINT
      FC(JJKK)=FC(JJKK)- DC(IIKK)*VALINT
      FF(IIKK)=FF(IIKK)+ DO(JJKK)*VALINT
      FF(JJKK)=FF(JJKK)+ DO(IIKK)*VALINT
      GO TO 110
C
C (IJ/IL)  9=(32/31)
C
  209 IIJJ=IOFF(II)+JJ
      IILL=IOFF(II)+LL
      IIII=IOFF(II+1)
      JJLL=IOFF(JJ)+LL
      FC(IIJJ)=FC(IIJJ)+(DC(IILL)*THREE+DO(IILL)*TWO)*VALINT
      FC(IILL)=FC(IILL)+(DC(IIJJ)*THREE+DO(IIJJ)*TWO)*VALINT
      FC(IIII)=FC(IIII)- DC(JJLL)*VALINT*TWO
      FC(JJLL)=FC(JJLL)- DC(IIII)*VALINT
      FF(IIII)=FF(IIII)+ DO(JJLL)*VALINT*TWO
      FF(IILL)=FF(IILL)+ DO(IIJJ)*VALINT
      FF(IIJJ)=FF(IIJJ)+ DO(IILL)*VALINT
      FF(JJLL)=FF(JJLL)+ DO(IIII)*VALINT
      GO TO 110
C
C  (IJ/JL)  10=(32/21)
C
  210 IIJJ=IOFF(II)+JJ
      JJLL=IOFF(JJ)+LL
      IILL=IOFF(II)+LL
      JJJJ=IOFF(JJ+1)
      FC(IIJJ)=FC(IIJJ)+(DC(JJLL)*THREE+DO(JJLL)*TWO)*VALINT
      FC(JJLL)=FC(JJLL)+(DC(IIJJ)*THREE+DO(IIJJ)*TWO)*VALINT
      FC(IILL)=FC(IILL)- DC(JJJJ)*VALINT
      FC(JJJJ)=FC(JJJJ)- DC(IILL)*VALINT*TWO
      FF(IIJJ)=FF(IIJJ)+ DO(JJLL)*VALINT
      FF(IILL)=FF(IILL)+ DO(JJJJ)*VALINT
      FF(JJJJ)=FF(JJJJ)+ DO(IILL)*VALINT*TWO
      FF(JJLL)=FF(JJLL)+ DO(IIJJ)*VALINT
      GO TO 110
C
C  (IJ/KJ)  11=(31/21)
C
  211 IIJJ=IOFF(II)+JJ
      KKJJ=IOFF(KK)+JJ
      IIKK=IOFF(II)+KK
      JJJJ=IOFF(JJ+1)
      FC(IIJJ)=FC(IIJJ)+(DC(KKJJ)*THREE+DO(KKJJ)*TWO)*VALINT
      FC(KKJJ)=FC(KKJJ)+(DC(IIJJ)*THREE+DO(IIJJ)*TWO)*VALINT
      FC(IIKK)=FC(IIKK)- DC(JJJJ)*VALINT
      FC(JJJJ)=FC(JJJJ)- DC(IIKK)*VALINT*TWO
      FF(IIKK)=FF(IIKK)+ DO(JJJJ)*VALINT
      FF(IIJJ)=FF(IIJJ)+ DO(KKJJ)*VALINT
      FF(KKJJ)=FF(KKJJ)+ DO(IIJJ)*VALINT
      FF(JJJJ)=FF(JJJJ)+ DO(IIKK)*VALINT*TWO
      GO TO 110
C
C  (IJ/KL)     12=(43/21)
C  (IJ/KL)     13=(42/31)
C  (IJ/KL)     14=(41/32)
C
  212 IIJJ=IOFF(II)+JJ
      KKLL=IOFF(KK)+LL
      IIKK=IOFF(II)+KK
      JJLL=IOFF(MAX0(JJ,LL))+MIN0(JJ,LL)
      IILL=IOFF(II)+LL
      JJKK=IOFF(MAX0(JJ,KK))+MIN0(JJ,KK)
      FC(IIJJ)=FC(IIJJ)+(DC(KKLL)*TWO+DO(KKLL))*VALINT*TWO
      FC(KKLL)=FC(KKLL)+(DC(IIJJ)*TWO+DO(IIJJ))*VALINT*TWO
      FC(IIKK)=FC(IIKK)- DC(JJLL)*VALINT
      FC(JJLL)=FC(JJLL)- DC(IIKK)*VALINT
      FC(IILL)=FC(IILL)- DC(JJKK)*VALINT
      FC(JJKK)=FC(JJKK)- DC(IILL)*VALINT
      FF(IIKK)=FF(IIKK)+ DO(JJLL)*VALINT
      FF(JJLL)=FF(JJLL)+ DO(IIKK)*VALINT
      FF(IILL)=FF(IILL)+ DO(JJKK)*VALINT
      FF(JJKK)=FF(JJKK)+ DO(IILL)*VALINT
C
  110 CONTINUE
      GO TO 500
C
  501 CALL SREW(ITAP36)
C
      IF(IPRNT.LE.4) GO TO 306
      WRITE(6,6)
      CALL PRINT(FC,NTRI,NBASIS,6)
      WRITE(6,7)
      CALL PRINT(FF,NTRI,NBASIS,6)
C
C   ADD ONE ELECTRON PART
  306 CONTINUE
      CALL MREAD(H,15)
      WRITE(6,8)
      CALL PRINT(H,NTRI,NBASIS,6)
C
      DO 111 I=1,NTRI
  111 FC(I)=FC(I)+H(I)
C
C   TRANSFORM FOCK MATRICES FROM SO TO MO BASIS
      CALL MOCONV(FC,NBATRI,FT,NBATRI,ESO,U,T)
      CALL MOCONV(FF,NBATRI,FK,NBATRI,ESO,U,T)
C
C   FORM THE TOTAL FOCK MATRIX IN MO BASIS
      IJ=0
      DO 112 I=1,NBASIS
      DO 112 J=1,I
      IJ=IJ+1
      FT(IJ)=FT(IJ)+FK(IJ)*(OCC(I)+OCC(J)-THREE)*HALF
  112 CONTINUE
      CALL MWRIT(FK,25)
      IF(IPRNT.LE.2) GO TO 307
      WRITE(6,9)
      CALL PRINT(FT,NBATRI,NBASIS,6)
      WRITE(6,10)
      CALL PRINT(FK,NBATRI,NBASIS,6)
C
C   ROTATE FT MATRIX
  307 CONTINUE
      IC1=1
      IC2=IC1+NBFAO
      IC3=IC2+NBFAO
      IC4=IC3+NBFAO
      CALL ROTATE(EIG,OCC,FT,EE,EZ,CC(IC1),CC(IC2),CC(IC3),CC(IC4),
     1            0,NBASIS)
      IF(IPRNT.LE.2) GO TO 308
      WRITE(6,11)
      CALL EIGOUT(EE,EIG,OCC,NBFAO,NBFAO,NBASIS,NBASIS,6)
C
C   HIGH SPIN OPEN-SHELL MO'S IN SO BASIS
  308 DO 114 I=1,NBASIS
      DO 114 J=1,NBASIS
      VALU=A00
      DO 113 K=1,NBASIS
  113 VALU=VALU+ESO(I,K)*EE(K,J)
      EZ(I,J)=VALU
  114 CONTINUE
      DO 115 I=1,NBASIS
      DO 115 J=1,NBASIS
  115 ESO(I,J)=EZ(I,J)
      IF(IPRNT.LE.2) GO TO 309
      WRITE(6,12)
      CALL EIGOUT(ESO,EIG,OCC,NBFSO,NBASIS,NBASIS,NBASIS,6)
C
C   HIGH SPIN OPEN-SHELL MO'S IN AO BASIS
  309 DO 117 I=1,NBFAO
      DO 117 J=1,NBASIS
      VALU=A00
      DO 116 K=1,NBFSO
  116 VALU=VALU+UAS(I,K)*ESO(K,J)
      EAO(I,J)=VALU
  117 CONTINUE
      IF(IPRNT.LE.2) GO TO 310
      WRITE(6,13)
      CALL EIGOUT(EAO,EIG,OCC,NBFAO,NBASIS,NBFAO,NBASIS,6)
C
C   FORM THE LARGRANGIAN MATRIX IN MO BASIS
  310 CONTINUE
      CALL ZERO(WM,NTRI)
      DO 121 I=1,JOCC
      II=IOFF(I+1)
  121 WM(II)=EIG(I)*OCC(I)
      DO 122 I=1,JOCC
      DO 122 J=1,I
      IJ=IOFF(I)+J
      FAC=OCC(I)*OCC(J)*HALF
      WM(IJ)=WM(IJ)-FK(IJ)*FAC
  122 CONTINUE
      CALL MWRIT(WM,25)
      IF(IPRNT.LE.2) GO TO 312
      WRITE(6,14)
      CALL PRINT(WM,NBATRI,NBASIS,6)
C
C   TRANSFORM THE LAGRANGIAN MATRIX FROM MO TO AO BASIS
  312 CONTINUE
      DO 125 I=1,NBASIS
      DO 125 J=1,I
      IJ=IOFF(I)+J
      T(I,J)=WM(IJ)
      T(J,I)=WM(IJ)
  125 CONTINUE
      DO 127 I=1,NBASIS
      DO 127 JJ=1,NBFAO
      VALU=A00
      DO 126 J=1,NBASIS
      VALU=VALU+EAO(JJ,J)*T(I,J)
  126 CONTINUE
      U(I,JJ)=VALU
  127 CONTINUE
      DO 129 II=1,NBFAO
      DO 129 JJ=1,II
      IIJJ=IOFF(II)+JJ
      VALU=A00
      DO 128 I=1,NBASIS
      VALU=VALU+EAO(II,I)*U(I,JJ)
  128 CONTINUE
      WA(IIJJ)=VALU
  129 CONTINUE
      CALL MWRIT(WA,24)
      IF(IPRNT.LE.2) GO TO 313
      WRITE(6,15)
      CALL PRINT(WA,NBATRI,NBFAO,6)
C
C   FORM DENSITY MATRICES IN AO BASIS
  313 CONTINUE
      IJ=0
      DO 133 I=1,NBFAO
      DO 133 J=1,I
      IJ=IJ+1
      VALC=A00
      VALO=A00
      DO 131 K=1,IOCC
  131 VALC=VALC+EAO(I,K)*EAO(J,K)
      DC(IJ)=VALC
      DO 132 K=IOCC+1,JOCC
  132 VALO=VALO+EAO(I,K)*EAO(J,K)
      DO(IJ)=VALO
  133 CONTINUE
      IF(IPRNT.LE.2) GO TO 315
      WRITE(6,16)
      CALL PRINT(DC,NBATRI,NBFAO,6)
      WRITE(6,17)
      CALL PRINT(DO,NBATRI,NBFAO,6)
C
  315 CONTINUE
      RETURN
      END
