C
C-----------------------------------------------------------------------
C
      SUBROUTINE RQTERM(Z1,Z2,Z1O,Z2O,RMAT,QMAT,IOFF,NO,NV,NO2,NV2,NTRO,
     .                  NTRV,NTR,JOUT,INO,INTRO,INTRV,NOV,INV,N2OV,ZLX,
     .                  UOFF,FLOV,ORBSYM,NIRRED,SUX1,SUX2,AR1,AR2,
     .                  TOFF,TADD,NDIMT2,FZO,FZV)
      IMPLICIT INTEGER(A-Z)
      COMMON/NEWPAR/NAB(8),NAI(8),NIJ(8),MAXOO,MAXVV,MAXOV
      REAL*8 Z2O(NDIMT2),Z2(NDIMT2),Z1(NO,NV),Z1O(NO,NV),
     .       RMAT(NV*NO),QMAT(NO*NV),VAL1,VAL2
      INTEGER IOFF(NTR),FZO(*),FZV(*)
      INTEGER INO(NOV),INTRO(N2OV),INTRV(NO*NV),INV(NOV)
      INTEGER ZLX(NV,NV),UOFF(NO,NO,2)
      INTEGER TOFF(NO,NO,2),TADD(NV,NV)
      DIMENSION FLOV(NIRRED,4),ORBSYM(NO+NV)
      COMMON/TAPES/TPBMAT,TPFMAT,TPHMAT,TPRMAT,TPQMAT,TPJMAT,ITAP71,
     .             TPAMAT
      REAL*8 SUX1(NV*NV),SUX2(NV*NV),AR1(MAXOV,MAXOV),AR2(MAXOV,MAXOV)
C
      CALL RFILE(TPRMAT)
      CALL RFILE(TPQMAT)
      POINTR=1
      POINTQ=1
      DO 16695 TSYM=1,NIRRED
      IDIM=NAI(TSYM)
      XVG=0
      DO 16790 GA=1,NV
      IF(FZV(GA).EQ.1)GO TO 16790
      GASYM=ORBSYM(GA+NO)
      DO 16770 V=1,NO
      IF(FZO(V).EQ.1)GO TO 16770
      VSYM=ORBSYM(V)
      VGASYM=IEOR(VSYM,GASYM)
      IF(VGASYM.NE.TSYM-1)GO TO 16770
      XVG=XVG+1
      XAI=0
      DO 16750 A=1,NV
      IF(FZV(A).EQ.1)GO TO 16750
      ASYM=ORBSYM(A+NO)
      ISYM=IEOR(ASYM,VGASYM)+1
      ZL=ZLX(GA,A)
      FI=FLOV(ISYM,1)
      LI=FLOV(ISYM,2)
      DO 16730 I=FI,LI
      XAI=XAI+1
      IVGAA=TOFF(I,V,ZL)+TADD(GA,A)
      VIGAA=TOFF(V,I,ZL)+TADD(GA,A)
      AR1(XAI,XVG)=Z2O(IVGAA)+Z2O(IVGAA)+Z2O(VIGAA)
      AR2(XAI,XVG)=Z2O(VIGAA)
16730 CONTINUE
16750 CONTINUE
16770 CONTINUE
16790 CONTINUE
      LIM=XVG
C
      DO 16690 BE=1,NV
      IF(FZV(BE).EQ.1)GO TO 16690
      BESYM=ORBSYM(BE+NO)
      DO 16680 U=1,NO
      IF(FZO(U).EQ.1)GO TO 16680
      USYM=ORBSYM(U)
      BEUSYM=IEOR(BESYM,USYM)
      IF(BEUSYM.NE.TSYM-1)GO TO 16680
      CALL WREADW(TPRMAT,RMAT,INTOWP(IDIM),POINTR,POINTR)
      CALL WREADW(TPQMAT,QMAT,INTOWP(IDIM),POINTQ,POINTQ)
      ICNT2=0
C
      DO 15661 VGA=1,LIM
      VAL1=0.0D0
      VAL2=0.0D0
      DO 15391 AI=1,LIM
      VAL1=VAL1+RMAT(AI)*AR1(AI,VGA)
      VAL2=VAL2+QMAT(AI)*AR2(AI,VGA)
15391 CONTINUE
      SUX1(VGA)= 0.5D0*VAL1
      SUX2(VGA)= 0.5D0*VAL2
15661 CONTINUE
C
      VGA=0
      DO 15660 GA=1,NV
      IF(FZV(GA).EQ.1)GO TO 15660
      GASYM=ORBSYM(GA+NO)
      VSYM=IEOR(GASYM,BEUSYM)+1
      FV=FLOV(VSYM,1)
      LV=FLOV(VSYM,2)
      DO 15410  V=FV,LV
      VGA=VGA+1
 
C
      IF(BE.GE.GA)THEN
      UVBEGA=TOFF(U,V,1)+TADD(BE,GA)
      VUBEGA=TOFF(V,U,1)+TADD(BE,GA)
      Z2(UVBEGA)=Z2(UVBEGA)-SUX2(VGA)-SUX2(VGA)
      Z2(VUBEGA)=Z2(VUBEGA)+SUX2(VGA)+SUX1(VGA)
      ENDIF
      IF(BE.LE.GA)THEN
      UVGABE=TOFF(U,V,1)+TADD(GA,BE)
      VUGABE=TOFF(V,U,1)+TADD(GA,BE)
      Z2(VUGABE)=Z2(VUGABE)-SUX2(VGA)-SUX2(VGA)
      Z2(UVGABE)=Z2(UVGABE)+SUX2(VGA)+SUX1(VGA)
      ENDIF
15410 CONTINUE
C
15660 CONTINUE
            DO 90 GA=1,NV
               IF(FZV(GA).EQ.1)GO TO 90
               GASYM=ORBSYM(GA+NO)
               VSYM=IEOR(GASYM,BEUSYM)+1
               FV=FLOV(VSYM,1)
               LV=FLOV(VSYM,2)
               DO 100 V=FV,LV
                  ICNT2=ICNT2+1
                  VAL1=QMAT(ICNT2)*Z1O(V,GA)
                  Z1(U,BE)=Z1(U,BE)-VAL1
  100          CONTINUE
   90       CONTINUE
  110    CONTINUE
   20    CONTINUE
   10 CONTINUE
16680 CONTINUE
16690 CONTINUE
16695 CONTINUE
      CALL RCLOSE(TPRMAT,3)
      CALL RCLOSE(TPQMAT,3)
C
      RETURN
      END
