      SUBROUTINE ADDTO (ITYP,NORBS,NC,NO,NLAMDA,IJL,IJU,ALPHA,BETA
     1,                 SU,CM,NSO,NST)
C
C
C
      IMPLICIT REAL*8 (A-H,O-Z)
C
C
      integer nsym,nst
      INTEGER NORBS(NSYM),NC(NST),NO(NST),NLAMDA(NSYM)
      INTEGER IJL(NSYM),IJU(NSYM),ITYP(20),NSO(NST)
      REAL*8 ALPHA(1),BETA(1),SU(1),CM(2,1),REPNUC
      REAL*8 THRSH,EPS,FMT
      INTEGER ALABEL,BLABEL,ALBL2,BLBL2
      INTEGER PRINT
      CHARACTER*80 LINE
      LOGICAL TWOCON,IPOPLE
      DIMENSION MAP(21), IXTI(40),ALBL2(26),BLBL2(26)
C
      COMMON /POP/ IPOPLE
      COMMON /GVB/ ALPHA1,ALPHA2,ALPHA3,IJUP,TWOCON
      COMMON /TAPES/ NIN,IR,IOUT,ICHECK,IFLAG3,ITAPE,I30
      COMMON /PRINTQ/ PRINT
      COMMON /CORE/ NCOR
      COMMON /IFDMP/ DAMPSV,INFLG,MICMX,IDFIX
      COMMON /SCFIN/ REPNUC,IOPEN,ISCF,IPRCT,IVECT,NBFLD,ICUT
      COMMON /FLAGS/ IDEBUG,ISTO,IPUNCH,ISAVE,IRORDR
      COMMON /INPT/  NSYM,IPMAX,NMAT,ITMAX,NSFMAX,NTOTAL,MXCOEF,MSFRU
      COMMON /NEWRUN/ ITPREP,ITCON
      COMMON /ABOPEN/ MM
      COMMON /HOLL/ BLABEL(20),ALABEL(26),FMT(10),JL
      COMMON /DIM21/ IPQ(256)
C
      DATA NCOL/10/,A0 /0.0D+00/
C
C
C
      IF (INFLG.LT.0) THEN
         DO 1 I=1,MXCOEF
            SU(I)=0.0D+00
    1    CONTINUE
      END IF
C
C
C
      N=0
      DO 10 L=1,NST
         IF (NSO(L).LE.0) GO TO 10
         N=N+1
         NLAMDA(N)=NSO(L)
C        IF (INFLG.LE.0) THEN
         ITYP(N)=ITYP(L)
         NC(N)=NC(L)
         NO(N)=NO(L)
C        END IF
   10 CONTINUE
C
C
      IPMAX=0
      IDMAX=0
      MM=0
      DO 50 L=1,NSYM
         NORBS(L)=NC(L)+NO(L)
C        IF (INFLG.GT.0) GO TO 40
         IPMIN=IPMAX+1
         IPMAX=IPMAX+NLAMDA(L)
         DO 25 I=IPMIN,IPMIN+NC(L)-1
            CM(1,I)=2.0D+00
            CM(2,I)=0.0D+00
   25    CONTINUE
         DO 26 I=IPMIN+NC(L),IPMIN+NORBS(L)-1
            CM(2,I)=1.0D+00
            CM(1,I)=0.0D+00
   26    CONTINUE
         DO 27 I=IPMIN+NORBS(L),IPMAX
            CM(1,I)=0.0D+00
            CM(2,I)=0.0D+00
   27    CONTINUE
   40    CONTINUE
         IF (NORBS(L).LE.0) NORBS(L)=1
         IF (NO(L).NE.0) THEN
            MM=MM+1
            IJL(MM)=IDMAX+1
            IJU(MM)=IDMAX+NLAMDA(L)*(NLAMDA(L)+1)/2
         END IF
         IDMAX=IDMAX+NLAMDA(L)*(NLAMDA(L)+1)/2
   50 CONTINUE
C
      IJUP=IJU(1)
C
C
      IF (INFLG.LT.0) THEN
         I=1
         DO 60 L=1,NSYM
            DO 55 J=1,NLAMDA(L)
               SU(I)=1.0
               I=I+NLAMDA(L)+1
   55       CONTINUE
            I=I-NLAMDA(L)
   60    CONTINUE
      END IF
C
C
C
      IF (IAND(PRINT,256) .EQ. 0) RETURN
      PRINT 4200
      I=1
      DO 130 L=1,NSYM
         MAXP=NLAMDA(L)
         DO 130 NP=1,MAXP
            DO 130 NQ=1,NP
               MAP(I)=L
               MAP(I+1) = NP
               MAP(I+2) = NQ
               IF(I.GE.19)GOTO140
               GOTO150
  140          PRINT4300,MAP
               I=1
               GOTO130
  150          I=I+3
  130 CONTINUE
      IF(I.LE.3) RETURN
      IM1=I-1
      PRINT4300,(MAP(J),J=1,IM1)
      RETURN
C                        FORMAT STATEMENTS
 1000 FORMAT(26A3)
 1001 FORMAT(A3,1X)
 2000 FORMAT(/1H ,6X,6HIRREP ,A3,1X,19X,20HORBITAL COEFFICIENTS)
 2500 FORMAT(30H NUMBER OF ELECTRONS OCCUPYING/
     124H CLOSED SHELL ORBITALS =,F6.1,9F11.1)
 3500 FORMAT(22X,10F11.6)
 4200 FORMAT(24H MATRIX MAP - LAMBDA,P,Q)
 4300 FORMAT(7(5X,2(I2,1H,),I2,5X))
 5000 FORMAT(30H NUMBER OF ELECTRONS OCCUPYING/
     122H OPEN SHELL ORBITALS =,F8.1,9F11.1)
 5100 FORMAT(40H DENSITY MATRIX CONVERGENCE CRITERION = ,
     11PE8.1/36H ITERATIONS BEFORE EXTRAPOLATION =  ,I2)
 5200 FORMAT(21X,10(6X,2HC(,I2,1H)))
 5500 FORMAT(5X,I2,1H,,I2,14X,F12.8,5X,F12.8)
 5600 FORMAT(31H OPEN-SHELL ENERGY COEFFICIENTS/16H OPEN SHELL PAIR,12X,
     15HALPHA,12X,4HBETA)
 5800 FORMAT(31H NEW STATE - SAME CONFIGURATION)
 6410 FORMAT(20I4)
 6420 FORMAT(2F20.10)
 6430 FORMAT(20F4.0)
 6450 FORMAT(27H NUCLEAR REPULSION ENERGY =,F20.13)
 6500 FORMAT(1H /(10X,26A3))
 6501 FORMAT(/10X,26A3)
      END
