      SUBROUTINE TWOI(PA,PB,PC,LBLINT,LBLI,PKI,VAL1,VAL2,alpha,beta,ijl,
     #                iju,obuf,buf,inbuf,inext,intmx,psize)
C
C
C
      IMPLICIT REAL*8 (A-H,O-Z)
C
C
      LOGICAL CNTNUE
      INTEGER START,END,START1,END1
      REAL*8 PA(1),PB(1),PC(1),PKI(1),VAL1(1),VAL2(1)
      COMMON /KIND/ NKIND,ICLOS
      COMMON/STIMEX/KTIMES,ITIME5,ITIME6,ITIME7,ITIME8,ICONT5,ICONT6,
     1ICONT7,ICONT8,ITIMED,ICONTD,ITEMPT
      COMMON/SCTRS/ISECT,MXISEC
      COMMON /TAPES/ NIN,IR,IOUT,ICHECK,IFLAG3,ITAPE,I30
      COMMON/SIGNS/IOFF(200),MASK,IPRNT
      COMMON/SYMMS/ND(10),LLSYM(10)
      COMMON/PASS1/IBL,NINT,INTI,NBLI,INTO,NBLO,NEWBUF
      COMMON/PASS2/PKII,III,ISM,JSM,KSM,LSM,IOR,JOR,KOR,LOR
      COMMON/TIMX/ITIME,ICONT0,JCOUNT,ITIME2,ICONT2,ITIME3,ICONT3,
     1ITIME4,ICONT4,ITIME1,ICONT1
CRBR   DIMENSION OF LBLI = SIZE/INTOWP(1) = 8942/2 = 4471
      DIMENSION LBLINT(1),LBLI(4471)
    2 FORMAT(1H ,'ILSTI = ',I5,/,1H ,'NBUF = ',I5)
    4 FORMAT(2X,2(Z7,2X),9(2X,I5),2X,1PE14.6,2(2X,I5))
  987 FORMAT(1X,4I3,E25.12)
C
CSEL  CALL ETIME2(START1)
CSEL  CALL ETIME2(START)
c     iprnt=6
      ICONT6=ICONT6+1
      IBL=0
      INTI=0
      INTO=0
      NBLI=0
      NBLO=0
      NINT=0
      NEWBUF=0
      IBUFSZ=8942
      INTTYP=1
      IF(NKIND.EQ.1) INTTYP=3
      IF(NKIND.EQ.2.AND.ICLOS.EQ.1) IBUFSZ=5962
      NSECT=(IBUFSZ+63)/64
    5 NBLI=NBLI+1
      ISECT=ISECT+NSECT
C     IF (ISECT.GT.MXISEC) THEN
C     WRITE (IOUT,'(' HAVE READ',I6,' SECTORS FROM FILE',I2,' AND WILL',
C    1 ' START ON FILE',I2)') ISECT-(8942+63)/64,ITAPE,ITAPE+1
C     ISECT=(8942+63)/64
C     ITAPE=ITAPE+1
C     CALL SFILE(ITAPE)
C     CALL SREW(ITAPE)
C     END IF
      CALL SREAD(ITAPE,LBLI,IBUFSZ)
      NBUF=LBLI(2)
      ILSTI=LBLI(1)
      IF(IPRNT.NE.0) WRITE(ICHECK,2) ILSTI,NBUF
c     write(6,*)'reading buffer, nbuf,ilsti=',nbuf,ilsti
c     write(6,*)'nkind, inttyp',nkind,inttyp
c     call flush(6)
      GO TO (10,20,30) INTTYP
   10 CONTINUE
      DO 11 I=1,NBUF
         LBLINT(I+I-1)=LBLI(I+1492)
         LBLINT(I+I)=LBLI(I+2)
         VAL1(I)=PKI(I+1491)
         VAL2(I)=PKI(I+2981)
   11 CONTINUE
      NINT=NBUF
      CALL HUSTON(ALPHA,BETA,IJL,IJU,VAL1,VAL2,OBUF,BUF,INBUF
     1,                 PA,PB,PC,LBLINT,VAL0)
      GO TO 50
   20 CONTINUE
      DO 21 I=1,NBUF
         LBLINT(I+I-1)=LBLI(I+1492)
         LBLINT(I+I)=LBLI(I+2)
         VAL1(I)=PKI(I+1491)
         VAL2(I)=0.0D+00
   21 CONTINUE
      NINT=NBUF
      CALL HUSTON(ALPHA,BETA,IJL,IJU,VAL1,VAL2,OBUF,BUF,INBUF
     1,                 PA,PB,PC,LBLINT,VAL0)
      GO TO 50
   30 DO 45 I=1,NBUF
C     LOR=LBLI(2*I+2).SHIFT.-2
C     LSM=LOR.SHIFT.-8
C     KOR=LSM.SHIFT.-3
C     KSM=(KOR.SHIFT.-8)+1
C     KOR=KOR.AND.'377
C     LSM=(LSM.AND.'7)+1
C     LOR=LOR.AND.'377
C     III=LBLI(2*I+2).AND.'3
C     JSM=LBLI(2*I+1).SHIFT.-8
C     IOR=JSM.SHIFT.-3
C     ISM=(IOR.SHIFT.-8)+1
C     IOR=IOR.AND.'377
C     JSM=(JSM.AND.'7)+1
         LOR=ISHFT(LBLI(2*I+2),-2)
         LSM=ISHFT(LOR,-8)
         KOR=ISHFT(LSM,-3)
         KSM=ISHFT(KOR,-8) + 1
         KOR=IAND(KOR,255)
         LSM=IAND(LSM,7) + 1
         LOR=IAND(LOR,255)
         III=IAND(LBLI(2*I+2),3)
         JSM=ISHFT(LBLI(2*I+1),-8)
         IOR=ISHFT(JSM,-3)
         ISM=ISHFT(IOR,-8) + 1
         IOR=IAND(IOR,255)
         JSM=IAND(JSM,7) + 1
C     JOR=LBLI(2*I+1).AND.'377
         JOR=IAND(LBLI(2*I+1),255)
         PKII=PKI(I+2236)
         IF(IPRNT.EQ.0) GO TO 35
cges  get into this if loop to print ao ints from 34
         IJ=IOFF(IOR)+JOR+LLSYM(ISM)
         IF(IOR.LT.JOR) IJ=IOFF(JOR)+IOR+LLSYM(JSM)
         KL=IOFF(KOR)+LOR+LLSYM(KSM)
         IF(KOR.LT.LOR) KL=IOFF(LOR)+KOR+LLSYM(LSM)
C     WRITE(ICHECK,4) LBLI(2*I+2),LBLI(2*I+1),III,IOR,ISM,JOR,JSM,KOR,
C    1 KSM,LOR,LSM,PKI(I+2236),IJ,KL
         WRITE (6,987) IOR,JOR,KOR,LOR,PKI(I+2236)
CSEL       CALL ETIME2(END1)
         ITIME6=ITIME6+END1-START1
   35    CALL DALLAS(PA,PB,PC,LBLINT,INEXT,INTMX,PSIZE)
         IF(III.EQ.0.OR.NINT.EQ.0) GO TO 45
         DO 40 J=1,NINT
            VAL2(J)=0.25*(PB(J)+PC(J))
            VAL1(J)=PA(J)-VAL2(J)
cges       write(6,'(i6,5f12.6)')j,pa(j),pb(j),pc(j),val1(j),val2(j)
cges       call flush(6)
   40    CONTINUE
         CALL HUSTON(ALPHA,BETA,IJL,IJU,VAL1,VAL2,OBUF,BUF,INBUF
     1,                 PA,PB,PC,LBLINT,VAL0)
         NEWBUF=0
   45 CONTINUE
CSEL  CALL ETIME2(START1)
   50 CONTINUE
      INTI=INTI+NBUF
      IF(ILSTI.EQ.0) GO TO 5
C
      IFLAGO=IBL
      NBLO=NBLO+1
      INTO=INTO+IBL
C     WRITE(IOUT,'('  HAVE READ',I6,' SECTORS FROM FILE',I2,' AS THE LAS
C    1T FILE ')')ISECT,ITAPE
C     IF(IFLAG3.GT.0)WRITE(ICHECK,'(' HAVE READ',I6,' SECTORS FROM FILE'
C    1,I2,' AS THE LAST FILE')')ISECT,ITAPE
C
CSEL  CALL ETIME2(END1)
CSEL  CALL ETIME2(END)
      KTIMES=KTIMES+END-START
      ITIME6=ITIME6+END1-START1
      RETURN
      END
