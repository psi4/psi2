      SUBROUTINE mbmat(b,d,m,nn,iset)
      IMPLICIT REAL*8 (A-H,O-Z)
      DIMENSION D(6),D2(6),DC(6),M(6),M2(6),MC(6)
      COMMON/BASIS/NBASIS,NBFAO,NBATRI,NBATR2
      COMMON/CENTR/NCENTR
CTPH  COMMON/DERIN/DERINT(1296,3,3)
C11-14-88  (For  7Mb) COMMON/DERIN/DERINT(10000,9)
C11-14-88  (For 15Mb) COMMON/DERIN/DERINT(50625,9)
      COMMON/DERIN/DERINT(10000,3,3)
      COMMON/FUNCS/NTYPES,NTYPEP,NTREAD,NATOM,N3N,NATRI,NSYM
      COMMON/PARA3/NATMS(4),NPASS
      COMMON/TOLER/DLIM
      DIMENSION B(NBATRI,3,NATOM,NTREAD)
      DATA ZERO / 0.0D+00 /
C
      DO 104 IXYZ=1,3
      TEMP=ZERO
      DO 102 I=1,NCENTR-1
      T=DERINT(NN,IXYZ,I)
      TEMP=TEMP+T
      IATOM=NATMS(I)
      DO 101 J=1,6
      B(M(J),IXYZ,IATOM,ISET)=B(M(J),IXYZ,IATOM,ISET)+T*D(J)
ctph  write(6,*) 'b  iatom  iset ',b(m(j),ixyz,iatom,iset),iatom,iset
ctph  write(6,*) 't d j nn ixyz i',t,d(j),j,nn,ixyz,i
  101 CONTINUE
  102 CONTINUE
C
C   USE TRANSLATIONAL INVARIANCE FOR LAST ATOM
      IATOM=NATMS(NCENTR)
      DO 103 J=1,6
      B(M(J),IXYZ,IATOM,ISET)=B(M(J),IXYZ,IATOM,ISET)-TEMP*D(J)
  103 CONTINUE
C
  104 CONTINUE
C
      RETURN
      end
