      SUBROUTINE FORME2(D2T)
      IMPLICIT REAL*8 (A-H,O-Z)
      COMMON/D2INT/DXIDXI,DXIDXJ,DXIDXK,
     1             DXJDXJ,DXJDXK,DXKDXK,
     2             DYIDYI,DYIDYJ,DYIDYK,
     3             DYJDYJ,DYJDYK,DYKDYK,
     4             DZIDZI,DZIDZJ,DZIDZK,
     5             DZJDZJ,DZJDZK,DZKDZK,
     6             DXIDYI,DXJDYI,DXKDYI,
     7             DXIDYJ,DXJDYJ,DXKDYJ,
     8             DXIDYK,DXJDYK,DXKDYK,
     9             DXIDZI,DXJDZI,DXKDZI,
     A             DXIDZJ,DXJDZJ,DXKDZJ,
     B             DXIDZK,DXJDZK,DXKDZK,
     C             DYIDZI,DYJDZI,DYKDZI,
     D             DYIDZJ,DYJDZJ,DYKDZJ,
     E             DYIDZK,DYJDZK,DYKDZK
      COMMON/FUNCS/NTYPES,NTYPEP,NTREAD,NATOM,N3N,NATRI,NSYM
      COMMON/PARA3/NATMS(4),NPASS
      COMMON/TOLER/DLIM
      DIMENSION D2T(N3N,N3N)
C
      IF(NPASS.EQ.1) THEN
      I=(NATMS(1)-1)*3
      J=(NATMS(2)-1)*3
      K=(NATMS(3)-1)*3
      L=(NATMS(4)-1)*3
C
      D2T(I+1,I+1)=D2T(I+1,I+1)+DXIDXI
      D2T(I+1,I+2)=D2T(I+1,I+2)+DXIDYI
      D2T(I+1,I+3)=D2T(I+1,I+3)+DXIDZI
C
      D2T(I+1,J+1)=D2T(I+1,J+1)+DXIDXJ
      D2T(I+1,J+2)=D2T(I+1,J+2)+DXIDYJ
      D2T(I+1,J+3)=D2T(I+1,J+3)+DXIDZJ
C
      D2T(I+1,K+1)=D2T(I+1,K+1)+DXIDXK
      D2T(I+1,K+2)=D2T(I+1,K+2)+DXIDYK
      D2T(I+1,K+3)=D2T(I+1,K+3)+DXIDZK
C
      D2T(I+1,L+1)=D2T(I+1,L+1)-DXIDXI-DXIDXJ-DXIDXK
      D2T(I+1,L+2)=D2T(I+1,L+2)-DXIDYI-DXIDYJ-DXIDYK
      D2T(I+1,L+3)=D2T(I+1,L+3)-DXIDZI-DXIDZJ-DXIDZK
C
      D2T(I+2,I+2)=D2T(I+2,I+2)+DYIDYI
      D2T(I+2,I+3)=D2T(I+2,I+3)+DYIDZI
C
      D2T(I+2,J+1)=D2T(I+2,J+1)+DXJDYI
      D2T(I+2,J+2)=D2T(I+2,J+2)+DYIDYJ
      D2T(I+2,J+3)=D2T(I+2,J+3)+DYIDZJ
C
      D2T(I+2,K+1)=D2T(I+2,K+1)+DXKDYI
      D2T(I+2,K+2)=D2T(I+2,K+2)+DYIDYK
      D2T(I+2,K+3)=D2T(I+2,K+3)+DYIDZK
C
      D2T(I+2,L+1)=D2T(I+2,L+1)-DXIDYI-DXJDYI-DXKDYI
      D2T(I+2,L+2)=D2T(I+2,L+2)-DYIDYI-DYIDYJ-DYIDYK
      D2T(I+2,L+3)=D2T(I+2,L+3)-DYIDZI-DYIDZJ-DYIDZK
C
      D2T(I+3,I+3)=D2T(I+3,I+3)+DZIDZI
C
      D2T(I+3,J+1)=D2T(I+3,J+1)+DXJDZI
      D2T(I+3,J+2)=D2T(I+3,J+2)+DYJDZI
      D2T(I+3,J+3)=D2T(I+3,J+3)+DZIDZJ
C
      D2T(I+3,K+1)=D2T(I+3,K+1)+DXKDZI
      D2T(I+3,K+2)=D2T(I+3,K+2)+DYKDZI
      D2T(I+3,K+3)=D2T(I+3,K+3)+DZIDZK
C
      D2T(I+3,L+1)=D2T(I+3,L+1)-DXIDZI-DXJDZI-DXKDZI
      D2T(I+3,L+2)=D2T(I+3,L+2)-DYIDZI-DYJDZI-DYKDZI
      D2T(I+3,L+3)=D2T(I+3,L+3)-DZIDZI-DZIDZJ-DZIDZK
C
      D2T(J+1,J+1)=D2T(J+1,J+1)+DXJDXJ
      D2T(J+1,J+2)=D2T(J+1,J+2)+DXJDYJ
      D2T(J+1,J+3)=D2T(J+1,J+3)+DXJDZJ
C
      D2T(J+1,K+1)=D2T(J+1,K+1)+DXJDXK
      D2T(J+1,K+2)=D2T(J+1,K+2)+DXJDYK
      D2T(J+1,K+3)=D2T(J+1,K+3)+DXJDZK
C
      D2T(J+1,L+1)=D2T(J+1,L+1)-DXIDXJ-DXJDXJ-DXJDXK
      D2T(J+1,L+2)=D2T(J+1,L+2)-DXJDYI-DXJDYJ-DXJDYK
      D2T(J+1,L+3)=D2T(J+1,L+3)-DXJDZI-DXJDZJ-DXJDZK
C
      D2T(J+2,J+2)=D2T(J+2,J+2)+DYJDYJ
      D2T(J+2,J+3)=D2T(J+2,J+3)+DYJDZJ
C
      D2T(J+2,K+1)=D2T(J+2,K+1)+DXKDYJ
      D2T(J+2,K+2)=D2T(J+2,K+2)+DYJDYK
      D2T(J+2,K+3)=D2T(J+2,K+3)+DYJDZK
C
      D2T(J+2,L+1)=D2T(J+2,L+1)-DXIDYJ-DXJDYJ-DXKDYJ
      D2T(J+2,L+2)=D2T(J+2,L+2)-DYIDYJ-DYJDYJ-DYJDYK
      D2T(J+2,L+3)=D2T(J+2,L+3)-DYJDZI-DYJDZJ-DYJDZK
C
      D2T(J+3,J+3)=D2T(J+3,J+3)+DZJDZJ
C
      D2T(J+3,K+1)=D2T(J+3,K+1)+DXKDZJ
      D2T(J+3,K+2)=D2T(J+3,K+2)+DYKDZJ
      D2T(J+3,K+3)=D2T(J+3,K+3)+DZJDZK
C
      D2T(J+3,L+1)=D2T(J+3,L+1)-DXIDZJ-DXJDZJ-DXKDZJ
      D2T(J+3,L+2)=D2T(J+3,L+2)-DYIDZJ-DYJDZJ-DYKDZJ
      D2T(J+3,L+3)=D2T(J+3,L+3)-DZIDZJ-DZJDZJ-DZJDZK
C
      D2T(K+1,K+1)=D2T(K+1,K+1)+DXKDXK
      D2T(K+1,K+2)=D2T(K+1,K+2)+DXKDYK
      D2T(K+1,K+3)=D2T(K+1,K+3)+DXKDZK
C
      D2T(K+1,L+1)=D2T(K+1,L+1)-DXIDXK-DXJDXK-DXKDXK
      D2T(K+1,L+2)=D2T(K+1,L+2)-DXKDYI-DXKDYJ-DXKDYK
      D2T(K+1,L+3)=D2T(K+1,L+3)-DXKDZI-DXKDZJ-DXKDZK
C
      D2T(K+2,K+2)=D2T(K+2,K+2)+DYKDYK
      D2T(K+2,K+3)=D2T(K+2,K+3)+DYKDZK
C
      D2T(K+2,L+1)=D2T(K+2,L+1)-DXIDYK-DXJDYK-DXKDYK
      D2T(K+2,L+2)=D2T(K+2,L+2)-DYIDYK-DYJDYK-DYKDYK
      D2T(K+2,L+3)=D2T(K+2,L+3)-DYKDZI-DYKDZJ-DYKDZK
C
      D2T(K+3,K+3)=D2T(K+3,K+3)+DZKDZK
C
      D2T(K+3,L+1)=D2T(K+3,L+1)-DXIDZK-DXJDZK-DXKDZK
      D2T(K+3,L+2)=D2T(K+3,L+2)-DYIDZK-DYJDZK-DYKDZK
      D2T(K+3,L+3)=D2T(K+3,L+3)-DZIDZK-DZJDZK-DZKDZK
C
      D2T(L+1,L+1)=D2T(L+1,L+1)+DXIDXI+DXIDXJ+DXIDXK+DXIDXJ+DXJDXJ
     #                         +DXJDXK+DXIDXK+DXJDXK+DXKDXK
      D2T(L+1,L+2)=D2T(L+1,L+2)+DXIDYI+DXIDYJ+DXIDYK+DXJDYI+DXJDYJ
     #                         +DXJDYK+DXKDYI+DXKDYJ+DXKDYK
      D2T(L+1,L+3)=D2T(L+1,L+3)+DXIDZI+DXIDZJ+DXIDZK+DXJDZI+DXJDZJ
     #                         +DXJDZK+DXKDZI+DXKDZJ+DXKDZK
C
      D2T(L+2,L+2)=D2T(L+2,L+2)+DYIDYI+DYIDYJ+DYIDYK+DYIDYJ+DYJDYJ
     #                         +DYJDYK+DYIDYK+DYJDYK+DYKDYK
      D2T(L+2,L+3)=D2T(L+2,L+3)+DYIDZI+DYIDZJ+DYIDZK+DYJDZI+DYJDZJ
     #                         +DYJDZK+DYKDZI+DYKDZJ+DYKDZK
C
      D2T(L+3,L+3)=D2T(L+3,L+3)+DZIDZI+DZIDZJ+DZIDZK+DZIDZJ+DZJDZJ
     #                         +DZJDZK+DZIDZK+DZJDZK+DZKDZK
C
      ELSE IF(NPASS.EQ.2) THEN
      I=(NATMS(1)-1)*3
      J=(NATMS(2)-1)*3
      K=(NATMS(3)-1)*3
      IF(I.EQ.J) THEN
      D2T(I+1,I+1)=D2T(I+1,I+1)+DXIDXJ
      D2T(I+2,I+2)=D2T(I+2,I+2)+DYIDYJ
      D2T(I+3,I+3)=D2T(I+3,I+3)+DZIDZJ
      END IF
C
      D2T(I+1,I+1)=D2T(I+1,I+1)+DXIDXI
      D2T(I+1,I+2)=D2T(I+1,I+2)+DXIDYI
      D2T(I+1,I+3)=D2T(I+1,I+3)+DXIDZI
C
      D2T(I+1,J+1)=D2T(I+1,J+1)+DXIDXJ
      D2T(I+1,J+2)=D2T(I+1,J+2)+DXIDYJ
      D2T(I+1,J+3)=D2T(I+1,J+3)+DXIDZJ
C
      D2T(I+1,K+1)=D2T(I+1,K+1)-DXIDXI-DXIDXJ
      D2T(I+1,K+2)=D2T(I+1,K+2)-DXIDYI-DXIDYJ
      D2T(I+1,K+3)=D2T(I+1,K+3)-DXIDZI-DXIDZJ
C
      D2T(I+2,I+2)=D2T(I+2,I+2)+DYIDYI
      D2T(I+2,I+3)=D2T(I+2,I+3)+DYIDZI
C
      D2T(I+2,J+1)=D2T(I+2,J+1)+DXJDYI
      D2T(I+2,J+2)=D2T(I+2,J+2)+DYIDYJ
      D2T(I+2,J+3)=D2T(I+2,J+3)+DYIDZJ
C
      D2T(I+2,K+1)=D2T(I+2,K+1)-DXIDYI-DXJDYI
      D2T(I+2,K+2)=D2T(I+2,K+2)-DYIDYI-DYIDYJ
      D2T(I+2,K+3)=D2T(I+2,K+3)-DYIDZI-DYIDZJ
C
      D2T(I+3,I+3)=D2T(I+3,I+3)+DZIDZI
C
      D2T(I+3,J+1)=D2T(I+3,J+1)+DXJDZI
      D2T(I+3,J+2)=D2T(I+3,J+2)+DYJDZI
      D2T(I+3,J+3)=D2T(I+3,J+3)+DZIDZJ
C
      D2T(I+3,K+1)=D2T(I+3,K+1)-DXIDZI-DXJDZI
      D2T(I+3,K+2)=D2T(I+3,K+2)-DYIDZI-DYJDZI
      D2T(I+3,K+3)=D2T(I+3,K+3)-DZIDZI-DZIDZJ
C
      D2T(J+1,J+1)=D2T(J+1,J+1)+DXJDXJ
      D2T(J+1,J+2)=D2T(J+1,J+2)+DXJDYJ
      D2T(J+1,J+3)=D2T(J+1,J+3)+DXJDZJ
C
      D2T(J+1,K+1)=D2T(J+1,K+1)-DXIDXJ-DXJDXJ
      D2T(J+1,K+2)=D2T(J+1,K+2)-DXJDYI-DXJDYJ
      D2T(J+1,K+3)=D2T(J+1,K+3)-DXJDZI-DXJDZJ
C
      D2T(J+2,J+2)=D2T(J+2,J+2)+DYJDYJ
      D2T(J+2,J+3)=D2T(J+2,J+3)+DYJDZJ
C
      D2T(J+2,K+1)=D2T(J+2,K+1)-DXIDYJ-DXJDYJ
      D2T(J+2,K+2)=D2T(J+2,K+2)-DYIDYJ-DYJDYJ
      D2T(J+2,K+3)=D2T(J+2,K+3)-DYJDZI-DYJDZJ
C
      D2T(J+3,J+3)=D2T(J+3,J+3)+DZJDZJ
C
      D2T(J+3,K+1)=D2T(J+3,K+1)-DXIDZJ-DXJDZJ
      D2T(J+3,K+2)=D2T(J+3,K+2)-DYIDZJ-DYJDZJ
      D2T(J+3,K+3)=D2T(J+3,K+3)-DZIDZJ-DZJDZJ
C
      D2T(K+1,K+1)=D2T(K+1,K+1)+DXIDXI+DXIDXJ+DXIDXJ+DXJDXJ
      D2T(K+1,K+2)=D2T(K+1,K+2)+DXIDYI+DXIDYJ+DXJDYI+DXJDYJ
      D2T(K+1,K+3)=D2T(K+1,K+3)+DXIDZI+DXIDZJ+DXJDZI+DXJDZJ
C
      D2T(K+2,K+2)=D2T(K+2,K+2)+DYIDYI+DYIDYJ+DYIDYJ+DYJDYJ
      D2T(K+2,K+3)=D2T(K+2,K+3)+DYIDZI+DYIDZJ+DYJDZI+DYJDZJ
C
      D2T(K+3,K+3)=D2T(K+3,K+3)+DZIDZI+DZIDZJ+DZIDZJ+DZJDZJ
C
      ELSE IF(NPASS.EQ.3) THEN
      I=(NATMS(1)-1)*3
      K=(NATMS(2)-1)*3
      L=(NATMS(3)-1)*3
      IF(I.EQ.K) THEN
      D2T(I+1,I+1)=D2T(I+1,I+1)+DXIDXK
      D2T(I+2,I+2)=D2T(I+2,I+2)+DYIDYK
      D2T(I+3,I+3)=D2T(I+3,I+3)+DZIDZK
      END IF
C
      D2T(I+1,I+1)=D2T(I+1,I+1)+DXIDXI
      D2T(I+1,I+2)=D2T(I+1,I+2)+DXIDYI
      D2T(I+1,I+3)=D2T(I+1,I+3)+DXIDZI
C
      D2T(I+1,K+1)=D2T(I+1,K+1)+DXIDXK
      D2T(I+1,K+2)=D2T(I+1,K+2)+DXIDYK
      D2T(I+1,K+3)=D2T(I+1,K+3)+DXIDZK
C
      D2T(I+1,L+1)=D2T(I+1,L+1)-DXIDXI-DXIDXK
      D2T(I+1,L+2)=D2T(I+1,L+2)-DXIDYI-DXIDYK
      D2T(I+1,L+3)=D2T(I+1,L+3)-DXIDZI-DXIDZK
C
      D2T(I+2,I+2)=D2T(I+2,I+2)+DYIDYI
      D2T(I+2,I+3)=D2T(I+2,I+3)+DYIDZI
C
      D2T(I+2,K+1)=D2T(I+2,K+1)+DXKDYI
      D2T(I+2,K+2)=D2T(I+2,K+2)+DYIDYK
      D2T(I+2,K+3)=D2T(I+2,K+3)+DYIDZK
C
      D2T(I+2,L+1)=D2T(I+2,L+1)-DXIDYI-DXKDYI
      D2T(I+2,L+2)=D2T(I+2,L+2)-DYIDYI-DYIDYK
      D2T(I+2,L+3)=D2T(I+2,L+3)-DYIDZI-DYIDZK
C
      D2T(I+3,I+3)=D2T(I+3,I+3)+DZIDZI
C
      D2T(I+3,K+1)=D2T(I+3,K+1)+DXKDZI
      D2T(I+3,K+2)=D2T(I+3,K+2)+DYKDZI
      D2T(I+3,K+3)=D2T(I+3,K+3)+DZIDZK
C
      D2T(I+3,L+1)=D2T(I+3,L+1)-DXIDZI-DXKDZI
      D2T(I+3,L+2)=D2T(I+3,L+2)-DYIDZI-DYKDZI
      D2T(I+3,L+3)=D2T(I+3,L+3)-DZIDZI-DZIDZK
C
      D2T(K+1,K+1)=D2T(K+1,K+1)+DXKDXK
      D2T(K+1,K+2)=D2T(K+1,K+2)+DXKDYK
      D2T(K+1,K+3)=D2T(K+1,K+3)+DXKDZK
C
      D2T(K+1,L+1)=D2T(K+1,L+1)-DXIDXK-DXKDXK
      D2T(K+1,L+2)=D2T(K+1,L+2)-DXKDYI-DXKDYK
      D2T(K+1,L+3)=D2T(K+1,L+3)-DXKDZI-DXKDZK
C
      D2T(K+2,K+2)=D2T(K+2,K+2)+DYKDYK
      D2T(K+2,K+3)=D2T(K+2,K+3)+DYKDZK
C
      D2T(K+2,L+1)=D2T(K+2,L+1)-DXIDYK-DXKDYK
      D2T(K+2,L+2)=D2T(K+2,L+2)-DYIDYK-DYKDYK
      D2T(K+2,L+3)=D2T(K+2,L+3)-DYKDZI-DYKDZK
C
      D2T(K+3,K+3)=D2T(K+3,K+3)+DZKDZK
C
      D2T(K+3,L+1)=D2T(K+3,L+1)-DXIDZK-DXKDZK
      D2T(K+3,L+2)=D2T(K+3,L+2)-DYIDZK-DYKDZK
      D2T(K+3,L+3)=D2T(K+3,L+3)-DZIDZK-DZKDZK
C
      D2T(L+1,L+1)=D2T(L+1,L+1)+DXIDXI+DXIDXK+DXIDXK+DXKDXK
      D2T(L+1,L+2)=D2T(L+1,L+2)+DXIDYI+DXIDYK+DXKDYI+DXKDYK
      D2T(L+1,L+3)=D2T(L+1,L+3)+DXIDZI+DXIDZK+DXKDZI+DXKDZK
C
      D2T(L+2,L+2)=D2T(L+2,L+2)+DYIDYI+DYIDYK+DYIDYK+DYKDYK
      D2T(L+2,L+3)=D2T(L+2,L+3)+DYIDZI+DYIDZK+DYKDZI+DYKDZK
C
      D2T(L+3,L+3)=D2T(L+3,L+3)+DZIDZI+DZIDZK+DZIDZK+DZKDZK
C
      ELSE IF(NPASS.EQ.4) THEN
      I=(NATMS(1)-1)*3
      J=(NATMS(2)-1)*3
C
      D2T(I+1,I+1)=D2T(I+1,I+1)+DXIDXI
      D2T(I+1,I+2)=D2T(I+1,I+2)+DXIDYI
      D2T(I+1,I+3)=D2T(I+1,I+3)+DXIDZI
C
      D2T(I+1,J+1)=D2T(I+1,J+1)-DXIDXI
      D2T(I+1,J+2)=D2T(I+1,J+2)-DXIDYI
      D2T(I+1,J+3)=D2T(I+1,J+3)-DXIDZI
C
      D2T(I+2,I+2)=D2T(I+2,I+2)+DYIDYI
      D2T(I+2,I+3)=D2T(I+2,I+3)+DYIDZI
C
      D2T(I+2,J+1)=D2T(I+2,J+1)-DXIDYI
      D2T(I+2,J+2)=D2T(I+2,J+2)-DYIDYI
      D2T(I+2,J+3)=D2T(I+2,J+3)-DYIDZI
C
      D2T(I+3,I+3)=D2T(I+3,I+3)+DZIDZI
C
      D2T(I+3,J+1)=D2T(I+3,J+1)-DXIDZI
      D2T(I+3,J+2)=D2T(I+3,J+2)-DYIDZI
      D2T(I+3,J+3)=D2T(I+3,J+3)-DZIDZI
C
      D2T(J+1,J+1)=D2T(J+1,J+1)+DXIDXI
      D2T(J+1,J+2)=D2T(J+1,J+2)+DXIDYI
      D2T(J+1,J+3)=D2T(J+1,J+3)+DXIDZI
C
      D2T(J+2,J+2)=D2T(J+2,J+2)+DYIDYI
      D2T(J+2,J+3)=D2T(J+2,J+3)+DYIDZI
C
      D2T(J+3,J+3)=D2T(J+3,J+3)+DZIDZI
C
      ELSE
         STOP 'INVALID VALUE OF NPASS IN FORME2'
      END IF
      RETURN
      END
