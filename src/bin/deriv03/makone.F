      SUBROUTINE MAKONE(DT,W,D1O,D1F,D1W,D2O,D2F,D2W,DFH,DFS,DSH,DSS)
************************************************************************
*     MAKE DERIVATIVE CONTRIBUTIONS FROM ONE ELECTRON INTEGRALS        *
************************************************************************
      IMPLICIT REAL*8 (A-H,O-Z)
cets030691
#include <error.h>
      integer ip, prcntr
CTPH  DIMENSION XIN(16),YIN(16),ZIN(16),DXC(16),DYC(16),DZC(16)
CTPH  DIMENSION WXI(16),WYI(16),WZI(16),WXJ(16),WYJ(16),WZJ(16)
CTPH  DIMENSION WXIWXI(16),WYIWYI(16),WZIWZI(16)
CTPH  DIMENSION WXIWXJ(16),WYIWYJ(16),WZIWZJ(16)
CTPH  DIMENSION WXJWXJ(16),WYJWYJ(16),WZJWZJ(16)
CTPH  DIMENSION WXIDXC(16),WYIDYC(16),WZIDZC(16)
CTPH  DIMENSION WXJDXC(16),WYJDYC(16),WZJDZC(16)
CTPH  DIMENSION  DXDXC(16), DYDYC(16), DZDZC(16)
      DIMENSION XIN(25),YIN(25),ZIN(25),DXC(25),DYC(25),DZC(25)
      DIMENSION WXI(25),WYI(25),WZI(25),WXJ(25),WYJ(25),WZJ(25)
      DIMENSION WXIWXI(25),WYIWYI(25),WZIWZI(25)
      DIMENSION WXIWXJ(25),WYIWYJ(25),WZIWZJ(25)
      DIMENSION WXJWXJ(25),WYJWYJ(25),WZJWZJ(25)
      DIMENSION WXIDXC(25),WYIDYC(25),WZIDZC(25)
      DIMENSION WXJDXC(25),WYJDYC(25),WZJDZC(25)
      DIMENSION  DXDXC(25), DYDYC(25), DZDZC(25)
      LOGICAL IANDJ,AANDB,DFOCK1,DFOCK2
      COMMON/BASIS/NBASIS,NBFAO,NBATRI,NBATR2,NTRI,NTRI2
      COMMON/CALCS/ISTYPE,ICTYPE,IRAMAN,IAFOCK,IDFOCK,IDINT
      COMMON/COORD/ZAN(50),C(3,50)
      COMMON/DSTVG/T,X0,Y0,Z0,NI,NJ,CX,CY,CZ,TAI,TAJ,TAA,UU
      COMMON/DSTVR/VX,VY,VZ,DVX,DVY,DVZ,DDVX,DDVY,DDVZ,WIVX,WIVY,WIVZ
     #,            WIWIVX,WIWIVY,WIWIVZ,WIWJVX,WIWJVY,WIWJVZ
     #,            WJWJVX,WJWJVY,WJWJVZ,WJVX,WJVY,WJVZ
     #,            WIXDVX,WIYDVY,WIZDVZ,WJXDVX,WJYDVY,WJZDVZ
     #,            DEXDXI,DEXDYI,DEXDZI,DEXDXJ,DEXDYJ,DEXDZJ
     #,            DEXDII,DEXDIJ,DEXDJJ,DEXDIC,DEXDJC
      COMMON/FUNCS/NTYPES,NTYPEP,NTREAD,NATOM,N3N,NATRI,NSYM
      COMMON/GAUSA/EX(200),CS(200)
      COMMON/GAUSB/KATOM(200),KTYPE(200),KSTART(200),KLOC(200),
     1             KMIN(200),KMAX(200),KNG(200)
      COMMON/IJATM/IATOM,JATOM,ICATOM
CTPH  COMMON/IJVEC/IX(20),IY(20),IZ(20),JX(20),JY(20),JZ(20)
      COMMON/IJVEC/IX(35),IY(35),IZ(35),JX(35),JY(35),JZ(35)
      COMMON/IJXYZ/XI,YI,ZI,XJ,YJ,ZJ
CTPH  COMMON/INDEX/DENS(100),IJX(100),IJY(100),IJZ(100),IPOINT(100)
      COMMON/INDEX/DENS(225),IJX(225),IJY(225),IJZ(225),IPOINT(225)
      COMMON/NDERS/NDERIV
      COMMON/PARA1/NSHELL,NT,MXT,NISO
CTPH  COMMON/ROOT /XX,U(9),WT(9),NROOTS
      COMMON/ROOT /XX,U(10),WT(10),NROOTS
      COMMON/SIGNS/IOFF(256),IPRNT
      DIMENSION DT(NBATRI),W(NBATRI)
      DIMENSION D1O(3,NATOM),D1F(3,NATOM),D1W(3,NATOM)
      DIMENSION D2O(N3N,N3N),D2F(N3N,N3N),D2W(N3N,N3N)
      DIMENSION DFH(NBATRI,3,NATOM),DFS(NBATRI,3)
      DIMENSION DSH(NBATRI,NATRI),DSS(NBATRI,6)
      COMMON/TOLER/DLIM
      DATA PI212 /1.1283791670955D+0/
      DATA ZERO,HALF,ONE,TWO / 0.0D+00 , 0.5D+00 , 1.0D+00 , 2.0D+00 /
ctph  DATA NQLIM / 4 /
      DATA NQLIM / 5 /
      DATA ITOL / 20 /
C
      ip = prcntr('IS_ON DEBUG')
      if(ip.eq.1) then
        write(6,*)' in makone'
        write(6,*)' dfock1',dfock1
        write(6,*)' dfock2',dfock2
        write(6,*)' nderiv',nderiv
        write(6,*)' in makone this is the density matrix'    
        call print(dt,nbatri,nbasis,6)
      endif
      TOL=ITOL*2.30258D+00
      DFOCK1=IDFOCK.GE.1
      DFOCK2=IDFOCK.GE.2
C
      DO 101 I=1,NATOM
      DO 101 J=1,3
      D1O(J,I)=ZERO
      D1F(J,I)=ZERO
      D1W(J,I)=ZERO
  101 CONTINUE
      IF(NDERIV.GE.2) THEN
      DO 102 I=1,N3N
      DO 102 J=1,N3N
      D2O(J,I)=ZERO
      D2F(J,I)=ZERO
      D2W(J,I)=ZERO
  102 CONTINUE
      END IF
      IF(DFOCK1) THEN
      DO 103 I=1,NATOM
      DO 103 J=1,3
      DO 103 K=1,NBATRI
      DFH(K,J,I)=ZERO
  103 CONTINUE
      DO 104 I=1,3
      DO 104 J=1,NBATRI
      DFS(J,I)=ZERO
  104 CONTINUE
      END IF
      IF(DFOCK2) THEN
      DO 105 I=1,NATRI
      DO 105 J=1,NBATRI
      DSH(J,I)=ZERO
  105 CONTINUE
      DO 106 I=1,6
      DO 106 J=1,NBATRI
      DSS(J,I)=ZERO
  106 CONTINUE
      END IF
C
C#################
C#####I SHELL#####
C#################
C
      DO 5000 II=1,NSHELL
C
      IATOM=KATOM(II)
      XI=C(1,IATOM)
      YI=C(2,IATOM)
      ZI=C(3,IATOM)
      IGMIN=KSTART(II)
      IGMAX=IGMIN+KNG(II)-1
      LIT=KTYPE(II)
      MINI=KMIN(II)
      MAXI=KMAX(II)
      LOCI=KLOC(II)-MINI
C
C#################
C#####J SHELL#####
C#################
C
      DO 4000 JJ=1,II
C
      JATOM=KATOM(JJ)
      XJ=C(1,JATOM)
      YJ=C(2,JATOM)
      ZJ=C(3,JATOM)
      JGMIN=KSTART(JJ)
      JGMAX=JGMIN+KNG(JJ)-1
      LJT=KTYPE(JJ)
      MINJ=KMIN(JJ)
      MAXJ=KMAX(JJ)
      LOCJ=KLOC(JJ)-MINJ
      IANDJ=II.EQ.JJ
      AANDB=IATOM.EQ.JATOM
C
      RR=(XI-XJ)**2+(YI-YJ)**2+(ZI-ZJ)**2
C
C     ----- WORK OUT INDICES FOR COMBINING 2D INTEGRALS -----
C
      MIJ=0
      JMAX=MAXJ
      DO 112 I=MINI,MAXI
      NX=IX(I)
      NY=IY(I)
      NZ=IZ(I)
      IF(IANDJ) JMAX=I
      DO 111 J=MINJ,JMAX
      MIJ=MIJ+1
      IJX(MIJ)=NX+JX(J)
      IJY(MIJ)=NY+JY(J)
      IJZ(MIJ)=NZ+JZ(J)
      IPOS=IOFF(LOCI+I)+LOCJ+J
      IPOINT(MIJ)=IPOS
      DENS(MIJ)=DT(IPOS)
      IF(II.NE.JJ.OR.I.NE.J) DENS(MIJ)=DENS(MIJ)*TWO
  111 CONTINUE
  112 CONTINUE
C
C     ----- CALCULATE CORRECT NUMBER OF ROOTS TO USE FOR RYS QUAD. -
C
      NROOTS=(LIT+LJT+NDERIV)/2
C
      IAPT =(IATOM-1)*3+1
      JAPT =(JATOM-1)*3+1
      IAPTT=IOFF(IAPT+1)
      JAPTT=IOFF(JAPT+1)
      MAPT =MAX(IAPT,JAPT)
      NAPT =MIN(IAPT,JAPT)
      IJAPT=IOFF(MAPT)+NAPT
C
C     ----- ZERO TEMPORARY VARIABLES -----
C
      DVDXI=ZERO
      DVDYI=ZERO
      DVDZI=ZERO
      DVDXJ=ZERO
      DVDYJ=ZERO
      DVDZJ=ZERO
      DTDX  =ZERO
      DTDY  =ZERO
      DTDZ  =ZERO
      DSDX  =ZERO
      DSDY  =ZERO
      DSDZ  =ZERO
      IF(NDERIV.LE.1) GO TO 201
C
      DVXIXI=ZERO
      DVXIYI=ZERO
      DVXIZI=ZERO
      DVYIYI=ZERO
      DVYIZI=ZERO
      DVZIZI=ZERO
      DVXIXJ=ZERO
      DVXIYJ=ZERO
      DVXIZJ=ZERO
      DVYIXJ=ZERO
      DVYIYJ=ZERO
      DVYIZJ=ZERO
      DVZIXJ=ZERO
      DVZIYJ=ZERO
      DVZIZJ=ZERO
      DVXJXJ=ZERO
      DVXJYJ=ZERO
      DVXJZJ=ZERO
      DVYJYJ=ZERO
      DVYJZJ=ZERO
      DVZJZJ=ZERO
      DTDXDX=ZERO
      DTDXDY=ZERO
      DTDXDZ=ZERO
      DTDYDY=ZERO
      DTDYDZ=ZERO
      DTDZDZ=ZERO
      DSDXDX=ZERO
      DSDXDY=ZERO
      DSDXDZ=ZERO
      DSDYDY=ZERO
      DSDYDZ=ZERO
      DSDZDZ=ZERO
C
C:::::::::::::::::::::
C:::::I PRIMITIVE:::::
C:::::::::::::::::::::
C
  201 CONTINUE
      DO 3000 IG=IGMIN,IGMAX
      CI=CS(IG)
      AI=EX(IG)
      AXI=AI*XI
      AYI=AI*YI
      AZI=AI*ZI
      TAI=AI*TWO
C
C:::::::::::::::::::::
C:::::J PRIMITIVE:::::
C:::::::::::::::::::::
C
      IF(IANDJ) JGMAX=IG
      DO 2000 JG=JGMIN,JGMAX
      CJ=CS(JG)
      AJ=EX(JG)
      AXJ=AJ*XJ
      AYJ=AJ*YJ
      AZJ=AJ*ZJ
      TAJ=AJ*TWO
C
      PP=AI+AJ
      PAA=AI*AJ
      TPP=ONE/PP
      TAA=TAI+TAJ
      RHO2=PAA*TPP*TWO
      TEMP=PAA*TPP*RR
C
C     ----- IGNORE INTEGRAL IF PRE-EXPONENTIAL TOO SMALL -----
C
      IF(TEMP.GT.TOL) GO TO 2000
C
C     ----- DENSITY FACTOR -----
C
      TP=DSQRT(TPP)
      DIJ=CI*CJ*DEXP(-TEMP)
      IF(IANDJ.AND.IG.NE.JG) DIJ=DIJ*TWO
      DIJPI=DIJ*PI212*TPP
      DIJ=-DIJ
C
      AAX=AXI+AXJ
      AAY=AYI+AYJ
      AAZ=AZI+AZJ
      AX=AAX*TPP
      AY=AAY*TPP
      AZ=AAZ*TPP
C
C     ----- CALCULATE DERIVATIVE CONTRIBUTIONS FROM -----
C                KINETIC AND OVERLAP INTEGRALS
C
      IF(AANDB) GO TO 300
C
      X0=AX
      Y0=AY
      Z0=AZ
      T=DSQRT(PP)
      ST=TP
      IN=-NQLIM
      DO 120 NI=1,LIT
      IN=IN+NQLIM
      DO 120 NJ=1,LJT
      JN=IN+NJ
      CALL TDER2
      XIN(JN)=VX             * ST
      YIN(JN)=VY             * ST
      ZIN(JN)=VZ*DIJ         * ST
      WXI(JN)=WIVX           * ST
      WYI(JN)=WIVY           * ST
      WZI(JN)=WIVZ*DIJ       * ST
      DXC(JN)=DVX            * ST
      DYC(JN)=DVY            * ST
      DZC(JN)=DVZ*DIJ        * ST
      WXIDXC(JN)=WIXDVX      * ST
      WYIDYC(JN)=WIYDVY      * ST
      WZIDZC(JN)=WIZDVZ*DIJ  * ST
      IF(NDERIV.LE.1) GO TO 120
C
      WXIWXI(JN)=WIWIVX      * ST
      WYIWYI(JN)=WIWIVY      * ST
      WZIWZI(JN)=WIWIVZ*DIJ  * ST
      DXDXC(JN)=DDVX         * ST
      DYDYC(JN)=DDVY         * ST
      DZDZC(JN)=DDVZ*DIJ     * ST
  120 CONTINUE
C
C     ----- COMBINE TWO-DIMENSIONAL INTEGRALS TO FORM INTEGRALS -----
C
      DO 125 I=1,MIJ
      NX=IJX(I)
      NY=IJY(I)
      NZ=IJZ(I)
      DD=DENS(I)*HALF
      X = XIN(NX)
      Y = YIN(NY)
      Z = ZIN(NZ)
      XY = X*Y
      XZ = X*Z
      YZ = Y*Z
      DX = DXC(NX)
      DY = DYC(NY)
      DZ = DZC(NZ)
      WX = WXI(NX)
      WY = WYI(NY)
      WZ = WZI(NZ)
      WDX = WXIDXC(NX)
      WDY = WYIDYC(NY)
      WDZ = WZIDZC(NZ)
      IP=IPOINT(I)
      WD=W(IP)
      XTEMP1=WX*YZ
      YTEMP1=WY*XZ
      ZTEMP1=WZ*XY
      XTEMP2=WDX*YZ+WX*(DY*Z+Y*DZ)
      YTEMP2=WDY*XZ+WY*(DX*Z+X*DZ)
      ZTEMP2=WDZ*XY+WZ*(DX*Y+X*DY)
      IF(DABS(WD).LT.DLIM) GO TO 401
      DSDX=DSDX+XTEMP1*WD
      DSDY=DSDY+YTEMP1*WD
      DSDZ=DSDZ+ZTEMP1*WD
  401 CONTINUE
      IF(DABS(DD).LT.DLIM) GO TO 402
      DTDX=DTDX+XTEMP2*DD
      DTDY=DTDY+YTEMP2*DD
      DTDZ=DTDZ+ZTEMP2*DD
  402 CONTINUE
      IF(NDERIV.LE.1) GO TO 202
C
      SSDXDX= WXIWXI(NX)*YZ
      SSDXDY= WX*WY*Z
      SSDXDZ= WX*WZ*Y
      SSDYDY= WYIWYI(NY)*XZ
      SSDYDZ= WY*WZ*X
      SSDZDZ= WZIWZI(NZ)*XY
      TTDXDX = DXDXC(NX)*YZ + WXIWXI(NX) * (DY*Z + Y*DZ)
      TTDXDY = (WDX*WY + WX*WDY) * Z + WX*WY*DZ
      TTDXDZ = (WDX*WZ + WX*WDZ) * Y + WX*WZ*DY
      TTDYDY = DYDYC(NY)*XZ + WYIWYI(NY) * (DX*Z + X*DZ)
      TTDYDZ = (WDY*WZ + WY*WDZ) * X + WY*WZ*DX
      TTDZDZ = DZDZC(NZ)*XY + WZIWZI(NZ) * (DX*Y + X*DY)
      IF(DABS(WD).LT.DLIM) GO TO 403
      DSDXDX=DSDXDX + SSDXDX*WD
      DSDXDY=DSDXDY + SSDXDY*WD
      DSDXDZ=DSDXDZ + SSDXDZ*WD
      DSDYDY=DSDYDY + SSDYDY*WD
      DSDYDZ=DSDYDZ + SSDYDZ*WD
      DSDZDZ=DSDZDZ + SSDZDZ*WD
  403 CONTINUE
      IF(DABS(DD).LT.DLIM) GO TO 202
      DTDXDX = DTDXDX + TTDXDX * DD
      DTDXDY = DTDXDY + TTDXDY * DD
      DTDXDZ = DTDXDZ + TTDXDZ * DD
      DTDYDY = DTDYDY + TTDYDY * DD
      DTDYDZ = DTDYDZ + TTDYDZ * DD
      DTDZDZ = DTDZDZ + TTDZDZ * DD
C
  202 CONTINUE
      IF(.NOT.DFOCK1) GO TO 203
      DFS(IP,1)=DFS(IP,1)-XTEMP1
      DFS(IP,2)=DFS(IP,2)-YTEMP1
      DFS(IP,3)=DFS(IP,3)-ZTEMP1
      DFH(IP,1,IATOM)=DFH(IP,1,IATOM)+XTEMP2*HALF
      DFH(IP,1,JATOM)=DFH(IP,1,JATOM)-XTEMP2*HALF
      DFH(IP,2,IATOM)=DFH(IP,2,IATOM)+YTEMP2*HALF
      DFH(IP,2,JATOM)=DFH(IP,2,JATOM)-YTEMP2*HALF
      DFH(IP,3,IATOM)=DFH(IP,3,IATOM)+ZTEMP2*HALF
      DFH(IP,3,JATOM)=DFH(IP,3,JATOM)-ZTEMP2*HALF
  203 CONTINUE
      IF(.NOT.DFOCK2) GO TO 125
      DSS(IP,1)=DSS(IP,1)-SSDXDX
      DSS(IP,2)=DSS(IP,2)-SSDXDY
      DSS(IP,3)=DSS(IP,3)-SSDXDZ
      DSS(IP,4)=DSS(IP,4)-SSDYDY
      DSS(IP,5)=DSS(IP,5)-SSDYDZ
      DSS(IP,6)=DSS(IP,6)-SSDZDZ
C
      ICOUNT=IAPTT
      JCOUNT=JAPTT
      DSH(IP,ICOUNT) = DSH(IP,ICOUNT) + TTDXDX*HALF
      DSH(IP,JCOUNT) = DSH(IP,JCOUNT) + TTDXDX*HALF
      ICOUNT=ICOUNT+IAPT
      JCOUNT=JCOUNT+JAPT
      DSH(IP,ICOUNT) = DSH(IP,ICOUNT) + TTDXDY*HALF
      DSH(IP,JCOUNT) = DSH(IP,JCOUNT) + TTDXDY*HALF
      ICOUNT=ICOUNT+1
      JCOUNT=JCOUNT+1
      DSH(IP,ICOUNT) = DSH(IP,ICOUNT) + TTDYDY*HALF
      DSH(IP,JCOUNT) = DSH(IP,JCOUNT) + TTDYDY*HALF
      ICOUNT=ICOUNT+IAPT
      JCOUNT=JCOUNT+JAPT
      DSH(IP,ICOUNT) = DSH(IP,ICOUNT) + TTDXDZ*HALF
      DSH(IP,JCOUNT) = DSH(IP,JCOUNT) + TTDXDZ*HALF
      ICOUNT=ICOUNT+1
      JCOUNT=JCOUNT+1
      DSH(IP,ICOUNT) = DSH(IP,ICOUNT) + TTDYDZ*HALF
      DSH(IP,JCOUNT) = DSH(IP,JCOUNT) + TTDYDZ*HALF
      ICOUNT=ICOUNT+1
      JCOUNT=JCOUNT+1
      DSH(IP,ICOUNT) = DSH(IP,ICOUNT) + TTDZDZ*HALF
      DSH(IP,JCOUNT) = DSH(IP,JCOUNT) + TTDZDZ*HALF
      ICOUNT=IJAPT
      DSH(IP,ICOUNT)   = DSH(IP,ICOUNT)   -TTDXDX*HALF
      DSH(IP,ICOUNT+1) = DSH(IP,ICOUNT+1) -TTDXDY*HALF
      DSH(IP,ICOUNT+2) = DSH(IP,ICOUNT+2) -TTDXDZ*HALF
      ICOUNT=ICOUNT+MAPT
      DSH(IP,ICOUNT)   = DSH(IP,ICOUNT)   -TTDXDY*HALF
      DSH(IP,ICOUNT+1) = DSH(IP,ICOUNT+1) -TTDYDY*HALF
      DSH(IP,ICOUNT+2) = DSH(IP,ICOUNT+2) -TTDYDZ*HALF
      ICOUNT=ICOUNT+MAPT+1
      DSH(IP,ICOUNT)   = DSH(IP,ICOUNT)   -TTDXDZ*HALF
      DSH(IP,ICOUNT+1) = DSH(IP,ICOUNT+1) -TTDYDZ*HALF
      DSH(IP,ICOUNT+2) = DSH(IP,ICOUNT+2) -TTDZDZ*HALF
C
  125 CONTINUE
  300 CONTINUE
C
C     ----- LOOP OVER ATOMS IN POTENTIAL TERM -----
C
      DO 1000 IC=1,NATOM
      ICATOM=IC
C
      KAPT =(ICATOM-1)*3+1
      KAPTT=IOFF(KAPT+1)
      MMAPT=MAX(IAPT,KAPT)
      NNAPT=MIN(IAPT,KAPT)
      IKAPT=IOFF(MMAPT)+NNAPT
      MMAPT=MAX(JAPT,KAPT)
      NNAPT=MIN(JAPT,KAPT)
      JKAPT=IOFF(MMAPT)+NNAPT
C
      ZNUC=-ZAN(IC)*DIJPI
      CX=C(1,IC)
      CY=C(2,IC)
      CZ=C(3,IC)
      XX=PP*((AX-CX)**2+(AY-CY)**2+(AZ-CZ)**2)
          IF(NROOTS.LE.3) THEN
          CALL RT123
          ELSE IF(NROOTS.EQ.4) THEN
          CALL ROOT4
          ELSE IF(NROOTS.EQ.5) THEN
          CALL ROOT5
          ELSE IF(NROOTS.GT.5) THEN
          CALL DROOT
          ELSE
          END IF
      HFDX=ZERO
      HFDY=ZERO
      HFDZ=ZERO
      IF(NDERIV.LE.1) GO TO 204
      HFDXX=ZERO
      HFDXY=ZERO
      HFDXZ=ZERO
      HFDYY=ZERO
      HFDYZ=ZERO
      HFDZZ=ZERO
      DVXIXC=ZERO
      DVXIYC=ZERO
      DVXIZC=ZERO
      DVYIXC=ZERO
      DVYIYC=ZERO
      DVYIZC=ZERO
      DVZIXC=ZERO
      DVZIYC=ZERO
      DVZIZC=ZERO
      DVXJXC=ZERO
      DVXJYC=ZERO
      DVXJZC=ZERO
      DVYJXC=ZERO
      DVYJYC=ZERO
      DVYJZC=ZERO
      DVZJXC=ZERO
      DVZJYC=ZERO
      DVZJZC=ZERO
  204 CONTINUE
      DO 150 IROOT=1,NROOTS
      UU=PP*U(IROOT)
      WW=WT(IROOT)*ZNUC
      TT=PP+UU
      T=DSQRT(TT)
      X0=(AAX+UU*CX)/TT
      Y0=(AAY+UU*CY)/TT
      Z0=(AAZ+UU*CZ)/TT
C
C     ----- CALCULATE TWO-DIMENSIONAL INTEGRALS -----
C
      IN=-NQLIM
      DO 130 NI=1,LIT
      IN=IN+NQLIM
      DO 130 NJ=1,LJT
      JN=IN+NJ
      CALL VDER2
      XIN(JN)=VX
      YIN(JN)=VY
      ZIN(JN)=VZ*WW
      DXC(JN)=DVX
      DYC(JN)=DVY
      DZC(JN)=DVZ*WW
      WXI(JN)=WIVX
      WYI(JN)=WIVY
      WZI(JN)=WIVZ*WW
      WXJ(JN)=WJVX
      WYJ(JN)=WJVY
      WZJ(JN)=WJVZ*WW
      IF(NDERIV.LE.1) GO TO 130
C
      WXIWXI(JN)=WIWIVX
      WYIWYI(JN)=WIWIVY
      WZIWZI(JN)=WIWIVZ*WW
      WXIWXJ(JN)=WIWJVX
      WYIWYJ(JN)=WIWJVY
      WZIWZJ(JN)=WIWJVZ*WW
      WXJWXJ(JN)=WJWJVX
      WYJWYJ(JN)=WJWJVY
      WZJWZJ(JN)=WJWJVZ*WW
      WXIDXC(JN)=WIXDVX
      WYIDYC(JN)=WIYDVY
      WZIDZC(JN)=WIZDVZ*WW
      WXJDXC(JN)=WJXDVX
      WYJDYC(JN)=WJYDVY
      WZJDZC(JN)=WJZDVZ*WW
      DXDXC(JN)=DDVX
      DYDYC(JN)=DDVY
      DZDZC(JN)=DDVZ*WW
  130 CONTINUE
 
C     ----- COMBINE TWO-DIMENSIONAL INTEGRALS TO FORM INTEGRALS -----
C
      DO 140 I=1,MIJ
      NX=IJX(I)
      NY=IJY(I)
      NZ=IJZ(I)
      DD=DENS(I)
      IP=IPOINT(I)
      X = XIN(NX)
      Y = YIN(NY)
      Z = ZIN(NZ)
      XY = X*Y
      XZ = X*Z
      YZ = Y*Z
      XTEMP3 = DXC(NX)*YZ
c     if(xtemp3.gt.1d+10)write(6,*)' problems with xtemp3=',xtemp3
      YTEMP3 = DYC(NY)*XZ
      ZTEMP3 = DZC(NZ)*XY
      XTEMP4=WXI(NX)*YZ
      YTEMP4=WYI(NY)*XZ
      ZTEMP4=WZI(NZ)*XY
      XTEMP5=WXJ(NX)*YZ
      YTEMP5=WYJ(NY)*XZ
      ZTEMP5=WZJ(NZ)*XY
      IF(DABS(DD).LT.DLIM) GO TO 405
      HFDX  = HFDX + XTEMP3*DD
c     if(hfdx.gt.1d+10)write(6,*)' problems with hfdx=xtemp3,dd',hfdx
c    .                   ,xtemp3,dd
      HFDY  = HFDY + YTEMP3*DD
      HFDZ  = HFDZ + ZTEMP3*DD
      DVDXI=DVDXI+XTEMP4*DD
      DVDYI=DVDYI+YTEMP4*DD
      DVDZI=DVDZI+ZTEMP4*DD
      DVDXJ=DVDXJ+XTEMP5*DD
      DVDYJ=DVDYJ+YTEMP5*DD
      DVDZJ=DVDZJ+ZTEMP5*DD
  405 CONTINUE
      IF(NDERIV.LE.1) GO TO 205
C
      VHFDXX = DXDXC(NX)*YZ
      VHFDXY = DXC(NX)*DYC(NY)*Z
      VHFDXZ = DXC(NX)*Y*DZC(NZ)
      VHFDYY = DYDYC(NY)*XZ
      VHFDYZ = X*DYC(NY)*DZC(NZ)
      VHFDZZ = XY*DZDZC(NZ)
      VVXIXC= WXIDXC(NX)*YZ
      VVXIYC= WXI(NX)*DYC(NY)*Z
      VVXIZC= WXI(NX)*Y*DZC(NZ)
      VVYIXC= DXC(NX)*WYI(NY)*Z
      VVYIYC= WYIDYC(NY)*XZ
      VVYIZC= X*WYI(NY)*DZC(NZ)
      VVZIXC= DXC(NX)*Y*WZI(NZ)
      VVZIYC= X*DYC(NY)*WZI(NZ)
      VVZIZC= XY*WZIDZC(NZ)
      VVXJXC= WXJDXC(NX)*YZ
      VVXJYC= WXJ(NX)*DYC(NY)*Z
      VVXJZC= WXJ(NX)*Y*DZC(NZ)
      VVYJXC= DXC(NX)*WYJ(NY)*Z
      VVYJYC= WYJDYC(NY)*XZ
      VVYJZC= X*WYJ(NY)*DZC(NZ)
      VVZJXC= DXC(NX)*Y*WZJ(NZ)
      VVZJYC= X*DYC(NY)*WZJ(NZ)
      VVZJZC= XY*WZJDZC(NZ)
      VVXIXI= WXIWXI(NX)*YZ
      VVXIYI= WXI(NX)*WYI(NY)*Z
      VVXIZI= WXI(NX)*Y*WZI(NZ)
      VVYIYI= WYIWYI(NY)*XZ
      VVYIZI= X*WYI(NY)*WZI(NZ)
      VVZIZI= XY*WZIWZI(NZ)
      VVXIXJ= WXIWXJ(NX)*YZ
      VVXIYJ= WXI(NX)*WYJ(NY)*Z
      VVXIZJ= WXI(NX)*Y*WZJ(NZ)
      VVYIXJ= WXJ(NX)*WYI(NY)*Z
      VVYIYJ= WYIWYJ(NY)*XZ
      VVYIZJ= X*WYI(NY)*WZJ(NZ)
      VVZIXJ= WXJ(NX)*Y*WZI(NZ)
      VVZIYJ= X*WYJ(NY)*WZI(NZ)
      VVZIZJ= XY*WZIWZJ(NZ)
      VVXJXJ= WXJWXJ(NX)*YZ
      VVXJYJ= WXJ(NX)*WYJ(NY)*Z
      VVXJZJ= WXJ(NX)*Y*WZJ(NZ)
      VVYJYJ= WYJWYJ(NY)*XZ
      VVYJZJ= X*WYJ(NY)*WZJ(NZ)
      VVZJZJ= XY*WZJWZJ(NZ)
      IF(DABS(DD).LT.DLIM) GO TO 205
      HFDXX = HFDXX + VHFDXX * DD
      HFDXY = HFDXY + VHFDXY * DD
      HFDXZ = HFDXZ + VHFDXZ * DD
      HFDYY = HFDYY + VHFDYY * DD
      HFDYZ = HFDYZ + VHFDYZ * DD
      HFDZZ = HFDZZ + VHFDZZ * DD
      DVXIXC=DVXIXC + VVXIXC * DD
      DVXIYC=DVXIYC + VVXIYC * DD
      DVXIZC=DVXIZC + VVXIZC * DD
      DVYIXC=DVYIXC + VVYIXC * DD
      DVYIYC=DVYIYC + VVYIYC * DD
      DVYIZC=DVYIZC + VVYIZC * DD
      DVZIXC=DVZIXC + VVZIXC * DD
      DVZIYC=DVZIYC + VVZIYC * DD
      DVZIZC=DVZIZC + VVZIZC * DD
      DVXJXC=DVXJXC + VVXJXC * DD
      DVXJYC=DVXJYC + VVXJYC * DD
      DVXJZC=DVXJZC + VVXJZC * DD
      DVYJXC=DVYJXC + VVYJXC * DD
      DVYJYC=DVYJYC + VVYJYC * DD
      DVYJZC=DVYJZC + VVYJZC * DD
      DVZJXC=DVZJXC + VVZJXC * DD
      DVZJYC=DVZJYC + VVZJYC * DD
      DVZJZC=DVZJZC + VVZJZC * DD
      DVXIXI=DVXIXI + VVXIXI * DD
      DVXIYI=DVXIYI + VVXIYI * DD
      DVXIZI=DVXIZI + VVXIZI * DD
      DVYIYI=DVYIYI + VVYIYI * DD
      DVYIZI=DVYIZI + VVYIZI * DD
      DVZIZI=DVZIZI + VVZIZI * DD
      DVXIXJ=DVXIXJ + VVXIXJ * DD
      DVXIYJ=DVXIYJ + VVXIYJ * DD
      DVXIZJ=DVXIZJ + VVXIZJ * DD
      DVYIXJ=DVYIXJ + VVYIXJ * DD
      DVYIYJ=DVYIYJ + VVYIYJ * DD
      DVYIZJ=DVYIZJ + VVYIZJ * DD
      DVZIXJ=DVZIXJ + VVZIXJ * DD
      DVZIYJ=DVZIYJ + VVZIYJ * DD
      DVZIZJ=DVZIZJ + VVZIZJ * DD
      DVXJXJ=DVXJXJ + VVXJXJ * DD
      DVXJYJ=DVXJYJ + VVXJYJ * DD
      DVXJZJ=DVXJZJ + VVXJZJ * DD
      DVYJYJ=DVYJYJ + VVYJYJ * DD
      DVYJZJ=DVYJZJ + VVYJZJ * DD
      DVZJZJ=DVZJZJ + VVZJZJ * DD
C
  205 CONTINUE
      IF(.NOT.DFOCK1) GO TO 206
      DFH(IP,1,IC)=DFH(IP,1,IC)+XTEMP3
      DFH(IP,2,IC)=DFH(IP,2,IC)+YTEMP3
      DFH(IP,3,IC)=DFH(IP,3,IC)+ZTEMP3
      DFH(IP,1,IATOM) = DFH(IP,1,IATOM) + XTEMP4
      DFH(IP,2,IATOM) = DFH(IP,2,IATOM) + YTEMP4
      DFH(IP,3,IATOM) = DFH(IP,3,IATOM) + ZTEMP4
      DFH(IP,1,JATOM) = DFH(IP,1,JATOM) + XTEMP5
      DFH(IP,2,JATOM) = DFH(IP,2,JATOM) + YTEMP5
      DFH(IP,3,JATOM) = DFH(IP,3,JATOM) + ZTEMP5
  206 CONTINUE
      IF(.NOT.DFOCK2) GO TO 140
C
      ICOUNT = KAPTT
      DSH(IP,ICOUNT) = DSH(IP,ICOUNT) + VHFDXX
      ICOUNT = ICOUNT + KAPT
      DSH(IP,ICOUNT) = DSH(IP,ICOUNT) + VHFDXY
      ICOUNT = ICOUNT + 1
      DSH(IP,ICOUNT) = DSH(IP,ICOUNT) + VHFDYY
      ICOUNT = ICOUNT + KAPT
      DSH(IP,ICOUNT) = DSH(IP,ICOUNT) + VHFDXZ
      ICOUNT = ICOUNT + 1
      DSH(IP,ICOUNT) = DSH(IP,ICOUNT) + VHFDYZ
      ICOUNT = ICOUNT + 1
      DSH(IP,ICOUNT) = DSH(IP,ICOUNT) + VHFDZZ
 
      IF(KAPT-IAPT) 301,302,303
C
C        WHEN IATOM > ICATOM
C
  301 ICOUNT = IKAPT
      DSH(IP,ICOUNT  ) = DSH(IP,ICOUNT  ) + VVXIXC
      DSH(IP,ICOUNT+1) = DSH(IP,ICOUNT+1) + VVXIYC
      DSH(IP,ICOUNT+2) = DSH(IP,ICOUNT+2) + VVXIZC
      ICOUNT = ICOUNT + IAPT
      DSH(IP,ICOUNT  ) = DSH(IP,ICOUNT  ) + VVYIXC
      DSH(IP,ICOUNT+1) = DSH(IP,ICOUNT+1) + VVYIYC
      DSH(IP,ICOUNT+2) = DSH(IP,ICOUNT+2) + VVYIZC
      ICOUNT = ICOUNT + IAPT + 1
      DSH(IP,ICOUNT  ) = DSH(IP,ICOUNT  ) + VVZIXC
      DSH(IP,ICOUNT+1) = DSH(IP,ICOUNT+1) + VVZIYC
      DSH(IP,ICOUNT+2) = DSH(IP,ICOUNT+2) + VVZIZC
      GO TO 305
C
C        WHEN IATOM = ICATOM
C
  302 ICOUNT = IKAPT
      DSH(IP,ICOUNT) = DSH(IP,ICOUNT) + VVXIXC
      ICOUNT = ICOUNT + IAPT
      DSH(IP,ICOUNT) = DSH(IP,ICOUNT) + VVYIXC + VVXIYC
      ICOUNT = ICOUNT + 1
      DSH(IP,ICOUNT) = DSH(IP,ICOUNT) + VVYIYC
      ICOUNT = ICOUNT + IAPT
      DSH(IP,ICOUNT) = DSH(IP,ICOUNT) + VVZIXC + VVXIZC
      ICOUNT = ICOUNT + 1
      DSH(IP,ICOUNT) = DSH(IP,ICOUNT) + VVZIYC + VVYIZC
      ICOUNT = ICOUNT + 1
      DSH(IP,ICOUNT) = DSH(IP,ICOUNT) + VVZIZC
      GO TO 305
C
C        WHEN IATOM < ICATOM
C
  303 ICOUNT = IKAPT
      DSH(IP,ICOUNT  ) = DSH(IP,ICOUNT  ) + VVXIXC
      DSH(IP,ICOUNT+1) = DSH(IP,ICOUNT+1) + VVYIXC
      DSH(IP,ICOUNT+2) = DSH(IP,ICOUNT+2) + VVZIXC
      ICOUNT = ICOUNT + KAPT
      DSH(IP,ICOUNT  ) = DSH(IP,ICOUNT  ) + VVXIYC
      DSH(IP,ICOUNT+1) = DSH(IP,ICOUNT+1) + VVYIYC
      DSH(IP,ICOUNT+2) = DSH(IP,ICOUNT+2) + VVZIYC
      ICOUNT = ICOUNT + KAPT + 1
      DSH(IP,ICOUNT  ) = DSH(IP,ICOUNT  ) + VVXIZC
      DSH(IP,ICOUNT+1) = DSH(IP,ICOUNT+1) + VVYIZC
      DSH(IP,ICOUNT+2) = DSH(IP,ICOUNT+2) + VVZIZC
C
  305 IF(KAPT-JAPT) 306,307,308
C
C        WHEN JATOM > ICATOM
C
  306 ICOUNT = JKAPT
      DSH(IP,ICOUNT  ) = DSH(IP,ICOUNT  ) + VVXJXC
      DSH(IP,ICOUNT+1) = DSH(IP,ICOUNT+1) + VVXJYC
      DSH(IP,ICOUNT+2) = DSH(IP,ICOUNT+2) + VVXJZC
      ICOUNT = ICOUNT + JAPT
      DSH(IP,ICOUNT  ) = DSH(IP,ICOUNT  ) + VVYJXC
      DSH(IP,ICOUNT+1) = DSH(IP,ICOUNT+1) + VVYJYC
      DSH(IP,ICOUNT+2) = DSH(IP,ICOUNT+2) + VVYJZC
      ICOUNT = ICOUNT + JAPT + 1
      DSH(IP,ICOUNT  ) = DSH(IP,ICOUNT  ) + VVZJXC
      DSH(IP,ICOUNT+1) = DSH(IP,ICOUNT+1) + VVZJYC
      DSH(IP,ICOUNT+2) = DSH(IP,ICOUNT+2) + VVZJZC
      GO TO 310
C
C        WHEN JATOM = ICATOM
C
  307 ICOUNT = JKAPT
      DSH(IP,ICOUNT) = DSH(IP,ICOUNT) + VVXJXC
      ICOUNT = ICOUNT + JAPT
      DSH(IP,ICOUNT) = DSH(IP,ICOUNT) + VVYJXC + VVXJYC
      ICOUNT = ICOUNT + 1
      DSH(IP,ICOUNT) = DSH(IP,ICOUNT) + VVYJYC
      ICOUNT = ICOUNT + JAPT
      DSH(IP,ICOUNT) = DSH(IP,ICOUNT) + VVZJXC + VVXJZC
      ICOUNT = ICOUNT + 1
      DSH(IP,ICOUNT) = DSH(IP,ICOUNT) + VVZJYC + VVYJZC
      ICOUNT = ICOUNT + 1
      DSH(IP,ICOUNT) = DSH(IP,ICOUNT) + VVZJZC
      GO TO 310
C
C        WHEN JATOM < ICATOM
C
  308 ICOUNT = JKAPT
      DSH(IP,ICOUNT  ) = DSH(IP,ICOUNT  ) + VVXJXC
      DSH(IP,ICOUNT+1) = DSH(IP,ICOUNT+1) + VVYJXC
      DSH(IP,ICOUNT+2) = DSH(IP,ICOUNT+2) + VVZJXC
      ICOUNT = ICOUNT + KAPT
      DSH(IP,ICOUNT  ) = DSH(IP,ICOUNT  ) + VVXJYC
      DSH(IP,ICOUNT+1) = DSH(IP,ICOUNT+1) + VVYJYC
      DSH(IP,ICOUNT+2) = DSH(IP,ICOUNT+2) + VVZJYC
      ICOUNT = ICOUNT + KAPT + 1
      DSH(IP,ICOUNT  ) = DSH(IP,ICOUNT  ) + VVXJZC
      DSH(IP,ICOUNT+1) = DSH(IP,ICOUNT+1) + VVYJZC
      DSH(IP,ICOUNT+2) = DSH(IP,ICOUNT+2) + VVZJZC
C
C       (IATOM,IATOM) & (JATOM,JATOM) PAIRS
C
  310 ICOUNT = IAPTT
      JCOUNT = JAPTT
      DSH(IP,ICOUNT) = DSH(IP,ICOUNT) + VVXIXI
      DSH(IP,JCOUNT) = DSH(IP,JCOUNT) + VVXJXJ
      ICOUNT = ICOUNT + IAPT
      JCOUNT = JCOUNT + JAPT
      DSH(IP,ICOUNT) = DSH(IP,ICOUNT) + VVXIYI
      DSH(IP,JCOUNT) = DSH(IP,JCOUNT) + VVXJYJ
      ICOUNT = ICOUNT + 1
      JCOUNT = JCOUNT + 1
      DSH(IP,ICOUNT) = DSH(IP,ICOUNT) + VVYIYI
      DSH(IP,JCOUNT) = DSH(IP,JCOUNT) + VVYJYJ
      ICOUNT = ICOUNT + IAPT
      JCOUNT = JCOUNT + JAPT
      DSH(IP,ICOUNT) = DSH(IP,ICOUNT) + VVXIZI
      DSH(IP,JCOUNT) = DSH(IP,JCOUNT) + VVXJZJ
      ICOUNT = ICOUNT + 1
      JCOUNT = JCOUNT + 1
      DSH(IP,ICOUNT) = DSH(IP,ICOUNT) + VVYIZI
      DSH(IP,JCOUNT) = DSH(IP,JCOUNT) + VVYJZJ
      ICOUNT = ICOUNT + 1
      JCOUNT = JCOUNT + 1
      DSH(IP,ICOUNT) = DSH(IP,ICOUNT) + VVZIZI
      DSH(IP,JCOUNT) = DSH(IP,JCOUNT) + VVZJZJ
C
      IF(IATOM-JATOM) 312,313,311
C
  311 ICOUNT = IJAPT
      DSH(IP,ICOUNT  ) = DSH(IP,ICOUNT  ) + VVXIXJ
      DSH(IP,ICOUNT+1) = DSH(IP,ICOUNT+1) + VVXIYJ
      DSH(IP,ICOUNT+2) = DSH(IP,ICOUNT+2) + VVXIZJ
      ICOUNT = ICOUNT + IAPT
      DSH(IP,ICOUNT  ) = DSH(IP,ICOUNT  ) + VVYIXJ
      DSH(IP,ICOUNT+1) = DSH(IP,ICOUNT+1) + VVYIYJ
      DSH(IP,ICOUNT+2) = DSH(IP,ICOUNT+2) + VVYIZJ
      ICOUNT = ICOUNT + IAPT + 1
      DSH(IP,ICOUNT  ) = DSH(IP,ICOUNT  ) + VVZIXJ
      DSH(IP,ICOUNT+1) = DSH(IP,ICOUNT+1) + VVZIYJ
      DSH(IP,ICOUNT+2) = DSH(IP,ICOUNT+2) + VVZIZJ
      GO TO 315
  312 ICOUNT = IJAPT
      DSH(IP,ICOUNT  ) = DSH(IP,ICOUNT  ) + VVXIXJ
      DSH(IP,ICOUNT+1) = DSH(IP,ICOUNT+1) + VVYIXJ
      DSH(IP,ICOUNT+2) = DSH(IP,ICOUNT+2) + VVZIXJ
      ICOUNT = ICOUNT + JAPT
      DSH(IP,ICOUNT  ) = DSH(IP,ICOUNT  ) + VVXIYJ
      DSH(IP,ICOUNT+1) = DSH(IP,ICOUNT+1) + VVYIYJ
      DSH(IP,ICOUNT+2) = DSH(IP,ICOUNT+2) + VVZIYJ
      ICOUNT = ICOUNT + JAPT + 1
      DSH(IP,ICOUNT  ) = DSH(IP,ICOUNT  ) + VVXIZJ
      DSH(IP,ICOUNT+1) = DSH(IP,ICOUNT+1) + VVYIZJ
      DSH(IP,ICOUNT+2) = DSH(IP,ICOUNT+2) + VVZIZJ
      GO TO 315
C                      WHEN IATOM = JATOM
  313 ICOUNT = IJAPT
      DSH(IP,ICOUNT  ) = DSH(IP,ICOUNT  ) + VVXIXJ
      ICOUNT = ICOUNT + IAPT
      DSH(IP,ICOUNT  ) = DSH(IP,ICOUNT  ) + VVXIYJ
      DSH(IP,ICOUNT+1) = DSH(IP,ICOUNT+1) + VVYIYJ
      ICOUNT = ICOUNT + IAPT + 1
      DSH(IP,ICOUNT  ) = DSH(IP,ICOUNT  ) + VVXIZJ
      DSH(IP,ICOUNT+1) = DSH(IP,ICOUNT+1) + VVYIZJ
      DSH(IP,ICOUNT+2) = DSH(IP,ICOUNT+2) + VVZIZJ
 
  315 CONTINUE
  140 CONTINUE
C
  150 CONTINUE
      D1F(1,IC) = D1F(1,IC) + HFDX
c     write(6,*)' d1f; hfdx',hfdx
      D1F(2,IC) = D1F(2,IC) + HFDY
      D1F(3,IC) = D1F(3,IC) + HFDZ
C
      IF(NDERIV.LE.1) GO TO 990
      ICPT=KAPT
C     ICPT=(IC-1)*3+1
      D2F(ICPT  ,ICPT  ) = D2F(ICPT  ,ICPT  ) + HFDXX
      D2F(ICPT+1,ICPT  ) = D2F(ICPT+1,ICPT  ) + HFDXY
      D2F(ICPT+2,ICPT  ) = D2F(ICPT+2,ICPT  ) + HFDXZ
      D2F(ICPT+1,ICPT+1) = D2F(ICPT+1,ICPT+1) + HFDYY
      D2F(ICPT+2,ICPT+1) = D2F(ICPT+2,ICPT+1) + HFDYZ
      D2F(ICPT+2,ICPT+2) = D2F(ICPT+2,ICPT+2) + HFDZZ
      IPT=IAPT
C    IPT=(IATOM-1)*3+1
      D2O(IPT  ,ICPT  ) = D2O(IPT  ,ICPT  ) + DVXIXC
      D2O(IPT  ,ICPT+1) = D2O(IPT  ,ICPT+1) + DVXIYC
      D2O(IPT  ,ICPT+2) = D2O(IPT  ,ICPT+2) + DVXIZC
      D2O(IPT+1,ICPT  ) = D2O(IPT+1,ICPT  ) + DVYIXC
      D2O(IPT+1,ICPT+1) = D2O(IPT+1,ICPT+1) + DVYIYC
      D2O(IPT+1,ICPT+2) = D2O(IPT+1,ICPT+2) + DVYIZC
      D2O(IPT+2,ICPT  ) = D2O(IPT+2,ICPT  ) + DVZIXC
      D2O(IPT+2,ICPT+1) = D2O(IPT+2,ICPT+1) + DVZIYC
      D2O(IPT+2,ICPT+2) = D2O(IPT+2,ICPT+2) + DVZIZC
      JPT=JAPT
C     JPT=(JATOM-1)*3+1
      D2O(JPT  ,ICPT  ) = D2O(JPT  ,ICPT  ) + DVXJXC
      D2O(JPT  ,ICPT+1) = D2O(JPT  ,ICPT+1) + DVXJYC
      D2O(JPT  ,ICPT+2) = D2O(JPT  ,ICPT+2) + DVXJZC
      D2O(JPT+1,ICPT  ) = D2O(JPT+1,ICPT  ) + DVYJXC
      D2O(JPT+1,ICPT+1) = D2O(JPT+1,ICPT+1) + DVYJYC
      D2O(JPT+1,ICPT+2) = D2O(JPT+1,ICPT+2) + DVYJZC
      D2O(JPT+2,ICPT  ) = D2O(JPT+2,ICPT  ) + DVZJXC
      D2O(JPT+2,ICPT+1) = D2O(JPT+2,ICPT+1) + DVZJYC
      D2O(JPT+2,ICPT+2) = D2O(JPT+2,ICPT+2) + DVZJZC
  990 CONTINUE
 1000 CONTINUE
C
 2000 CONTINUE
 3000 CONTINUE
C:::::::::::::::::::::::::
C:::::END OF PRIMITIVES:::
C:::::::::::::::::::::::::
C
      D1O(1,IATOM)=D1O(1,IATOM)+DVDXI+DTDX
c     if(iatom.eq.1)write(6,*)'d1o; dvdxi=',dvdxi,' dtdx=',dtdx
      D1O(2,IATOM)=D1O(2,IATOM)+DVDYI+DTDY
      D1O(3,IATOM)=D1O(3,IATOM)+DVDZI+DTDZ
      D1O(1,JATOM)=D1O(1,JATOM)+DVDXJ-DTDX
      D1O(2,JATOM)=D1O(2,JATOM)+DVDYJ-DTDY
      D1O(3,JATOM)=D1O(3,JATOM)+DVDZJ-DTDZ
      D1W(1,IATOM)=D1W(1,IATOM)+DSDX
      D1W(2,IATOM)=D1W(2,IATOM)+DSDY
      D1W(3,IATOM)=D1W(3,IATOM)+DSDZ
      D1W(1,JATOM)=D1W(1,JATOM)-DSDX
      D1W(2,JATOM)=D1W(2,JATOM)-DSDY
      D1W(3,JATOM)=D1W(3,JATOM)-DSDZ
C
      IF(NDERIV.LE.1) GO TO 4000
C     IPT=(IATOM-1)*3+1
C     JPT=(JATOM-1)*3+1
      IPT=IAPT
      JPT=JAPT
      D2O(IPT  ,IPT  ) = D2O(IPT  ,IPT  ) + DVXIXI + DTDXDX
      D2O(IPT  ,IPT+1) = D2O(IPT  ,IPT+1) + DVXIYI + DTDXDY
      D2O(IPT  ,IPT+2) = D2O(IPT  ,IPT+2) + DVXIZI + DTDXDZ
      D2O(IPT+1,IPT+1) = D2O(IPT+1,IPT+1) + DVYIYI + DTDYDY
      D2O(IPT+1,IPT+2) = D2O(IPT+1,IPT+2) + DVYIZI + DTDYDZ
      D2O(IPT+2,IPT+2) = D2O(IPT+2,IPT+2) + DVZIZI + DTDZDZ
      D2O(IPT  ,JPT  ) = D2O(IPT  ,JPT  ) + DVXIXJ - DTDXDX
      D2O(IPT  ,JPT+1) = D2O(IPT  ,JPT+1) + DVXIYJ - DTDXDY
      D2O(IPT  ,JPT+2) = D2O(IPT  ,JPT+2) + DVXIZJ - DTDXDZ
      D2W(IPT  ,IPT  ) = D2W(IPT  ,IPT  ) + DSDXDX
      D2W(IPT  ,IPT+1) = D2W(IPT  ,IPT+1) + DSDXDY
      D2W(IPT  ,IPT+2) = D2W(IPT  ,IPT+2) + DSDXDZ
      D2W(IPT+1,IPT+1) = D2W(IPT+1,IPT+1) + DSDYDY
      D2W(IPT+1,IPT+2) = D2W(IPT+1,IPT+2) + DSDYDZ
      D2W(IPT+2,IPT+2) = D2W(IPT+2,IPT+2) + DSDZDZ
      D2W(IPT  ,JPT  ) = D2W(IPT  ,JPT  ) - DSDXDX
      D2W(IPT  ,JPT+1) = D2W(IPT  ,JPT+1) - DSDXDY
      D2W(IPT  ,JPT+2) = D2W(IPT  ,JPT+2) - DSDXDZ
      IF(IATOM.NE.JATOM) THEN
      D2O(IPT+1,JPT  ) = D2O(IPT+1,JPT  ) + DVYIXJ - DTDXDY
      D2W(IPT+1,JPT  ) = D2W(IPT+1,JPT  ) - DSDXDY
      END IF
      D2O(IPT+1,JPT+1) = D2O(IPT+1,JPT+1) + DVYIYJ - DTDYDY
      D2O(IPT+1,JPT+2) = D2O(IPT+1,JPT+2) + DVYIZJ - DTDYDZ
      D2W(IPT+1,JPT+1) = D2W(IPT+1,JPT+1) - DSDYDY
      D2W(IPT+1,JPT+2) = D2W(IPT+1,JPT+2) - DSDYDZ
      IF(IATOM.NE.JATOM) THEN
      D2O(IPT+2,JPT  ) = D2O(IPT+2,JPT  ) + DVZIXJ - DTDXDZ
      D2O(IPT+2,JPT+1) = D2O(IPT+2,JPT+1) + DVZIYJ - DTDYDZ
      D2W(IPT+2,JPT  ) = D2W(IPT+2,JPT  ) - DSDXDZ
      D2W(IPT+2,JPT+1) = D2W(IPT+2,JPT+1) - DSDYDZ
      END IF
      D2O(IPT+2,JPT+2) = D2O(IPT+2,JPT+2) + DVZIZJ - DTDZDZ
      D2O(JPT  ,JPT  ) = D2O(JPT  ,JPT  ) + DVXJXJ + DTDXDX
      D2O(JPT  ,JPT+1) = D2O(JPT  ,JPT+1) + DVXJYJ + DTDXDY
      D2O(JPT  ,JPT+2) = D2O(JPT  ,JPT+2) + DVXJZJ + DTDXDZ
      D2O(JPT+1,JPT+1) = D2O(JPT+1,JPT+1) + DVYJYJ + DTDYDY
      D2O(JPT+1,JPT+2) = D2O(JPT+1,JPT+2) + DVYJZJ + DTDYDZ
      D2O(JPT+2,JPT+2) = D2O(JPT+2,JPT+2) + DVZJZJ + DTDZDZ
      D2W(IPT+2,JPT+2) = D2W(IPT+2,JPT+2) - DSDZDZ
      D2W(JPT  ,JPT  ) = D2W(JPT  ,JPT  ) + DSDXDX
      D2W(JPT  ,JPT+1) = D2W(JPT  ,JPT+1) + DSDXDY
      D2W(JPT  ,JPT+2) = D2W(JPT  ,JPT+2) + DSDXDZ
      D2W(JPT+1,JPT+1) = D2W(JPT+1,JPT+1) + DSDYDY
      D2W(JPT+1,JPT+2) = D2W(JPT+1,JPT+2) + DSDYDZ
      D2W(JPT+2,JPT+2) = D2W(JPT+2,JPT+2) + DSDZDZ
C
 4000 CONTINUE
 5000 CONTINUE
C#######################
C#####END OF SHELLS#####
C#######################
C
      RETURN
      END
