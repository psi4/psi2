      SUBROUTINE PQMAT(DM,IND,LBLI,BUFI,NDIM)
      IMPLICIT REAL*8 (A-H,O-Z)
      DIMENSION DM(NDIM),IND(NTRI)
      DIMENSION LBLI(MAXBF4),BUFI(MAXBF2)
      COMMON/BASIS/NBASIS,NTRI
      COMMON/LIMIT/MAXBAS,MAXBUF,MAXBF2,MAXBF4
      COMMON/SIGNS/IOFF(32897),IPRNT
      COMMON/START/FOCC(10),NSORB(10),NSTR(10),NEND(10),MOTYP(256)
      COMMON/TAPES/ITAP35,ITAP91,ITAP92
      COMMON/CI101/IOCC,JOCC,KOCC
      DATA TWO / 2.0D+00 /
    1 FORMAT(2X,I5,3X,4I5,3X,I5,3X,F15.8)
C
C   FORM A DM MATRIX
      CALL ZERO(DM,NDIM)
C
      CALL RFILE(ITAP35)
  500 CONTINUE
      CALL SREAD(ITAP35,LBLI,MAXBF4)
      DO 160 I=1,MAXBUF
      IBA=LBLI(I+I-1)
      IBB=LBLI(I+I)
      IF(IBA.EQ.0) GO TO 501
      VALU=BUFI(MAXBUF+I)
      CALL UNPACK(II,JJ,KK,LL,IZ,IBA,IBB)
      IF(II.LE.IOCC) GO TO 160
      IF(LL.GT.JOCC) GO TO 160
      ITYP=MOTYP(II)
      JTYP=MOTYP(JJ)
      KTYP=MOTYP(KK)
      LTYP=MOTYP(LL)
C     IF(IPRNT.LE.9) GO TO 401
C*    WRITE(6,1) I,II,JJ,KK,LL,IZ,VALU
C*401 CONTINUE
C............  1   2   3   4   5   6   7   8   9  10  11  12  13  14....
      GO TO (160,202,160,160,205,206,207,208,209,210,211,212,213,214),IZ
C
C (II/II)   1=(11/11)
C
C 201 CONTINUE
C
C  (II/KK)  2=(22/11)
C
  202 CONTINUE
      IIKK=IOFF(II)+KK
      IX=IND(IIKK)
      IF(IX.EQ.0) GO TO 160
      IXIX=IOFF(IX+1)
      BETS=BET(ITYP,KTYP,JTYP,LTYP)
      DM(IXIX)=DM(IXIX)+VALU*BETS
      GO TO 160
C
C  (II/IL)  3=(22/21)
C
C 203 CONTINUE
C
C  (IJ/JJ)  4=(21/11)
C
C 204 CONTINUE
C
C  (IJ/IJ)  5=(21/21)
C
  205 CONTINUE
      IIJJ=IOFF(II)+JJ
      IX=IND(IIJJ)
      IF(IX.EQ.0) GO TO 160
      IXIX=IOFF(IX+1)
      ALPS=ALP(ITYP,JTYP,KTYP,LTYP)
      BETS=BET(ITYP,JTYP,KTYP,LTYP)
      DM(IXIX)=DM(IXIX)+VALU*(ALPS+BETS)
      GO TO 160
C
C  (II/KL)  6=(33/21)
C
  206 CONTINUE
      IIKK=IOFF(II)+KK
      JJLL=IOFF(JJ)+LL
      IX=IND(IIKK)
      JX=IND(JJLL)
      IF(IX*JX.EQ.0) GO TO 160
      IXJX=I21D(IX,JX)
      BETS=BET(ITYP,KTYP,JTYP,LTYP)
      DM(IXJX)=DM(IXJX)+VALU*BETS
      GO TO 160
C
C  (IJ/KK)  7=(32/11)
C
  207 CONTINUE
      IIKK=IOFF(II)+KK
      JJLL=IOFF(JJ)+LL
      IX=IND(IIKK)
      JX=IND(JJLL)
      IF(IX*JX.EQ.0) GO TO 160
      IXJX=I21D(IX,JX)
      BETS=BET(ITYP,KTYP,JTYP,LTYP)
      DM(IXJX)=DM(IXJX)+VALU*BETS
      GO TO 160
C
C  (IJ/KK)  8=(31/22)
C
  208 CONTINUE
      IIKK=IOFF(II)+KK
      JJLL=JJ+IOFF(LL)
      IX=IND(IIKK)
      JX=IND(JJLL)
      IF(IX*JX.EQ.0) GO TO 160
      IXJX=I21D(IX,JX)
      BETS=BET(ITYP,KTYP,LTYP,JTYP)
      DM(IXJX)=DM(IXJX)+VALU*BETS
      GO TO 160
C
C (IJ/IL)  9=(32/31)
C
  209 CONTINUE
      IIJJ=IOFF(II)+JJ
      KKLL=IOFF(KK)+LL
      IX=IND(IIJJ)
      JX=IND(KKLL)
      IF(IX*JX.EQ.0) GO TO 160
      IXJX=I21D(IX,JX)
      ALPS=ALP(ITYP,JTYP,KTYP,LTYP)
      BETS=BET(ITYP,JTYP,KTYP,LTYP)
      DM(IXJX)=DM(IXJX)+VALU*(ALPS+BETS)
      GO TO 160
C
C  (IJ/JL)  10=(32/21)
C
  210 CONTINUE
      IIJJ=IOFF(II)+JJ
      KKLL=IOFF(KK)+LL
      IX=IND(IIJJ)
      JX=IND(KKLL)
      IF(IX*JX.EQ.0) GO TO 160
      IXJX=I21D(IX,JX)
      ALPS=ALP(ITYP,JTYP,KTYP,LTYP)
      BETS=BET(ITYP,JTYP,KTYP,LTYP)
      DM(IXJX)=DM(IXJX)+VALU*(ALPS+BETS)
      GO TO 160
C
C  (IJ/KJ)  11=(31/21)
C
  211 CONTINUE
      IIJJ=IOFF(II)+JJ
      KKLL=IOFF(KK)+LL
      IX=IND(IIJJ)
      JX=IND(KKLL)
      IF(IX*JX.EQ.0) GO TO 160
      IXJX=I21D(IX,JX)
      ALPS=ALP(ITYP,JTYP,KTYP,LTYP)
      BETS=BET(ITYP,JTYP,KTYP,LTYP)
      DM(IXJX)=DM(IXJX)+VALU*(ALPS+BETS)
      GO TO 160
C
C  (IJ/KL)  12=(43/21)
C
  212 CONTINUE
      IIJJ=IOFF(II)+JJ
      KKLL=IOFF(KK)+LL
      IX=IND(IIJJ)
      JX=IND(KKLL)
      IF(IX*JX.EQ.0) GO TO 301
      IXJX=I21D(IX,JX)
      ALPS=ALP(ITYP,JTYP,KTYP,LTYP)
      DM(IXJX)=DM(IXJX)+VALU*ALPS
  301 CONTINUE
      IIKK=I21D(II,KK)
      JJLL=I21D(JJ,LL)
      IX=IND(IIKK)
      JX=IND(JJLL)
      IF(IX*JX.EQ.0) GO TO 302
      IXJX=I21D(IX,JX)
      BETS=BET(ITYP,KTYP,JTYP,LTYP)
      DM(IXJX)=DM(IXJX)+VALU*BETS
  302 CONTINUE
      IILL=IOFF(II)+LL
      JJKK=IOFF(JJ)+KK
      IX=IND(IILL)
      JX=IND(JJKK)
      IF(IX*JX.EQ.0) GO TO 160
      IXJX=I21D(IX,JX)
      BETS=BET(ITYP,LTYP,JTYP,KTYP)
      DM(IXJX)=DM(IXJX)+VALU*BETS
      GO TO 160
C
C  (IJ/KL)  13=(42/31)
C
  213 CONTINUE
      IIJJ=IOFF(II)+JJ
      KKLL=IOFF(KK)+LL
      IX=IND(IIJJ)
      JX=IND(KKLL)
      IF(IX*JX.EQ.0) GO TO 311
      IXJX=I21D(IX,JX)
      ALPS=ALP(ITYP,JTYP,KTYP,LTYP)
      DM(IXJX)=DM(IXJX)+VALU*ALPS
  311 CONTINUE
      IIKK=IOFF(II)+KK
      JJLL=IOFF(JJ)+LL
      IX=IND(IIKK)
      JX=IND(JJLL)
      IF(IX*JX.EQ.0) GO TO 312
      IXJX=I21D(IX,JX)
      BETS=BET(ITYP,KTYP,JTYP,LTYP)
      DM(IXJX)=DM(IXJX)+VALU*BETS
  312 CONTINUE
      IILL=IOFF(II)+LL
      JJKK=JJ+IOFF(KK)
      IX=IND(IILL)
      JX=IND(JJKK)
      IF(IX*JX.EQ.0) GO TO 160
      IXJX=I21D(IX,JX)
      BETS=BET(ITYP,LTYP,KTYP,JTYP)
      DM(IXJX)=DM(IXJX)+VALU*BETS
      GO TO 160
C
C  (IJ/KL)  14=(41/32)
C
  214 CONTINUE
      IIJJ=IOFF(II)+JJ
      KKLL=IOFF(KK)+LL
      IX=IND(IIJJ)
      JX=IND(KKLL)
      IF(IX*JX.EQ.0) GO TO 321
      IXJX=I21D(IX,JX)
      ALPS=ALP(ITYP,JTYP,KTYP,LTYP)
      DM(IXJX)=DM(IXJX)+VALU*ALPS
  321 CONTINUE
      IIKK=IOFF(II)+KK
      JJLL=JJ+IOFF(LL)
      IX=IND(IIKK)
      JX=IND(JJLL)
      IF(IX*JX.EQ.0) GO TO 322
      IXJX=I21D(IX,JX)
      BETS=BET(ITYP,KTYP,LTYP,JTYP)
      DM(IXJX)=DM(IXJX)+BALU*BETS
  322 CONTINUE
      IILL=IOFF(II)+LL
      JJKK=JJ+IOFF(KK)
      IX=IND(IILL)
      JX=IND(JJKK)
      IF(IX*JX.EQ.0) GO TO 160
      IXJX=I21D(IX,JX)
      BETS=BET(ITYP,LTYP,KTYP,JTYP)
      DM(IXJX)=DM(IXJX)+VALU*BETS
C
  160 CONTINUE
      GO TO 500
C
  501 CALL RCLOSE(ITAP35,3)
C
      RETURN
      END
