C////////////////////////////////////////////////
      SUBROUTINE OCCUPY(ARC,WGHT,ORBTBF,ISEGM,IUWKMN,IMAIN
     $,                 COEF,CNF,ORDER,POP,BFSYM)
      IMPLICIT INTEGER (A-Z)
      integer max
      DOUBLE PRECISION COEF(MAX)
      DOUBLE PRECISION ACF,DRTVER
      CHARACTER SYMLBL*3,CHTP*3,SYMPRT(150)*7,CODE*4
      INTEGER BMAX,PUWK,PRPFLG,PRINT,ROOTI,ROOTF,SYMOFF,IRSYM
      INTEGER DRTLBL,SCFLBL,SYMDIF
      COMMON /TAPES/IFILE3,IFILE5,IFILE6,ITAPE7,IFIL58,IFIL54,IFIL50
     $,             IFIL51,IDEV,IFIL30
      COMMON /DIMS/ NBF,NSYM,NORBS,NROWS,NROWS4,NWKS,NWKS2,NLEVS
     $,             NWKSMX,NWKMX2,NLWKMX,BMAX,NROOTS,NORBSQ,NBFSQ
     $,             NOCCMX,NREFS,IEND
      COMMON /INTS/ NMAX,NMAX2,NGROUP,NBLKOC,NUMIJ,NUMKL,INTSRT
      COMMON /LOOPS/ACF,IUWK,JUWK,NLWK,IORB,JORB,PUWK
      COMMON /OPS/  PRINT,MAX,NOFLG,PRPFLG,ROOTI,ROOTF,IRSYM
      COMMON /SYMM/ SYMOFF(8),NTOTS(8,2),SYMDIF,SYMLBL(15)
      COMMON /LBLS/ DRTVER,DRTLBL(26),INTLBL(26),SCFLBL(26)
      DIMENSION ARC(NROWS4),WGHT(NROWS4),ORBTBF(NORBS)
      DIMENSION ISEGM(NLEVS),IUWKMN(NLEVS),IMAIN(NLEVS)
      DIMENSION CNF(MAX),ORDER(MAX),POP(MAX,NOCCMX),BFSYM(NBF)
      DIMENSION CODE(4)
      DATA CODE / ' ' , 'A' , 'B' , 'X' /
      DATA MASK/262143/
      DO 10 J=1,MAX
      DO 5 I=1,NOCCMX
    5 POP(J,I)=0.0
   10 POP(J,1)=CNF(J)
      DO 20 J=1,MAX
      J1=J+1
      DO 20 K=J1,MAX
      IF(POP(K,1).GT.POP(J,1)) GO TO 20
      TEMP=ORDER(K)
      ORDER(K)=ORDER(J)
      ORDER(J)=TEMP
      TEMP=POP(K,1)
      POP(K,1)=POP(J,1)
      POP(J,1)=TEMP
   20 CONTINUE
C   IDENTIFY THE CONFIGURATIONS
      LEVH=NLEVS+1
      NPT=1
      IUWKMN(NLEVS)=0
      IMAIN(NLEVS)=1
      PUWK=1
      NCNF=1
      ICNF=ORDER(NCNF)
      TARGET=CNF(ICNF)
  100 LEVH=LEVH-1
      SEGWGT=0
      HSEG=0
      HPT=NPT
  110 HSEG=HSEG+1
      IF(HSEG.LE.4) GO TO 130
  120 LEVH=LEVH+1
      IF(LEVH.GT.NLEVS) GO TO 200
      PUWK=PUWK-IUWKMN(LEVH)
      HSEG=ISEGM(LEVH)
      HPT=IMAIN(LEVH)
      GO TO 110
  130 CONTINUE
      HARPT=4*(HPT-1)+HSEG
      NPT=ARC(HARPT)
      IF(NPT.EQ.0) GO TO 110
      PUWK=PUWK-SEGWGT
      SEGWGT=WGHT(HARPT)
      PUWK=PUWK+SEGWGT
      IUWKMN(LEVH)=SEGWGT
      ISEGM(LEVH)=HSEG
      LEV=LEVH-1
      IMAIN(LEV)=NPT
      IF(LEV.GT.1) GO TO 100
      IF(PUWK.LT.TARGET) GO TO 120
      J=NLEVS
      IORB=0
      DO 140 I=1,NORBS
      J1=J-1
      IF(ISEGM(J).EQ.1) GO TO 140
      IORB=IORB+1
      POP(ICNF,IORB)=ISHFT(ISEGM(J),21)+ORBTBF(J1)
  140 J=J1
      NCNF=NCNF+1
      IF(NCNF.GT.MAX) GOTO 200
      ICNF=ORDER(NCNF)
      TARGET=CNF(ICNF)
      GO TO 120
C   PRINT OUT ALL THIS IN A NICE FORMAT
  200 CONTINUE
      WRITE(IFILE6,210) MAX
  210 FORMAT(1H ,22X,'THE',I4,' MOST IMPORTANT CONFIGURATIONS',/)
      SYMDIF=NSYM
      ASSIGN 240 TO FORM
      IF(NSYM.GT.2) SYMDIF=4
      IF(NSYM.GT.1) ASSIGN 241 TO FORM
      IF(NSYM.GT.4) SYMDIF=8
      IF(NSYM.GT.4) ASSIGN 242 TO FORM
      KKLC=IRSYM+3
      DO 250 I=1,MAX
      DO 220 J=1,NOCCMX
      HSEG=ISHFT(POP(I,J),-21)
      IF(HSEG.EQ.0) GO TO 230
      IMAIN(J)=IAND(POP(I,J),MASK)
      TEMP=BFSYM(IMAIN(J))
      IMAIN(J)=IMAIN(J)-SYMOFF(TEMP+1)
      WRITE(CHTP,'(I3)') IMAIN(J)
      SYMPRT(J)=CHTP//SYMLBL(TEMP+SYMDIF)
  220 SYMPRT(J)=SYMPRT(J)(1:KKLC)//CODE(HSEG)
  230 J=J-1
      WRITE(IFILE6,FORM) I,COEF(I),CNF(I),(SYMPRT(K),K=1,J)
  240 FORMAT(1X,I3,F12.6,' (',I7,')',20A5/3(26X,20A5))
  241 FORMAT(1X,I3,F12.6,' (',I7,')',17A6/3(26X,17A6))
  242 FORMAT(1X,I3,F12.6,' (',I7,')',15A7/3(26X,15A7))
  250 CONTINUE
      RETURN
      END
