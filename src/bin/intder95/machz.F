C     /////////////////////////////////////////////////////////////////
      SUBROUTINE MACHZ(NAD,NC,NS,NSX,IOPT,XA,TYPE,IA,A,S,U,IU,YR1,YR2)
      IMPLICIT REAL*8 (A-H,O-Z)
      INTEGER R,P,Q,NSX,RP,IOPT(30)
      CHARACTER TYPE*5
      DIMENSION TYPE(NS),IA(NS,6),S(NS),U(NS,1),IU(NS,0:1)
      DIMENSION XA(NAD,3),A(NC,NC),YR1(NC,NC,NC),YR2(NC,NC,NC)
      PARAMETER(ZERO=0.0D0,ONE=1.0D0,TWO=2.0D0,THREE=3.0D0)
      COMMON /IO/ IIN1,IOUT,IIN2,ICHECK,NPRT,
     $   I11,I15,I17,I20,I24,
     $   I12,I16,I18,I21,I25,
     $   I31,I32,I33,I35,I36,I37,
     $   ISCR1,ISCR2,ISCR3,ISCR4,ISCR5,ISCR6,ISCR7,ISCR8,ISCR9,ISCR10,
     $   ISCR11,ISCR12,ISCR13,ISCR14
    1 FORMAT(/,1X,'NUMERICAL SR(I,J,K,L) AND Z(M,N,P,Q) MATRICES USED',
     $ /, ' FOR SIMPLE INTERNAL COORDINATE',I5)
      NSYM=IOPT(3)
      IF(NSYM.NE.0) THEN
         ISCR=ISCR10
      ELSE
         ISCR=ISCR9
      END IF
C
CCC  BLOCK FOR INSERTION OF ANALYTICAL Z MATRIX SECTION
C
C     DO 500  R=1,NS
C READ NUMERICAL Z MATRIX AND TRANSFER IF DESIRED.
C     CALL ZIN(NC,NC,SR,-R,ISCR8)
C     CALL ZIN(NC,NSX,Z,R,ISCR8)
C     WRITE(IOUT,1) R
C300  CONTINUE
C     CALL FILL4A(NC,NC,SR)
C     CALL FILL4A(NC,NSX,Z)
C     CALL ZOUT(NC,NC,SR,-R,ISCR)
C     CALL ZOUT(NC,NSX,Z,R,ISCR)
C500  CONTINUE
C
 600  IF(NSYM.EQ.0) RETURN
      DO 650  R=1,NSYM
      DO 660  Q=1,NSYM
         DO 610  P=1,Q
         DO 610  N=1,P
         DO 610  M=1,N
 610     YR1(M,N,P)=ZERO
         L=IU(R,0)
         DO 620  I=1,L
         RP=IU(R,I)
         CALL YIN2(NC,NSYM,YR2,RP,Q,ISCR10)
         W1=U(R,I)
         DO 630  P=1,Q
         DO 630  N=1,P
         DO 630  M=1,N
 630     YR1(M,N,P)=YR1(M,N,P)+W1*YR2(M,N,P)
 620     CONTINUE
         CALL FILL3A(NC,NSYM,YR1)
 660     CALL YOUT2(NC,NSYM,YR1,R,Q,ISCR9)
 650  CONTINUE
C   OPTION
      DO 750  R=1,NSYM
      DO 760  Q=1,NC
         DO 710  P=1,Q
         DO 710  N=1,P
         DO 710  M=1,N
 710     YR1(M,N,P)=ZERO
         L=IU(R,0)
         DO 720  I=1,L
         RP=IU(R,I)
         CALL YIN2(NC,NC,YR2,-RP,Q,ISCR10)
         W1=U(R,I)
         DO 730  P=1,Q
         DO 730  N=1,P
         DO 730  M=1,N
 730     YR1(M,N,P)=YR1(M,N,P)+W1*YR2(M,N,P)
 720     CONTINUE
         CALL FILL3A(NC,NC,YR1)
 760     CALL YOUT2(NC,NC,YR1,-R,Q,ISCR9)
 750  CONTINUE
      RETURN
      END
