      SUBROUTINE AMPGF(B,ELIN,ELX,EE,N3R)
      IMPLICIT REAL*8 (A-H,O-Z)
      integer nvib,n3n
      DIMENSION B(N3R,N3R),ELIN(NVIB,NVIB),ELX(N3N,N3N),EE(N3N,N3N)
      COMMON/VIB101/NATOM,NAT1,N3N,ILIN,NVIB,IDIPOL,IPOLAR
      COMMON/VIB104/PARA,WAVE,CONST,CYCL,CONV
      COMMON/VIB201/CHG(50),X(50),Y(50),Z(50),W(50)
      COMMON/VIB202/R(1275)
      COMMON/VIB205/IOFF(150)
      COMMON/VIB206/SQM(150),DEL(150),FREQ(150)
      DATA A00,ONE / 0.0D+00 , 1.0D+00 /
    1 FORMAT(//,2X,' B MATRIX'/)
    2 FORMAT(//,2X,' L INVERSE MATRIX'/)
    3 FORMAT(//,2X,' M(-1)*B(TR) MATRIX'/)
    4 FORMAT(//,2X,' LX MATRIX'/)
    5 FORMAT(//,2X,' MEAN SQUARE AMPLITUDES OF NORMAL VIBRATIONS'/
     1 2X,4H NO.,5X,11H DEL IN A+2/)
    6 FORMAT(2X,I2,5X,F12.5)
    7 FORMAT(//,2X,' MEAN SQUARE AND ROOT MEAN SQUARE AMPLITUDES (AT 298
     1.15 K)'/
     2 2X,4H NO.,5X,2H X,5X,2H Y,5X,8H L2(X-Y),7X,7H L(X-Y)/
     3 25X,7H IN A+2,8X,5H IN A/)
    8 FORMAT(2X,I2,2X,2(5X,I2),3X,2(F10.5,5X))
C
C   THE CALCULATION OF THE LX MATRIX
C   LX = M(-1)*B(TR)*LIN(TR)
C
C*    WRITE(6,1)
C*    CALL MATOUT(B,N3R,N3R,N3N,N3N,6)
C*    WRITE(6,2)
C*    CALL MATOUT(ELIN,NVIB,NVIB,NVIB,NVIB,6)
C
      DO 102 I=1,N3N
      II=I/3
      IF(I.GT.3*II) II=II+1
      FACT=ONE/W(II)
      DO 101 J=1,NVIB
      EE(I,J)=B(J,I)*FACT
  101 CONTINUE
  102 CONTINUE
C*    WRITE(6,3)
C*    CALL MATOUT(EE,N3N,N3N,N3N,NVIB,6)
      DO 104 I=1,N3N
      DO 104 J=1,NVIB
      VALU=A00
      DO 103 K=1,NVIB
  103 VALU=VALU+EE(I,K)*ELIN(J,K)
      ELX(I,J)=VALU
  104 CONTINUE
      WRITE(6,4)
      CALL FRQOUT(ELX,FREQ,N3N,N3N,N3N,NVIB,6)
C
      WRITE(6,5)
      DO 105 I=1,NVIB
      F2X=EXP(2.0D+00*CONV*DABS(FREQ(I)))
      COTH=(F2X+ONE)/(F2X-ONE)
      DEL(I)=(CONST/FREQ(I))*COTH
  105 WRITE(6,6) I,DEL(I)
      WRITE(6,7)
      IAM=0
      DO 107 I=1,NAT1
      IR=I+1
      DO 107 J=IR,NATOM
      IAM=IAM+1
      IJ=I+IOFF(J)
      R0=R(IJ)
      XR=X(I)-X(J)
      YR=Y(I)-Y(J)
      ZR=Z(I)-Z(J)
      IX=3*I-2
      IY=3*I-1
      IZ=3*I
      JX=3*J-2
      JY=3*J-1
      JZ=3*J
      SAMPXY=A00
      DO 106 K=1,NVIB
      SAMPXY=SAMPXY+DEL(K)*((XR/R0)*(ELX(IX,K)-ELX(JX,K))+
     1 (YR/R0)*(ELX(IY,K)-ELX(JY,K))+(ZR/R0)*(ELX(IZ,K)-ELX(JZ,K)))**2
  106 CONTINUE
      RMSXY=DSQRT(SAMPXY)
      WRITE(6,8) IAM,I,J,SAMPXY,RMSXY
  107 CONTINUE
C
      RETURN
      END
