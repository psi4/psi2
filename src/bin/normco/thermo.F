      SUBROUTINE THERMO
      IMPLICIT REAL*8 (A-H,O-Z)
      COMMON/VIB101/NATOM,NAT1,N3N,ILIN,NVIB,IDIPOL,IPOLAR
      COMMON/VIB105/AIXX,AIYY,AIZZ,SUMW,ROTCM(3)
      COMMON/VIB108/IZVLIM,IPLOT
      COMMON/VIB109/ITHERM,IQELEC
      COMMON/VIB201/CHG(50),X(50),Y(50),Z(50),W(50)
      COMMON/VIB205/IOFF(150)
      COMMON/VIB206/SQM(150),ROOT(150),FREQ(150)
      COMMON/VIB207/VZERO
      DATA PH,BK,AVN / 6.626176D+00 , 1.380662D+00 , 6.022045D+00 /
      DATA A0,HE,EV / 0.52917706D+00 , 4.359813653D+00 , 1.6021892D+00 /
      DATA CL,TEMP / 2.99792458D+00 , 298.15D+00 /
      DATA PI,ALN / 3.1415926536D+00 , 2.3025850930D+00 /
      DATA GASC,GASR,GASV / 1.9872D+00 , 8.20568 , 22.41383D+03 /
      DATA A00 / 0.0D+00 /
    1 FORMAT(//,3X,23(1H*)/2X,' THERMODYNAMIC FUNCTIONS'/3X,23(1H*)
     *       //,2X,' RIGID ROTOR-HARMONIC OSCILLATOR-IDEAL GAS APPROXIMA
     *TION'   /,2X,' VALUES ARE AT 1 ATM AND 298.15 DEGREE KELVIN'
     *        /,2X,' SYMMETRY NUMBER         = ',I5
     *        /,2X,' ELECTRONIC MULTIPLICITY = ',I5)
    2 FORMAT(//,2X,'  CV/R (TRANS.)          = ',F15.6,
     *         10X,'  S/R  (TRANS.)          = ',F15.6/
     *          2X,'  CV/R (ROT.)            = ',F15.6,
     *         10X,'  S/R  (ROT.)            = ',F15.6/
     *          2X,'  CV/R (VIB.)            = ',F15.6,
     *         10X,'  S/R  (VIB.)            = ',F15.6/
     *          2X,'  CV/R (ELEC.)           = ',F15.6,
     *         10X,'  S/R  (ELEC.)           = ',F15.6/
     *          2X,'  CV/R (TOTAL)           = ',F15.6,
     *         10X,'  S/R  (TOTAL)           = ',F15.6/
     *          2X,'  CV   (CAL.DEG.MOLE-1 ) = ',F15.6,
     *         10X,'  S    (CAL.DEG.MOLE-1 ) = ',F15.6)
    3 FORMAT(/ ,2X,'  CP   (CAL.DEG.MOLE-1 ) = ',F15.6)
    4 FORMAT(//,2X,' (E-H00)/RT (TRANS.)     = ',F15.6,
     *         10X,'-(A-H00)/RT (TRANS.)     = ',F15.6/
     *          2X,' (E-H00)/RT (ROT.)       = ',F15.6,
     *         10X,'-(A-H00)/RT (ROT.)       = ',F15.6/
     *          2X,' (E-H00)/RT (VIB.)       = ',F15.6,
     *         10X,'-(A-H00)/RT (VIB.)       = ',F15.6/
     *          2X,' (E-H00)/RT (ELEC.)      = ',F15.6,
     *         10X,'-(A-H00)/RT (ELEC.)      = ',F15.6/
     *          2X,' (E-H00)/RT (TOTAL)      = ',F15.6,
     *         10X,'-(A-H00)/RT (TOTAL)      = ',F15.6/
     *          2X,' (E-H00)    (CAL.MOLE-1) = ',F15.6,
     *         10X,'-(A-H00)    (CAL.MOLE-1) = ',F15.6)
    5 FORMAT(/ ,2X,' (H-H00)    (CAL.MOLE-1) = ',F15.6,
     *         10X,'-(G-H00)    (CAL.MOLE-1) = ',F15.6)
    6 FORMAT(/ ,2X,'  A = E - TS             = ',F15.6,
     *         10X,'  G = H - TS             = ',F15.6)
    7 FORMAT(//,2X,'  Q (TRANS.) (*D+30)     = ',F15.6/
     *          2X,'  Q (ROT.)               = ',F15.6/
     *          2X,'  Q (VIB.)               = ',F15.6/
     *          2X,'  Q (ELEC.)              = ',F15.6/
     *          2X,'  Q (TOTAL)  (*D+30)     = ',F15.6)
    8 FORMAT(/, 2X,'  ZPVE      (CAL.MOLE-1) = ',F15.6,
     *       /, 2X,'  LOWEST LIMIT IN CM-1   = ',F15.6)
C
C   EVALUATION OF THERMODYNAMIC FUNCTIONS
C
      WRITE(6,1) ITHERM,IQELEC
C
C   ZERO-POINT VIBATIONAL ENERGY FROM NORMFX OR NORMGF
      ZLIMIT=FLOAT(IZVLIM)
      CMCAL=(CL*PH*AVN*1.0D-01)/4.184D+00
      ZPVE=VZERO*CMCAL
C
C   ELECTRONIC MULTIPLICITY
      WELEC= FLOAT(IQELEC)
C
C   CALCUALTE PHYSICAL CONSTANTS
      VALU=(2.0D+00*10.0D+00*PI*BK)/(PH*PH*AVN)
C#######################################################################
C##THE FOLLOWINGS ARE A CONSTANT AND FORMULA
C##FOR ENTROPY CALCULATION USING VOLUME
C##   SCONST=2.5D+00 + 1.5D+00*DLOG(VALU) - DLOG(AVN)
C##  *               - 2.0D+00*DLOG(10.0D+00)
C##   SRC=SCONST*GASC
C##   STRN=SCONST + 1.5D+00*DLOG(SUMW) + 1.5D+00*DLOG(TEMP) + DLOG(GASV)
C#######################################################################
C
C##THE FOLLOWINGS ARE A CONSTANT AND FORMULA
C##FOR ENTROPY CALCULATION USING PRESSURE
      SCONST=2.5D+00 + 1.5D+00*DLOG(VALU) - DLOG(AVN)
     *               + DLOG(GASR) - DLOG(10.0D+00)
      SRC=SCONST*GASC
C
      STRN=SCONST + 1.5D+00*DLOG(SUMW) + 2.5D+00*DLOG(TEMP)
      VRC=(1.0D-01*PH*CL)/BK
      CVELEC=A00
      SELEC=DLOG(WELEC)
      EELEC=A00
      AELEC=DLOG(WELEC)
      QELEC=WELEC
      QTRN=DSQRT((VALU*SUMW*TEMP)**3)*GASR*TEMP/1.0D+08
C
      IF(NATOM.EQ.2) GO TO 201
      IF(ILIN.NE.0) GO TO 203
      GO TO 206
C
C#######################
C###DIATOMIC MOLECULE###
C#######################
  201 CONTINUE
      RCONST=(VRC*ROTCM(1))/TEMP
      VCONST=(VRC*FREQ(1))/TEMP
      EXPVIB=DEXP(VCONST)
      DNUM=EXPVIB-1.0D+00
      IF(W(1).EQ.W(2)) THEN
        SIGMA=2.0D+00
      ELSE
        SIGMA=1.0D+00
      END IF
C
C  HEAT CAPACITY AT CONSTANT VOLUME
      CVTRN=1.5D+00
      CVROT=1.0D+00
      CVVIB=(VCONST*VCONST)*(EXPVIB/(DNUM*DNUM))
      CVTOT=CVTRN + CVROT + CVVIB + CVELEC
      CVCAL=CVTOT*GASC
C
C  ENTROPY
      SROT=1.0D+00 - DLOG(RCONST) - DLOG(SIGMA)
      SVIB=VCONST/DNUM + DLOG(EXPVIB/DNUM)
      STOT=STRN + SROT + SVIB + SELEC
      SCAL=STOT*GASC
      WRITE(6,2) CVTRN,STRN,CVROT,SROT,CVVIB,SVIB,CVELEC,SELEC,
     *           CVTOT,STOT,CVCAL,SCAL
C
C  HEAT CAPACITY AT CONSTANT PRESSURE
      CPCAL=(CVTOT+1.0D+00)*GASC
      WRITE(6,3) CPCAL
C
C  ENERGY
      ETRN=1.5D+00
      EROT=1.0D+00
      EVIB=VCONST/DNUM
      ETOT=ETRN + EROT + EVIB + EELEC
      ECAL=ETOT*GASC*TEMP
      HCAL=(ETOT+1.0D+00)*GASC*TEMP
C
C  FREE ENERGY
      ATRN=STRN - 2.5D+00 + 1.0D+00
      AROT=-DLOG(RCONST) - DLOG(SIGMA)
      AVIB=DLOG(EXPVIB/DNUM)
      ATOT=ATRN + AROT + AVIB + AELEC
      ACAL=ATOT*GASC*TEMP
      GCAL=(ATOT-1.0D+00)*GASC*TEMP
C
      WRITE(6,4) ETRN,ATRN,EROT,AROT,EVIB,AVIB,EELEC,AELEC,
     *           ETOT,ATOT,ECAL,ACAL
      WRITE(6,5) HCAL,GCAL
C
C  TEST FOR THE CALCULATION
C  USING THE RELATIONSHIPS :  A = E - TS   &  G = H - TS
      ATEST=ECAL - TEMP*SCAL
      GTEST=HCAL - TEMP*SCAL
      WRITE(6,6) ATEST,GTEST
C
C  PARTITION FUNCTION
      QROT=1.0D+00/(RCONST*SIGMA)
      QVIB=EXPVIB/DNUM
      QTOT=QTRN * QROT * QVIB * QELEC
      WRITE(6,7) QTRN,QROT,QVIB,QELEC,QTOT
C
C  ZERO-POINT VIBRATIONAL ENERGY
      WRITE(6,8) ZPVE,ZLIMIT
C
      GO TO 210
C
C################################
C###LINEAR POLYATOMIC MOLECULE###
C################################
  203 CONTINUE
      SIGMA=FLOAT(ITHERM)
C
C  HEAT CAPACITY AT CONSTANT VOLUME
      CVTRN=1.5D+00
      CVROT=1.0D+00
      CVVIB=A00
C
C  ENTROPY
      RCONST=(VRC*ROTCM(1))/TEMP
      SROT=1.0D+00 - DLOG(RCONST) - DLOG(SIGMA)
      SVIB=A00
C
C  ENERGY
      ETRN=1.5D+00
      EROT=1.0D+00
      EVIB=A00
C
C  FREE ENERGY
      ATRN=STRN - 2.5D+00 +1.0D+00
      AROT=-DLOG(RCONST) -DLOG(SIGMA)
      AVIB=A00
C
C  PARTITION FUNCTION
      QROT=1.0D+00/(RCONST*SIGMA)
      QVIB=1.0D+00
C
      DO 101 I=1,NVIB
      IF(FREQ(I).LT.ZLIMIT) GO TO 101
      VCONST=(VRC*FREQ(I))/TEMP
      EXPVIB=DEXP(VCONST)
      DNUM=EXPVIB-1.0D+00
      CVVIB=CVVIB + (VCONST*VCONST)*(EXPVIB/(DNUM*DNUM))
      SVIB=SVIB + VCONST/DNUM + DLOG(EXPVIB/DNUM)
      EVIB=EVIB + VCONST/DNUM
      AVIB=AVIB + DLOG(EXPVIB/DNUM)
      QVIB=QVIB*(EXPVIB/DNUM)
  101 CONTINUE
C
C  TOTAL HEAT CAPACITY AT CONSTANT VOLUME
      CVTOT=CVTRN + CVROT + CVVIB + CVELEC
      CVCAL=CVTOT*GASC
C
C  TOTAL ENTROPY
      STOT=STRN + SROT + SVIB + SELEC
      SCAL=STOT*GASC
      WRITE(6,2) CVTRN,STRN,CVROT,SROT,CVVIB,SVIB,CVELEC,SELEC,
     *           CVTOT,STOT,CVCAL,SCAL
C
C  HEAT CAPACITY AT CONSTANT PRESSURE
      CPCAL=(CVTOT+1.0D+00)*GASC
      WRITE(6,3) CPCAL
C
C  TOTAL ENERGY
      ETOT=ETRN + EROT + EVIB + EELEC
      ECAL=ETOT*GASC*TEMP
      HCAL=(ETOT+1.0D+00)*GASC*TEMP
C
C  TOTAL FREE ENERGY
      ATOT=ATRN + AROT + AVIB + AELEC
      ACAL=ATOT*GASC*TEMP
      GCAL=(ATOT-1.0D+00)*GASC*TEMP
      WRITE(6,4) ETRN,ATRN,EROT,AROT,EVIB,AVIB,EELEC,AELEC,
     *           ETOT,ATOT,ECAL,ACAL
      WRITE(6,5) HCAL,GCAL
C
C  TEST FOR THE CALCULATION
C  USING THE RELATIONSHIPS :  A = E - TS   &  G = H - TS
      ATEST=ECAL - TEMP*SCAL
      GTEST=HCAL - TEMP*SCAL
      WRITE(6,6) ATEST,GTEST
C
C  TOTAL PARTITION FUNCTION
      QTOT=QTRN * QROT * QVIB * QELEC
      WRITE(6,7) QTRN,QROT,QVIB,QELEC,QTOT
C
C  ZERO-POINT VIBRATIONAL ENERGY
      WRITE(6,8) ZPVE,ZLIMIT
      GO TO 210
C
C####################################
C###NON-LINEAR POLYATOMIC MOLECULE###
C####################################
  206 CONTINUE
      SIGMA=FLOAT(ITHERM)
C
C  HEAT CAPACITY AT CONSTANT VOLUME
      CVTRN=1.5D+00
      CVROT=1.5D+00
      CVVIB=A00
C
C  ENTROPY
      RCONS1=(VRC*ROTCM(1))/TEMP
      RCONS2=(VRC*ROTCM(2))/TEMP
      RCONS3=(VRC*ROTCM(3))/TEMP
      SROT=1.5D+00 - 0.5D+00*DLOG((RCONS1*RCONS2*RCONS3)/PI)
     *             - DLOG(SIGMA)
      SVIB=A00
C
C  ENERGY
      ETRN=1.5D+00
      EROT=1.5D+00
      EVIB=A00
C
C  FREE ENERGY
      ATRN=STRN - 2.5D+00 + 1.0D+00
      AROT=-0.5D+00*DLOG((RCONS1*RCONS2*RCONS3)/PI) - DLOG(SIGMA)
      AVIB=A00
C
C  PARTITION FUNCTION
      QROT=DSQRT(PI/(RCONS1*RCONS2*RCONS3))/SIGMA
      QVIB=1.0D+00
C
      DO 102 I=1,NVIB
      IF(FREQ(I).LT.ZLIMIT) GO TO 102
      VCONST=(VRC*FREQ(I))/TEMP
      EXPVIB=DEXP(VCONST)
      DNUM=EXPVIB-1.0D+00
      CVVIB=CVVIB + (VCONST*VCONST)*(EXPVIB/(DNUM*DNUM))
      SVIB=SVIB + VCONST/DNUM + DLOG(EXPVIB/DNUM)
      EVIB=EVIB + VCONST/DNUM
      AVIB=AVIB + DLOG(EXPVIB/DNUM)
      QVIB=QVIB*(EXPVIB/DNUM)
  102 CONTINUE
C
C  TOTAL HEAT CAPACITY AT CONSTANT VOLUME
      CVTOT=CVTRN + CVROT + CVVIB + CVELEC
      CVCAL=CVTOT*GASC
C
C  TOTAL ENTROPY
      STOT=STRN + SROT + SVIB + SELEC
      SCAL=STOT*GASC
      WRITE(6,2) CVTRN,STRN,CVROT,SROT,CVVIB,SVIB,CVELEC,SELEC,
     *           CVTOT,STOT,CVCAL,SCAL
C
C  HEAT CAPACITY AT CONSTANT PRESSURE
      CPCAL=(CVTOT+1.0D+00)*GASC
      WRITE(6,3) CPCAL
C
C  TOTAL ENERGY
      ETOT=ETRN + EROT + EVIB + EELEC
      ECAL=ETOT*GASC*TEMP
      HCAL=(ETOT+1.0D+00)*GASC*TEMP
C
C  TOTAL FREE ENERGY
      ATOT=ATRN + AROT + AVIB + AELEC
      ACAL=ATOT*GASC*TEMP
      GCAL=(ATOT-1.0D+00)*GASC*TEMP
      WRITE(6,4) ETRN,ATRN,EROT,AROT,EVIB,AVIB,EELEC,AELEC,
     *           ETOT,ATOT,ECAL,ACAL
      WRITE(6,5) HCAL,GCAL
C
C  TEST FOR THE CALCULATION
C  USING THE RELATIONSHIPS :  A = E - TS   &  G = H - TS
      ATEST=ECAL - TEMP*SCAL
      GTEST=HCAL - TEMP*SCAL
      WRITE(6,6) ATEST,GTEST
C
C  TOTAL PARTITION FUNCTION
      QTOT=QTRN * QROT * QVIB * QELEC
      WRITE(6,7) QTRN,QROT,QVIB,QELEC,QTOT
C
C  ZERO-POINT VIBRATIONAL ENERGY
      WRITE(6,8) ZPVE,ZLIMIT
C
  210 CONTINUE
      RETURN
      END
