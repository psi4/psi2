      SUBROUTINE POPUL(P,SS,AOPOP,BATM)
      IMPLICIT REAL*8 (A-H,O-Z)
      LOGICAL IANDJ,EQUAL
      COMMON/BASIS/NBASIS,NBFAO,NBFSO,NBATRI
      COMMON/COORD/CHGS(112),X(3,112),W(112)
      COMMON/FUNCS/NATOM,N3N,NSYM
      COMMON/NORBS/NAST(112),NAED(112)
      COMMON/QVALS/QORB(256),QATM(112),QNET(112)
      COMMON/SIGNS/IPQ(500),IPRNT
      DIMENSION P(NBATRI),SS(NBATRI),AOPOP(NBATRI),BATM(NATOM,NATOM)
      DATA ZERO / 0.0D+00 /
    1 FORMAT(/,2X,' ATOMIC ORBITAL POPULATION'/)
    2 FORMAT(//,2X,' GROSS ORBITAL POPULATION'/5X,'AO',9X,'Q(AO)'/)
    3 FORMAT(3X,I4,5X,F10.5)
    4 FORMAT(//,2X,' ATOMIC BOND POPULATION'/)
    5 FORMAT(//,2X,' GROSS ATOMIC POPULATION AND NET CHARGE'/
     1 5X,'ATOM',7X,'Q(ATOM)',7X,' QNET'/)
    6 FORMAT(3X,I4,5X,F10.5,5X,F10.5)
C
C   CALCULATE THE ATOMIC ORBITAL POPULATION
      DO 101 I=1,NBATRI
      AOPOP(I)=P(I)*SS(I)
  101 CONTINUE
      IF(IPRNT.LE.2) GO TO 201
      WRITE(6,1)
c
crsg change nbasis to nbfao for 5d7f9g
crsg  CALL PRINT(AOPOP,NBATRI,NBASIS,6)
      CALL PRINT(AOPOP,NBATRI,nbfao,6)
C
C   CALCULATE THE GROSS ORBITAL POPULATION
  201 CONTINUE
c
crsg  change range of do loops from nbasis to nbfao for 5d7f9g
crsg
crsg  DO 103 I=1,NBASIS
crsg  VAL=ZERO
crsg  DO 102 J=1,NBASIS
      DO 103 I=1,nbfao
      VAL=ZERO
      DO 102 J=1,nbfao
      IJ=IPQ(MAX0(I,J))+MIN0(I,J)
      VAL=VAL+AOPOP(IJ)
  102 CONTINUE
      QORB(I)=VAL
  103 CONTINUE
      WRITE(6,2)
C     DO 104 I=1,NBASIS
C     WRITE(6,3) I,QORB(I)
C 104 CONTINUE
C
crsg change nbasis to nbfao for 5d7f9g
crsg  WRITE(6,'(10(I4,F9.5))')(I,QORB(I),I=1,NBASIS)
      WRITE(6,'(10(I4,F9.5))')(I,QORB(I),I=1,nbfao)
C
C   CALCULATE THE ATOMIC BOND POPULATION AND GROSS ATOMIC POPULATION
      DO 105 I=1,NATOM
      QATM(I)=ZERO
      DO 105 J=1,NATOM
      BATM(I,J)=ZERO
  105 CONTINUE
      DO 110 IATOM=1,NATOM
      IST=NAST(IATOM)
      IED=NAED(IATOM)
      DO 106 I=IST,IED
  106 QATM(IATOM)=QATM(IATOM)+QORB(I)
      DO 109 JATOM=1,NATOM
      JST=NAST(JATOM)
      JED=NAED(JATOM)
      DO 107 I=IST,IED
      DO 107 J=JST,JED
      IJ=IPQ(MAX0(I,J))+MIN0(I,J)
      BATM(IATOM,JATOM)=BATM(IATOM,JATOM)+AOPOP(IJ)
  107 CONTINUE
  109 CONTINUE
  110 CONTINUE
C
      WRITE(6,4)
      CALL MATOUT(BATM,NATOM,NATOM,NATOM,NATOM,6)
      WRITE(6,5)
      DO 112 I=1,NATOM
      QNET(I)=CHGS(I)-QATM(I)
      WRITE(6,6) I,QATM(I),QNET(I)
  112 CONTINUE
C
      RETURN
      END
