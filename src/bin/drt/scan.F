      SUBROUTINE SCAN(NTYPE,BFNUM,NUMSYM,BFSYM,BFCODE)
C
C***********************************************************************
C     READS IN THE ORBITAL CODES USING FOUR FUNCTION SUBROUTINES--     *
C     GETCNT, GETKEY, GETCOD AND GETSYM AND FILLS THE ARRAYS NTYPE     *
C     WITH NO. ORBITALS OF A TYPE,NUMSYM WITH NO. OF SYMMETRY AND TYPE,*
C     BFNUM WITH SCF NO. OF ORBITAL OF TYPE AND NO. WITHIN TYPE FOR USE*
C     IN REORDR TO REORDER THE ORBITALS. SINCE THE INPUT SUBROUTINES   *
C     IGNORE BLANKS, THE INPUT IS FREE FORMAT AND CODES MAY BE SPLIT   *
C     OVER LINES, ETC. THE LAST PORTION OF THIS ROUTINE READS IN MULTI-*
C     REFERENCE ORBITALS.                                              *
C***********************************************************************
C
      IMPLICIT INTEGER (A-Z)
      INTEGER NUMINT
      CHARACTER*1 MULTRF,VALENC,CLEF,JUNK1,BFKEY,GETKEY
      CHARACTER*3 CODES,WORDS
      CHARACTER*4 LABEL
C
      COMMON /CBFKEY/ BFKEY(1000)
      COMMON /DRTINF/ NA,NB,NS,NESPEC,MAXB,LEVFRM,LEVVAL,LEVOPN,LEVMUL
     #,               LEVOCC,SPEC,SSPESH,VAL
      COMMON /DIMENS/ NBF,NSYM,NORBS,NROWSP,NROW4P,NROWS,NROWS4
     #,               NLEVS,NREFS,NROWOC,NROW4O,NWKS,NWKSOC,NLEVOC
     #,               ORBFRM,SYMORB,NUMIJ,NGROUP,NUMINT,NMAX,NSPC,NVREF
     #,               NIJVIR
      COMMON /DRTCOD/ NCODES,DELA(9),DELB(9),DELELE(9)
     #,               NTYPES,VIRTUL,OCCUPD,VALOCC,RESCOR,RESVIR,FROZEN
     #,               VALVIR,OPENSH,MULTI,SPESHL,MULTRF,VALENC
     #,               WORDS(6,9),CODES(9)
      COMMON /CODE/   FZC, FZV, COR, VIR, DOC, UOC, ALP, BET, SPE
      COMMON /TAPES/  OUT,ERROUT,INPUT,DRTTAP
      COMMON /OPTION/ OPTION(16),IDENT(26),LABEL(26)
C
      DIMENSION NTYPE(NTYPES),BFNUM(NTYPES,NBF),NUMSYM(NTYPES,NSYM)
      DIMENSION BFSYM(NBF),BFCODE(NREFS,NBF)
C
      WRITE (OUT,11)
   11 FORMAT (//,T28,'**** ORBITAL INFORMATION ****',//
     #,      T21,'BASIS FCTS',T33,'#',T35,'KEY',T42,'TYPE OF ORBITAL'
     #,      T59,'SYM',/,T21,'----------',T33,'-',T35,'---',T42
     #,      '---------------',T59,'---')
      BF=0
      NORBS=0
      CALL GETLIN
C
    2 IF (BF.GE.NBF) GO TO 4
      REPCNT=GETCNT()
clj080889      CLEF=GETKEY()
      call newkey(clef)
      CODE=GETCOD()
      SYM=GETSYM()
      WRITE(OUT,1)BF+1,BF+REPCNT,REPCNT,CLEF,(WORDS(I,CODE),I=1,6),SYM+1
    1 FORMAT (T22,I3,'-',I3,I4,2X,A1,T43,6A3,T61,I1)
      DO 3 JUNK=1,REPCNT
         BF=BF+1
         IF (CODE.NE.FZC.AND.CODE.NE.FZV) NORBS=NORBS+1
         TYPE=OCCUPD
         IF (CODE.EQ.SPE) TYPE=SPESHL
         IF (CODE.EQ.SPE) SSPESH=IEOR(SSPESH,SYM)
         IF (CODE.EQ.UOC) TYPE=VIRTUL
         IF (CODE.EQ.FZC.OR.CODE.EQ.FZV) TYPE=FROZEN
         IF (CODE.EQ.COR) TYPE=RESCOR
         IF (CODE.EQ.VIR) TYPE=RESVIR
         IF (CODE.EQ.ALP.OR.CODE.EQ.BET) TYPE=OPENSH
         IF (CLEF.EQ.VALENC.AND.CODE.NE.UOC) TYPE=VALOCC
         IF (CLEF.EQ.VALENC.AND.CODE.EQ.UOC) TYPE=VALVIR
         IF (CLEF.EQ.MULTRF) TYPE=MULTI
         NTYPE(TYPE)=NTYPE(TYPE)+1
         BFNUM(TYPE,NTYPE(TYPE))=BF
         NUMSYM(TYPE,SYM)=NUMSYM(TYPE,SYM)+1
         BFSYM(BF)=SYM
         BFKEY(BF)=CLEF
         BFCODE(1,BF)=CODE
    3 CONTINUE
      GO TO 2
C
    4 CONTINUE
C
C     ----- CHECK FOR MULTI REFERENCE OF VALENCE-SPACE CIS -----
C                  TO DISABLE THE INTERACTING SPACE
      IF (NTYPE(MULTI).NE.0) OPTION(4)=1
C
      SPEC=NTYPE(SPESHL)
C
      IF (NREFS.LT.2) RETURN
C
      DO 10 REF=2,NREFS
         WRITE (OUT,12) REF
   12    FORMAT (//,T30,'REFERENCE #',I3,//,T25,'BASIS FCT',T35,'TYPE OF
     * ',       'ORBITAL',T54,'SYM',/,T25,'---------',T35,'--------'
     #   ,       '-------',T54,'---')
         DO 9 BF=1,NBF
            IF (BFKEY(BF).EQ.MULTRF) GO TO 5
            BFCODE(REF,BF)=BFCODE(1,BF)
            GO TO 8
    5       CONTINUE
clj080889            JUNK1=GETKEY()
            call newkey(junk1)
            BFCODE(REF,BF)=GETCOD()
CVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV
C ORIGINAL  IF (BFSYM(BF).EQ.GETSYM()) GO TO 7
            QETSYM=GETSYM()
            IF (BFSYM(BF).EQ.QETSYM) GO TO 7
C^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            WRITE (OUT,6) REF,BF
            WRITE (ERROUT,6) REF,BF
    6       FORMAT (//,' SYMMETRY ERROR IN REFERENCE',I4,', BASIS FNCT',
     *      I4,//)
            CALL mabort
    7       CONTINUE
            WRITE (OUT,13) BF,(WORDS(I,BFCODE(REF,BF)),I=1,6),BFSYM(BF)+
     *      1
   13       FORMAT (T25,I5,5X,6A3,2X,I1)
    8       CONTINUE
    9    CONTINUE
   10 CONTINUE
      RETURN
      END
