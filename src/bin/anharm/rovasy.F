C     PROGRAM ANHASY
C***********************************************************
C***LAST UPDATED ON SEPTEMBER 07, 1987 BY YUKIO YAMAGUCHI***
C***********************************************************
      SUBROUTINE ROVASY(ZETA,AXY,F3Q,EE,RVCNST)
C   THE CALCULATION OF VIBRATION-ROTATION INTERACTION CONSTANTS
C   FOR AN ASYMMETRIC TOP MOLECULE
      IMPLICIT REAL*8 (A-H,O-Z)
      CHARACTER*1 RAXIS
      CHARACTER*25 RTYPE
      DIMENSION ZETA(N3N,N3N,3),AXY(3,3,N3N)
      DIMENSION F3Q(N3N,N3N,N3N),EE(N3N,N3N),RVCNST(NVIB,3)
      COMMON/VIB101/NATOM,N3N,NATRI,ILIN,NVIB
      COMMON/VIB102/ITHREE,IFOUR,N3TOT,N4TOT
      COMMON/VIB103/PARA,WAVE,CONST,CYCL,CONV
      COMMON/VIB106/ROTAA(3),ROTGC(3),ROTCM(3),ROTMH(3)
      COMMON/VIB108/IAXIS(3),NDEG(150),NDAB(150,5),IMAG(150)
      COMMON/VIB109/CLIMIT,FLIM1,FLIM2
      COMMON/VIB203/IOFF(150),IPRNT
      COMMON/VIB204/SQM(150),ROOT(150),FREQ(150)
      COMMON/VIB205/IFREQ,NFRQ(150)
      COMMON/VIB206/RAXIS(3),RTYPE(6)
      COMMON/VIB209/SALP(3)
      DATA PH,AVN / 6.626176D+00 , 6.022045D+00 /
      DATA PI,CL / 3.1415926536D+00 , 2.99792458D+00 /
      DATA A00,HALF,ONE,TWO / 0.0D+00 , 0.5D+00 , 1.0D+00 , 2.0D+00 /
      DATA WLIMIT / 1.0D+00 /
      DATA ZLIMIT / 1.0D-05 /
    1 FORMAT(//,2X,' **************************************************'
     1        /,2X,' ***THE VIBRATION-ROTATION INTERACTION CONSTANTS***'
     2        /,2X,' **************************************************'
     3        )
    2 FORMAT(//,2X,' ZETA MATRIX, IABC = ',I5/)
    3 FORMAT(//,2X,' F3(QI*QJ*QK) MATRIX (IN CM-1), IVIB = ',I5/)
    4 FORMAT(//,2X,' AXY MATRIX, IVIB = ',I5/)
    5 FORMAT(//,2X,' QVIB',5X,' IVIB',10X,' A',21X,' B',21X,' C'/
     1          27X,' IN CM-1',15X,' IN CM-1',15X,' IN CM-1'/)
    6 FORMAT(2X,I5,5X,I5,3X,F20.10,3X,F20.10,3X,F20.10)
    7 FORMAT(//,2X,' PRINCIPAL MOMENTS OF INERTIA WITH ZERO-POINT VIBRAT
     1IONAL CORRECTION'/
     2 4X,5H AXIS,9X,11H IN AMU.A+2,9X,10H IN G.CM+2,10X,
     3 8H IN CM-1,15X,7H IN MHZ/38X,8H (*D+39)/)
    8 FORMAT(8X,A1,3X,3F20.10,F20.5)
    9 FORMAT(//,2X,' ::::::::::::::::::::::::::::::::::::'/
     1          2X,' :::CORIOLIS RESONANCE IS OBSERVED:::'/
     2          2X,' ::::::::::::::::::::::::::::::::::::'/)
   10 FORMAT(2X,' NUMBER OF OCCURENCES IS ',I5/
     1       2X,' RESONANCE LIMIT IS SET TO ',F10.3,' CM-1'/)
C
      WRITE(6,1)
      RCONST=1.0D-01*PI*DSQRT(CL/(PH*AVN))
      IAA=IAXIS(1)
      IBB=IAXIS(2)
      ICC=IAXIS(3)
      NCORIO=0
C
      IF(IPRNT.LE.2) GO TO 201
      DO 101 IABC=1,3
      WRITE(6,2) IABC
      CALL MATOUT(ZETA(1,1,IABC),N3N,N3N,N3N,N3N,6)
  101 CONTINUE
      DO 103 III=1,NVIB
      IVIB=NFRQ(III)
      WRITE(6,3) IVIB
      DO 102 I=1,NVIB
      II=NFRQ(I)
      DO 102 J=1,NVIB
      JJ=NFRQ(J)
      EE(I,J)=F3Q(II,JJ,IVIB)
  102 CONTINUE
      CALL ANHOUT(EE,N3N,N3N,NVIB,NVIB,6)
  103 CONTINUE
      DO 104 IVIB=1,NVIB
      WRITE(6,4) IVIB
      CALL MATOUT(AXY(1,1,IVIB),3,3,3,3,6)
  104 CONTINUE
C
  201 CONTINUE
      DO 110 IVIB=1,NVIB
      FRQI=FREQ(IVIB)
      FRQI2=FRQI*FRQI
      VALUA1=A00
      VALUB1=A00
      VALUC1=A00
      DO 106 I=1,3
      VALUA1=VALUA1+(AXY(IAA,IAXIS(I),IVIB)**2/ROTAA(I))*0.75D+00
      VALUB1=VALUB1+(AXY(IBB,IAXIS(I),IVIB)**2/ROTAA(I))*0.75D+00
      VALUC1=VALUC1+(AXY(ICC,IAXIS(I),IVIB)**2/ROTAA(I))*0.75D+00
  106 CONTINUE
      VALUA2=A00
      VALUB2=A00
      VALUC2=A00
      VALUA3=A00
      VALUB3=A00
      VALUC3=A00
      DO 107 JVIB=1,NVIB
      FRQJ=FREQ(JVIB)
      FRQJ2=FRQJ*FRQJ
      IF(IVIB.EQ.JVIB) GO TO 205
      IF(DABS(FRQI-FRQJ).LE.CLIMIT) GO TO 203
      FACT2=(FRQI2*3.0D+00+FRQJ2)/(FRQI2-FRQJ2)
      GO TO 204
C////////////////////////////////////
C///CORIOLIS RESONANCE CORRECTIONS///
C////////////////////////////////////
  203 CONTINUE
      FACT2=-(0.5D+00*(FRQI-FRQJ)**2)/(FRQJ*(FRQI+FRQJ))
      IF(DABS(ZETA(IVIB,JVIB,IAA)).GT.ZLIMIT) THEN
        NCORIO=NCORIO+1
      END IF
      IF(DABS(ZETA(IVIB,JVIB,IBB)).GT.ZLIMIT) THEN
        NCORIO=NCORIO+1
      END IF
      IF(DABS(ZETA(IVIB,JVIB,ICC)).GT.ZLIMIT) THEN
        NCORIO=NCORIO+1
      END IF
C///////////////////////////////
C///END OF CORIOLIS RESONANCE///
C///////////////////////////////
  204 CONTINUE
      VALUA2=VALUA2+(ZETA(IVIB,JVIB,IAA)**2)*FACT2
      VALUB2=VALUB2+(ZETA(IVIB,JVIB,IBB)**2)*FACT2
      VALUC2=VALUC2+(ZETA(IVIB,JVIB,ICC)**2)*FACT2
  205 CONTINUE
      FACT3=(FRQI*F3Q(IVIB,IVIB,JVIB)*RCONST)/(FRQJ**(1.5D+00))
      VALUA3=VALUA3+AXY(IAA,IAA,JVIB)*FACT3
      VALUB3=VALUB3+AXY(IBB,IBB,JVIB)*FACT3
      VALUC3=VALUC3+AXY(ICC,ICC,JVIB)*FACT3
  107 CONTINUE
      ROTA=-(VALUA1+VALUA2+VALUA3)*(ROTCM(1)*ROTCM(1)*TWO)/FRQI
      ROTB=-(VALUB1+VALUB2+VALUB3)*(ROTCM(2)*ROTCM(2)*TWO)/FRQI
      ROTC=-(VALUC1+VALUC2+VALUC3)*(ROTCM(3)*ROTCM(3)*TWO)/FRQI
      RVCNST(IVIB,1)=ROTA
      RVCNST(IVIB,2)=ROTB
      RVCNST(IVIB,3)=ROTC
  110 CONTINUE
C
C   CALCULATE THE ROTATIONAL CONSTANTS
C   WITH ZERO-POINT VIBRATIONAL CORRECTION
      CALL ZERO(SALP,3)
      WRITE(6,5)
      DO 115 III=1,NVIB
      IVIB=NFRQ(III)
      ROTA=RVCNST(IVIB,1)
      ROTB=RVCNST(IVIB,2)
      ROTC=RVCNST(IVIB,3)
      SALP(1)=SALP(1)+ROTA
      SALP(2)=SALP(2)+ROTB
      SALP(3)=SALP(3)+ROTC
      WRITE(6,6) III,IVIB,ROTA,ROTB,ROTC
  115 CONTINUE
      WRITE(6,7)
      DO 116 I=1,3
      PB=ROTCM(I)-SALP(I)*HALF
      PT=CONST/PB
      PA=PT*PARA
      PC=CYCL/PT
      WRITE(6,8) RAXIS(I),PT,PA,PB,PC
  116 CONTINUE
C
      IF(NCORIO.NE.0) THEN
        WRITE(6,9)
        WRITE(6,10) NCORIO,CLIMIT
      END IF
C
      RETURN
      END
