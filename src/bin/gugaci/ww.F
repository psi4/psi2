      SUBROUTINE ww(INT,C,S,IJADD,KADD,LADD,WTW,WTX,WTY,WAB,SS
     #,                 CI,SI,CJ,SJ,H1,H2,IJXX,NKLXX,IJWW,NKLWW
     #,                 KLXX,KLWW)
C
C
      IMPLICIT REAL*8 (A-H,O-Z)
CTJL 1               CI,SI,CJ,SJ,H1,H2,IJXX,NKLXX,IJWW,NKLWW,
CTJL 2               KLXX,KLWW
C
      real*8 sqrt2,sqrt3,sqt1p5,asqrt2,hsqrt3
      INTEGER ARR,TR1,TR2,ASM,OS,WTW,WTX,WTY,WAB,SS,SYMORB
      INTEGER BMAX,ORBFRM
      REAL*8 INT(NMAX),C(NWKS),S(NWKS)
C
      DIMENSION CI(1),CJ(1),SI(1),SJ(1),H1(1),H2(1)
      DIMENSION KADD(SYMORB),LADD(SYMORB),IJADD(NUMIJ),WTW(ORBFRM,NSYM)
      DIMENSION WTX(ORBFRM,NSYM),WTY(ORBFRM),WAB(ORBFRM),SS(NORBS)
      DIMENSION IJXX(NUMIJ ),NKLXX(NSYM,ORBFRM),IJWW(NUMIJ )
      DIMENSION NKLWW(NSYM,ORBFRM),KLXX(1),KLWW(1)
C
      COMMON /COEFS/  A,B,INTAL,INTAU,INTB,INTAD,INTBD
      COMMON /DIMS/ NBF,NSYM,NORBS,NROWS,NROWS4,NWKS,NWKS2,NLEVS
     *,             NROWOC,LEVFRM
     *,             NWKSMX,NLWKMX,NUWKMX,BMAX,NROOTS,ORBFRM
      COMMON /INTS/   NMAX,NMAX2,NGROUP,NBLKOC,NUMIJ,SYMORB,INTSRT
C  UNIVERSAL IDENTITY OF THE OBJECTS IN THESE COMMON
C     COMMON /ALL/ ARR,VAL1,VAL2,VAL3,ITR1,ITR2,IA,JA,ITYPE,ISEGT
C    *,LVFRM1,NLWKI,NLWKJ,IMAX,IMIN
C     COMMON /SYMM/ JSM,JFSYM,IFSYM,MAXSYM(8),MINSYM(8),ISMOFF(8)
C    #,             NUMSYM(8)
      COMMON /SYMM/ ASM,JS,IS,MX(8),MN(8),OS(8),NUMSYM(8)
      COMMON /TAPES/ITAP52,ITAPE5,ITAPE6,ITAP58,ITAP54,ITAP99,ITAP94
     *,             ITAPE3,ITAP95,ITAP96
      COMMON /ALL/VAL1,VAL2,VAL3,ARR,TR1,TR2,IA,JA,M,ISEG,N,N1,N2
     *,           IMAX,IMIN
      COMMON /COUNT/  ICOUNT,IXX4,IXX5,IXX6,IXX8,IWW4,IWW5,IWW6,IWW8
     #,               IWX7,IXW9,IXY3,IXY16,IXY18,IXY22,IWY2,IWY15,IWY17
     #,               IWY21,IYX20,IYW19
      COMMON /XX4X/   NIJVIR,NREFS
      COMMON /MINMAX/ IMING,IMAXG,JMING,JMAXG
      common /ets/ isym
      common /sqrts/ sqrt2,sqrt3,sqt1p5,asqrt2,hsqrt3
      REAL*8 VAL1,VAL2,VAL3
C
C
cets111090      SQRT2=DSQRT(2.0D+00)
cets111090      SQRT3=DSQRT(3.0D+00)
cets111090      SQT1P5=DSQRT(1.5D+00)
cets111090      ASQRT2=1.0D+00/SQRT2
cets111090      HSQRT3=0.5D+00*DSQRT(3.0D+00)
cet110990      RETURN
C
C********************************** WW *********************************
C
cets110990      ENTRY WW
C
      IF (ISEG.GT.8) GO TO 198
      GO TO (198,198,198,104,105,106,198,108),ISEG
C
  104 CONTINUE
      IWW4=IWW4+1
      A=-VAL1*ASQRT2
      B=-(A+A)
      GO TO 110
  105 CONTINUE
      IWW5=IWW5+1
      A=-VAL1*ASQRT2
      B=-(A+A)
  110 CONTINUE
      INTAL=1
      INTB =2
      IF (IS.NE.0) GO TO 120
      IAS=IA
      DO 111 I=1,NSYM
         ISYM=I-1
         NUMI=NUMSYM(ISYM+1)
         IF (NUMI.LT.1) GO TO 111
         CALL HIIS  (H1,ISYM,NUMI,int,ijadd,kadd,ladd,h2)
         CALL SQUARW(C(IAS),CI,NUMI)
         CALL EBC   (SJ,H1,CI,NUMI,NUMI,NUMI)
         CALL FOLDW (S(IAS),SJ,NUMI)
         IAS=IAS+NUMI*(NUMI+1)/2
  111 CONTINUE
      RETURN
C
  120 CONTINUE
      IAS=IA
      DO 121 ISYM=1,NSYM-1
         JSYM=IEOR(ISYM,IS)
         IF (JSYM.GE.ISYM) GO TO 121
         NUMI=NUMSYM(ISYM+1)
         NUMJ=NUMSYM(JSYM+1)
         NUMIJ=NUMI*NUMJ
         IF (NUMIJ.LE.0) GO TO 121
         CALL HIIS  (H1,ISYM,NUMI,int,ijadd,kadd,ladd,h2)
         CALL HIIS2 (H2,JSYM,NUMJ,int,ijadd,kadd,ladd,h1)
C     CALL APBCT (S(IAS),C(IAS),H1,NUMJ,NUMI,NUMI)
         CALL ATPBCT(S(IAS),H1,C(IAS),NUMI,NUMI,NUMJ)
         CALL APBC  (S(IAS),H2,C(IAS),NUMJ,NUMJ,NUMI)
         IAS=IAS+NUMIJ
  121 CONTINUE
      RETURN
C
C     ----- ISEG 6 AND 8 CASES -----
C
  106 CONTINUE
      IWW6=IWW6+1
      A=-VAL1*ASQRT2
      B=-(A+A)
      INTAL=3
      INTAU=1
      INTB =2
      INTAD=1
      INTBD=2
      GO TO 130
  108 CONTINUE
      IWW8=IWW8+1
C
C     ----- WW ENTRIES ISEG=8 ANALYTICALLY ZERO -----
C
      RETURN
  130 CONTINUE
C
      IF (IS.NE.JS) GO TO 140
      IF (IS.NE.0) GO TO 135
      IAS=IA
      JAS=JA
      DO 131 I=1,NSYM
         ISYM=I-1
         NUMI=NUMSYM(ISYM+1)
         IF (NUMI.LT.1) GO TO 131
         CALL SQUARW(C(IAS),CI,NUMI)
         CALL SQUARW(C(JAS),CJ,NUMI)
         CALL HII   (H1,ISYM,NUMI,int,ijadd,kadd,ladd,h2)
         CALL EBC   (SJ,H1,CI,NUMI,NUMI,NUMI)
         CALL EBTC  (SI,H1,CJ,NUMI,NUMI,NUMI)
         CALL FOLDW (S(IAS),SI,NUMI)
         CALL FOLDW (S(JAS),SJ,NUMI)
         IOFF=NUMI*(NUMI+1)/2
         IAS=IAS+IOFF
         JAS=JAS+IOFF
  131 CONTINUE
      RETURN
  135 CONTINUE
      IAS=IA
      JAS=JA
      DO 136 I=2,NSYM
         ISYM=I-1
         JSYM=IEOR(IS,ISYM)
         IF (JSYM.GE.ISYM) GO TO 136
         NUMI=NUMSYM(ISYM+1)
         NUMJ=NUMSYM(JSYM+1)
         IOFF=NUMI*NUMJ
         IF (IOFF.LT.1) GO TO 136
         CALL HII   (H1,ISYM,NUMI,int,ijadd,kadd,ladd,h2)
         CALL HII2  (H2,JSYM,NUMJ,int,ijadd,kadd,ladd,h1)
         CALL APBCT (S(JAS),C(IAS),H1,NUMJ,NUMI,NUMI)
         CALL APBC  (S(JAS),H2,C(IAS),NUMJ,NUMJ,NUMI)
C     CALL APBC  (S(IAS),C(JAS),H1,NUMJ,NUMI,NUMI)
         CALL APBCTT(S(IAS),H1,C(JAS),NUMI,NUMI,NUMJ)
         CALL APBTC (S(IAS),H2,C(JAS),NUMJ,NUMJ,NUMI)
         IAS=IAS+IOFF
         JAS=JAS+IOFF
  136 CONTINUE
      RETURN
C
  140 CONTINUE
      IF (IS.NE.0) GO TO 150
      IAS=IA
      DO 142 I=1,NSYM
         ISYM=I-1
         KSYM=IEOR(JS,ISYM)
         NUMI=NUMSYM(ISYM+1)
         NUMK=NUMSYM(KSYM+1)
         IF (NUMI.LT.1.OR.NUMK.LE.0) GO TO 142
         IF (KSYM.GT.ISYM) GO TO 141
         IAS=IA+WAB(MN(ISYM+1))
         JAS=JA+WTW(MN(ISYM+1),JS+1)
         INTAL=1
         CALL HIJ   (H1,ISYM,KSYM,NUMI,NUMK,int,ijadd,kadd,ladd)
         CALL SQUARW(C(IAS),CI,NUMI)
         CALL APBTCT(S(JAS),H1,CI,NUMK,NUMI,NUMI)
C     CALL EBTCT (SI,C(JAS),H1,NUMI,NUMK,NUMI)
         CALL ATEBC (SI,H1,C(JAS),NUMI,NUMK,NUMI)
         CALL FOLDW (S(IAS),SI,NUMI)
         GO TO 142
  141    CONTINUE
         IAS=IA+WAB(MN(ISYM+1))
         JAS=JA+WTW(MN(KSYM+1),JS+1)
         INTAL=3
         CALL HIJ   (H1,KSYM,ISYM,NUMK,NUMI,int,ijadd,kadd,ladd)
         CALL SQUARW(C(IAS),CI,NUMI)
C     CALL APBTCT(S(JAS),CI,H1,NUMI,NUMI,NUMK)
         CALL ATPBC (S(JAS),H1,CI,NUMK,NUMI,NUMI)
         CALL EBTCT (SI,H1,C(JAS),NUMI,NUMK,NUMI)
         CALL FOLDW (S(IAS),SI,NUMI)
  142 CONTINUE
      RETURN
C
  150 IF (JS.NE.0) GO TO 160
      DO 152 I=1,NSYM
         ISYM=I-1
         KSYM=IEOR(IS,ISYM)
         NUMI=NUMSYM(ISYM+1)
         NUMK=NUMSYM(KSYM+1)
         IF (NUMI.LT.1.OR.NUMK.LE.0) GO TO 152
         IF (KSYM.GT.ISYM) GO TO 151
         IAS=IA+WTW(MN(ISYM+1)  ,IS+1)
         JAS=JA+WAB(MN(ISYM+1))
         INTAL=3
         CALL HIJ   (H1,ISYM,KSYM,NUMI,NUMK,int,ijadd,kadd,ladd)
         CALL SQUARW(C(JAS),CJ,NUMI)
         CALL APBTCT(S(IAS),H1,CJ,NUMK,NUMI,NUMI)
C     CALL EBTCT (SJ,C(IAS),H1,NUMI,NUMK,NUMI)
         CALL ATEBC (SJ,H1,C(IAS),NUMI,NUMK,NUMI)
         CALL FOLDW (S(JAS),SJ,NUMI)
         GO TO 152
  151    CONTINUE
         IAS=IA+WTW(MN(KSYM+1)  ,IS+1)
         JAS=JA+WAB(MN(ISYM+1))
         INTAL=1
         CALL HIJ   (H1,KSYM,ISYM,NUMK,NUMI,int,ijadd,kadd,ladd)
         CALL SQUARW(C(JAS),CJ,NUMI)
C     CALL APBTCT(S(IAS),CJ,H1,NUMI,NUMI,NUMK)
         CALL ATPBC (S(IAS),H1,CJ,NUMK,NUMI,NUMI)
         CALL EBTCT (SJ,H1,C(IAS),NUMI,NUMK,NUMI)
         CALL FOLDW (S(JAS),SJ,NUMI)
  152 CONTINUE
      RETURN
C
  160 CONTINUE
      DO 166 I=1,NSYM
         ISYM=I-1
         NUMI=NUMSYM(ISYM+1)
         IF (NUMI.LE.0) GO TO 166
         JSYM=IEOR(ISYM,IS)
         IF (JSYM.GE.ISYM) GO TO 166
         NUMJ=NUMSYM(JSYM+1)
         IF (NUMJ.LE.0) GO TO 166
         IAS=IA+WTW(MN(ISYM+1),IS+1)
         KSYM=IEOR(JSYM,JS)
         NUMK=NUMSYM(KSYM+1)
         IF (NUMK.LE.0) GO TO 163
         IF (KSYM.GE.JSYM) GO TO 161
         JAS=JA+WTW(MN(JSYM+1),JS+1)
         INTAL=1
         CALL HIJ   (H1,ISYM,KSYM,NUMI,NUMK,int,ijadd,kadd,ladd)
         CALL APBTCT(S(JAS),H1,C(IAS),NUMK,NUMI,NUMJ)
C     CALL APBTCT(S(IAS),C(JAS),H1,NUMJ,NUMK,NUMI)
         CALL ATPBC (S(IAS),H1,C(JAS),NUMI,NUMK,NUMJ)
         GO TO 163
  161    CONTINUE
         IF (KSYM.GE.ISYM) GO TO 162
         JAS=JA+WTW(MN(KSYM+1),JS+1)
         INTAL=1
         CALL HIJ   (H1,ISYM,KSYM,NUMI,NUMK,int,ijadd,kadd,ladd)
C     CALL APBC  (S(JAS),C(IAS),H1,NUMJ,NUMI,NUMK)
         CALL APBCTT(S(JAS),H1,C(IAS),NUMK,NUMI,NUMJ)
C     CALL APBCT (S(IAS),C(JAS),H1,NUMJ,NUMK,NUMI)
         CALL ATPBCT(S(IAS),H1,C(JAS),NUMI,NUMK,NUMJ)
         GO TO 163
  162    CONTINUE
         JAS=JA+WTW(MN(KSYM+1),JS+1)
         INTAL=3
         CALL HIJ   (H1,KSYM,ISYM,NUMK,NUMI,int,ijadd,kadd,ladd)
C     CALL APBCT (S(JAS),C(IAS),H1,NUMJ,NUMI,NUMK)
         CALL ATPBCT(S(JAS),H1,C(IAS),NUMK,NUMI,NUMJ)
C     CALL APBC  (S(IAS),C(JAS),H1,NUMJ,NUMK,NUMI)
         CALL APBCTT(S(IAS),H1,C(JAS),NUMI,NUMK,NUMJ)
C
C     ----- C(I,J) AND C(I,K) PART -----
C
  163    CONTINUE
         KSYM=IEOR(ISYM,JS)
         NUMK=NUMSYM(KSYM+1)
         IF (NUMK.LE.0) GO TO 166
         IF (KSYM.GE.JSYM) GO TO 164
         JAS=JA+WTW(MN(ISYM+1),JS+1)
         INTAL=1
         CALL HIJ   (H1,JSYM,KSYM,NUMJ,NUMK,int,ijadd,kadd,ladd)
         CALL APBTC (S(JAS),H1,C(IAS),NUMK,NUMJ,NUMI)
         CALL APBC  (S(IAS),H1,C(JAS),NUMJ,NUMK,NUMI)
         GO TO 166
  164    CONTINUE
         IF (KSYM.GE.ISYM) GO TO 165
         JAS=JA+WTW(MN(ISYM+1),JS+1)
         INTAL=3
         CALL HIJ   (H1,KSYM,JSYM,NUMK,NUMJ,int,ijadd,kadd,ladd)
         CALL APBC  (S(JAS),H1,C(IAS),NUMK,NUMJ,NUMI)
         CALL APBTC (S(IAS),H1,C(JAS),NUMJ,NUMK,NUMI)
         GO TO 166
  165    CONTINUE
         JAS=JA+WTW(MN(KSYM+1),JS+1)
         INTAL=3
         CALL HIJ   (H1,KSYM,JSYM,NUMK,NUMJ,int,ijadd,kadd,ladd)
C     CALL APBTCT(S(JAS),C(IAS),H1,NUMI,NUMJ,NUMK)
         CALL ATPBC (S(JAS),H1,C(IAS),NUMK,NUMJ,NUMI)
         CALL APBTCT(S(IAS),H1,C(JAS),NUMJ,NUMK,NUMI)
  166 CONTINUE
      RETURN
C
C
  198 CONTINUE
      WRITE(ITAPE6,199) ISEG
  199 FORMAT (//,' ***** ERROR IN WW ENTRY, ISEG=',I5,//)
      CALL MABORT
C
      END
