      SUBROUTINE xy(INT,C,S,IJADD,KADD,LADD,WTW,WTX,WTY,WAB,SS
     #,                 CI,SI,CJ,SJ,H1,H2,IJXX,NKLXX,IJWW,NKLWW
     #,                 KLXX,KLWW)
C
C
      IMPLICIT REAL*8 (A-H,O-Z)
CTJL 1               CI,SI,CJ,SJ,H1,H2,IJXX,NKLXX,IJWW,NKLWW,
CTJL 2               KLXX,KLWW
C
      real*8 sqrt2,sqrt3,sqt1p5,asqrt2,hsqrt3
      INTEGER ARR,TR1,TR2,ASM,OS,WTW,WTX,WTY,WAB,SS,SYMORB
      INTEGER BMAX,ORBFRM
      REAL*8 INT(NMAX),C(NWKS),S(NWKS)
C
      DIMENSION CI(1),CJ(1),SI(1),SJ(1),H1(1),H2(1)
      DIMENSION KADD(SYMORB),LADD(SYMORB),IJADD(NUMIJ),WTW(ORBFRM,NSYM)
      DIMENSION WTX(ORBFRM,NSYM),WTY(ORBFRM),WAB(ORBFRM),SS(NORBS)
      DIMENSION IJXX(NUMIJ ),NKLXX(NSYM,ORBFRM),IJWW(NUMIJ )
      DIMENSION NKLWW(NSYM,ORBFRM),KLXX(1),KLWW(1)
C
      COMMON /COEFS/  A,B,INTAL,INTAU,INTB,INTAD,INTBD
      COMMON /DIMS/ NBF,NSYM,NORBS,NROWS,NROWS4,NWKS,NWKS2,NLEVS
     *,             NROWOC,LEVFRM
     *,             NWKSMX,NLWKMX,NUWKMX,BMAX,NROOTS,ORBFRM
      COMMON /INTS/   NMAX,NMAX2,NGROUP,NBLKOC,NUMIJ,SYMORB,INTSRT
C  UNIVERSAL IDENTITY OF THE OBJECTS IN THESE COMMON
C     COMMON /ALL/ ARR,VAL1,VAL2,VAL3,ITR1,ITR2,IA,JA,ITYPE,ISEGT
C    *,LVFRM1,NLWKI,NLWKJ,IMAX,IMIN
C     COMMON /SYMM/ JSM,JFSYM,IFSYM,MAXSYM(8),MINSYM(8),ISMOFF(8)
C    #,             NUMSYM(8)
      COMMON /SYMM/ ASM,JS,IS,MX(8),MN(8),OS(8),NUMSYM(8)
      COMMON /TAPES/ITAP52,ITAPE5,ITAPE6,ITAP58,ITAP54,ITAP99,ITAP94
     *,             ITAPE3,ITAP95,ITAP96
      COMMON /ALL/VAL1,VAL2,VAL3,ARR,TR1,TR2,IA,JA,M,ISEG,N,N1,N2
     *,           IMAX,IMIN
      COMMON /COUNT/  ICOUNT,IXX4,IXX5,IXX6,IXX8,IWW4,IWW5,IWW6,IWW8
     #,               IWX7,IXW9,IXY3,IXY16,IXY18,IXY22,IWY2,IWY15,IWY17
     #,               IWY21,IYX20,IYW19
      COMMON /XX4X/   NIJVIR,NREFS
      COMMON /MINMAX/ IMING,IMAXG,JMING,JMAXG
      common /ets/ isym
      common /sqrts/ sqrt2,sqrt3,sqt1p5,asqrt2,hsqrt3
      REAL*8 VAL1,VAL2,VAL3
C
C
cets111090      SQRT2=DSQRT(2.0D+00)
cets111090      SQRT3=DSQRT(3.0D+00)
cets111090      SQT1P5=DSQRT(1.5D+00)
cets111090      ASQRT2=1.0D+00/SQRT2
cets111090      HSQRT3=0.5D+00*DSQRT(3.0D+00)
cets110990      RETURN
C
C****************************** XY *************************************
C
cets110990      ENTRY XY
      IF (ISEG.EQ.16) GO TO 500
      IF (ISEG.EQ.18) GO TO 530
      IF (ISEG.EQ.22) GO TO 570
C
C     ----- XY ISEG=3 -----
C
      IXY3=IXY3+1
      JJA=JA
      NKL=NKLXX(IS+1,N)
C     DO 420 I=MN(JS+1),MX(JS+1)
      DO 420 I=MN(JS+1),MN(JS+1)+NUMSYM(JS+1)-1
         IF (I.LT.JMING.OR.I.GT.JMAXG) GO TO 420
         IJ=IJXX(ARR+I)
C     CALL DOT(T,INT(IJ+1),C(IA),NKL)
         S(JJA)=S(JJA)+VAL1*DOT(INT(IJ+1),C(IA),NKL)
  420 JJA=JJA+1
C
      NKLOFF=NKLXX(IS+1,ORBFRM)
      IIA=IA
      JINF=MN(JS+1)
      IF (JMING.GT.JINF) JINF=JMING
      JDIFF=JINF-MN(JS+1)
C     JSUP=MX(JS+1)
      JSUP=MN(JS+1)+NUMSYM(JS+1)-1
      IF (JMAXG.LT.JSUP) JSUP=JMAXG
      IST=IJXX(ARR+JINF)
      DO 422 I=1,NKL
         JJA=JA+JDIFF
         IPT=IST+I
         T=0.0
         DO 421 J=JINF,JSUP
            T=T+INT(IPT)*C(JJA)
            IPT=IPT-NKLOFF
  421    JJA=JJA+1
         S(IIA)=S(IIA)+T*VAL1
         IIA=IIA+1
  422 CONTINUE
      RETURN
C
C     ----- XY ISEG=16 -----
C
  500 CONTINUE
      IXY16=IXY16+1
      A=VAL1
      B=VAL1
      INTAL=1
      INTB=3
      GO TO 520
C
C     ----- XY ISEG=18 -----
C
  530 CONTINUE
      IXY18=IXY18+1
      A=VAL1
      B=0.0
      INTAL=3
      INTB=3
      GO TO 520
C
C     ----- XY ISEG=22 -----
C
  570 CONTINUE
      IXY22=IXY22+1
      A=VAL1
      B=VAL1*VAL2
      INTAL=TR1
      INTB=TR2
  520 CONTINUE
      IF (JS.NE.0) GO TO 510
      IF (IS.NE.0) GO TO 502
C
C     ----- IS.EQ.0, JS.EQ.0 -----
C
      NUMI=NUMSYM(1)
      IF (NUMI.LE.1) RETURN
      CALL HI    (H1,0,NUMI,int,ijadd,kadd,ladd,h2)
      CALL SQUARE(C(IA),CI,NUMI)
      CALL APBC  (S(JA),H1,CI,1,NUMI,NUMI)
      CALL EBC   (SI,H1,C(JA),NUMI,1,NUMI)
      CALL FOLD  (S(IA),SI,NUMI)
      RETURN
C
C     ----- IS.NE.0, JS.EQ.0 -----
C
  502 CONTINUE
      NUMI=NUMSYM(IS+1)
      IF (NUMI.LT.1) RETURN
      NUMJ=NUMSYM(1)
      IF (NUMJ.LT.1) RETURN
      IAS=IA+WTX(MN(IS+1),IS+1)
      CALL HI    (H1,IS,NUMI,int,ijadd,kadd,ladd,h2)
      CALL APBCT (S(JA),H1,C(IAS),1,NUMI,NUMJ)
C     CALL APBTCT(S(IAS),C(JA),H1,NUMJ,1,NUMI)
      CALL ATPBC(S(IAS),H1,C(JA),NUMI,1,NUMJ)
      RETURN
C
C     ----- JS.NE.0 -----
C
  510 CONTINUE
      IF (IS.NE.0) GO TO 511
C
C     ----- IS.EQ.0, JS.NE.0 -----
C
      NUMI=NUMSYM(JS+1)
      IF (NUMI.LE.1) RETURN
      IAS=IA+WTX(MN(JS+1)+1,IS+1)
      CALL HI    (H1,JS,NUMI,int,ijadd,kadd,ladd,h2)
      CALL SQUARE(C(IAS),CI,NUMI)
      CALL APBC  (S(JA),H1,CI,1,NUMI,NUMI)
      CALL EBC   (SI,H1,C(JA),NUMI,1,NUMI)
      CALL FOLD  (S(IAS),SI,NUMI)
      RETURN
C
C     ----- IS.NE.0, JS.NE.0 -----
C
  511 CONTINUE
      ISYM=IEOR(IS,JS)
      NUMJ=NUMSYM(JS+1)
      IF (NUMJ.LT.1) RETURN
      NUMI=NUMSYM(ISYM+1)
      IF (NUMI.LT.1) RETURN
      IF (ISYM.LT.JS) GO TO 512
      IAS=IA+WTX(MN(ISYM+1),IS+1)
      CALL HI    (H1,ISYM,NUMI,int,ijadd,kadd,ladd,h2)
      CALL APBCT (S(JA),H1,C(IAS),1,NUMI,NUMJ)
C     CALL APBTCT(S(IAS),C(JA),H1,NUMJ,1,NUMI)
      CALL ATPBC(S(IAS),H1,C(JA),NUMI,1,NUMJ)
      RETURN
  512 CONTINUE
      IAS=IA+WTX(MN(JS+1),IS+1)
      CALL HI    (H1,ISYM,NUMI,int,ijadd,kadd,ladd,h2)
      CALL AMBC  (S(JA),H1,C(IAS),1,NUMI,NUMJ)
      CALL AMBC  (S(IAS),H1,C(JA),NUMI,1,NUMJ)
      RETURN
C
      END
