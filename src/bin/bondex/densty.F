      SUBROUTINE DENSTY(OCC,EAO,P,ISCFCI)
      IMPLICIT REAL*8 (A-H,O-Z)
      integer nbasis,nbfao,nbfso,nbatri
      DIMENSION OCC(NBASIS),EAO(NBFAO,NBFSO),P(NBATRI)
      COMMON/BASIS/NBASIS,NBFAO,NBFSO,NBATRI
      COMMON/SIGNS/IOFF(500),IPRNT
      DATA ZERO / 0.0D+00 /
    1 FORMAT(//,2X,' DENSITY MATRIXIN TINE DENSITY'/)
C
C  IF THE WAVE FUNCTION IS NOT AN SCF WAVE FUNCTION THEN READ IN THE
C  AO ONE PDM FROM THE MASTER FILE.
C
      IF(ISCFCI.GT.1) GOTO 300
C
C   FORM DENSITY MATRIX
      DO 101 I=1,NBATRI
  101 P(I)=ZERO
      IJ=0
      DO 103 I=1,NBFAO
      DO 103 J=1,I
      IJ=IJ+1
      VALU=ZERO
      DO 102 K=1,NBASIS
      IF(OCC(K).LE.ZERO) GO TO 102
      VALU=VALU+EAO(I,K)*EAO(J,K)*OCC(K)
  102 CONTINUE
      P(IJ)=VALU
  103 CONTINUE
      IF(IPRNT.LE.3) GO TO 201
      WRITE(6,1)
C     CALL PRINT(P,NBATRI,NBFAO,6)
C
  201 CONTINUE
      RETURN
  300 CONTINUE
C
C INITIALIZE THE MASTER FILE.
C
      CALL INITMF(1)
C
      IF(ISCFCI.EQ.2) CALL MREAD(P,34)
CTJL  IF(ISCFCI.EQ.3) CALL MREAD(P,37)
C
      IF(IPRNT.LE.3) GO TO 301
      WRITE(6,1)
C     CALL PRINT(P,NBATRI,NBFAO,6)
  301 CONTINUE
      RETURN
      END

